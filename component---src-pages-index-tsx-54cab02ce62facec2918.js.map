{"version":3,"file":"component---src-pages-index-tsx-54cab02ce62facec2918.js","mappings":"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","sources":["webpack://blog.jh8459.com/./src/pages/index.tsx","webpack://blog.jh8459.com/./src/utils/helpers.ts"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { graphql, navigate, type PageProps } from 'gatsby';\nimport { useLocation } from '@gatsbyjs/reach-router';\nimport firebase from 'gatsby-plugin-firebase-v9.0';\nimport { getDatabase, ref, get } from 'firebase/database';\nimport Layout from '../layout';\nimport Seo from '../components/seo';\nimport Bio from '../components/bio';\nimport Post from '../models/post';\nimport { getUniqueCategories } from '../utils/helpers';\nimport PostTabs from '../components/post-tabs';\nimport type { PostNode, PostModel } from '../types/post';\nimport type { SiteMetadata } from '../types/site';\nimport type { GatsbyImageFile } from '../types/image';\n\ninterface HomePageData {\n  allMarkdownRemark: {\n    edges: Array<{ node: PostNode }>;\n  };\n  defaultThumbnail: GatsbyImageFile;\n  site: {\n    siteMetadata: SiteMetadata;\n  };\n}\n\ntype SortType = 'date-desc' | 'date-asc' | 'title-asc' | 'views-desc';\n\ninterface SortChangeEvent {\n  target: {\n    value: SortType;\n  };\n}\n\ntype HomePageProps = PageProps<HomePageData>;\n\n/**\n * @description 홈 페이지\n * @param {HomePageProps} props Gatsby 페이지 props\n * @return {JSX.Element}\n */\nfunction HomePage({ data }: HomePageProps) {\n  // 마크다운 데이터를 포스트 모델로 변환\n  const posts: PostModel[] = data.allMarkdownRemark.edges.map(({ node }) => new Post(node));\n  const { author, language } = data.site.siteMetadata;\n  const categories = ['All', ...getUniqueCategories(posts)];\n  const featuredTabIndex = categories.findIndex((category) => category === 'featured');\n  const [tabIndex, setTabIndex] = useState<number>(featuredTabIndex === -1 ? 0 : featuredTabIndex);\n\n  const location = useLocation();\n  // 쿼리스트링에서 초기 정렬 타입을 결정\n  const queryParams = new URLSearchParams(location.search);\n  const initialSortType = (queryParams.get('sort') as SortType) || 'date-desc';\n  const [sortType, setSortType] = useState<SortType>(initialSortType);\n\n  /**\n   * @description 탭 변경 핸들러\n   * @param {React.MouseEvent | null} _event 클릭 이벤트\n   * @param {number} value 탭 인덱스\n   * @return {void}\n   */\n  const onTabIndexChange = useCallback((_: React.MouseEvent | null, value: number) => {\n    setTabIndex(value);\n  }, []);\n\n  /**\n   * @description 정렬 변경 핸들러\n   * @param {SortChangeEvent} event 정렬 이벤트\n   * @return {void}\n   */\n  const onSortChange = useCallback(\n    (event: SortChangeEvent) => {\n      const newSortType = event.target.value;\n      setSortType(newSortType);\n\n      // 정렬 값을 URL에 동기화\n      const newQueryParams = new URLSearchParams(location.search);\n      newQueryParams.set('sort', newSortType);\n      navigate(`${location.pathname}?${newQueryParams.toString()}`, { replace: true });\n    },\n    [location],\n  );\n\n  const [viewCounts, setViewCounts] = useState<Record<string, { views?: number }>>({});\n  const [loadingViews, setLoadingViews] = useState<boolean>(true);\n\n  useEffect(() => {\n    const database = getDatabase(firebase);\n    const postsRef = ref(database, 'posts');\n    get(postsRef)\n      .then((snapshot) => {\n        if (snapshot.exists()) {\n          setViewCounts(snapshot.val() as Record<string, { views?: number }>);\n        }\n      })\n      .catch((error) => {\n        console.error('Firebase read failed: ', error);\n      })\n      .finally(() => {\n        // 조회수 로딩 종료 처리\n        setLoadingViews(false);\n      });\n  }, []);\n\n  const sortedPosts = useMemo(() => {\n    // 조회수 정보를 병합해 정렬 기준을 구성\n    const postsWithViews = posts.map((post) => ({\n      ...post,\n      views: viewCounts[post.slug.replace(/\\//g, '')]?.views || 0,\n    }));\n\n    switch (sortType) {\n      case 'title-asc':\n        return postsWithViews.sort((a, b) => a.title.localeCompare(b.title));\n      case 'views-desc':\n        return postsWithViews.sort((a, b) => (b.views ?? 0) - (a.views ?? 0));\n      case 'date-asc':\n        return postsWithViews.sort(\n          (a, b) => new Date(a.date).getTime() - new Date(b.date).getTime(),\n        );\n      case 'date-desc':\n      default:\n        return postsWithViews.sort(\n          (a, b) => new Date(b.date).getTime() - new Date(a.date).getTime(),\n        );\n    }\n  }, [posts, viewCounts, sortType]);\n\n  return (\n    <Layout>\n      <Seo title=\"JH's Engineering Notes\" pathname={location.pathname} />\n      <Bio author={author} language={language} />\n      <PostTabs\n        posts={sortedPosts}\n        onChange={onTabIndexChange}\n        tabs={categories}\n        tabIndex={tabIndex}\n        showMoreButton\n        defaultThumbnail={data.defaultThumbnail}\n        sortType={sortType}\n        onSortChange={onSortChange}\n        loadingViews={loadingViews}\n      />\n    </Layout>\n  );\n}\n\nexport default HomePage;\n\nexport const pageQuery = graphql`\n  query {\n    allMarkdownRemark(sort: { frontmatter: { date: DESC } }) {\n      edges {\n        node {\n          id\n          excerpt(pruneLength: 500, truncate: true)\n          timeToRead\n          frontmatter {\n            categories\n            title\n            date(formatString: \"YYYY.MM.DD\")\n            thumbnail # Add thumbnail here\n          }\n          fields {\n            slug\n          }\n        }\n      }\n    }\n\n    defaultThumbnail: file(relativePath: { eq: \"common/no-image.png\" }) {\n      childImageSharp {\n        gatsbyImageData(width: 100, height: 100, placeholder: BLURRED, formats: [AUTO, WEBP, AVIF])\n      }\n    }\n\n    site {\n      siteMetadata {\n        language\n        author {\n          name\n          bio {\n            role\n            description\n            thumbnail\n          }\n          social {\n            github\n            linkedIn\n            yozmIt\n            email\n          }\n        }\n      }\n    }\n  }\n`;\n","import type { PostModel } from '../types/post';\n\n/**\n * @description 포스트 목록에서 고유 카테고리를 추출\n * @param {PostModel[]} posts 포스트 배열\n * @return {string[]} 정렬된 카테고리 목록\n */\nexport const getUniqueCategories = (posts: PostModel[]): string[] => {\n  const categorySet = new Set<string>();\n  posts.forEach(({ categories }) => categories.forEach((category) => categorySet.add(category)));\n  return [...categorySet].sort((a, b) => {\n    if (a === 'featured') return -1;\n    if (b === 'featured') return 1;\n    return 0;\n  });\n};\n"],"names":["_ref","data","posts","allMarkdownRemark","edges","map","_ref2","node","Post","author","language","site","siteMetadata","categories","concat","_toConsumableArray","categorySet","Set","forEach","category","add","sort","a","b","getUniqueCategories","featuredTabIndex","findIndex","tabIndex","setTabIndex","useState","location","useLocation","initialSortType","URLSearchParams","search","get","sortType","setSortType","onTabIndexChange","useCallback","_","value","onSortChange","event","newSortType","target","newQueryParams","set","navigate","pathname","toString","replace","viewCounts","setViewCounts","loadingViews","setLoadingViews","useEffect","database","getDatabase","firebase","postsRef","ref","then","snapshot","exists","val","catch","error","console","finally","sortedPosts","useMemo","postsWithViews","post","_viewCounts$post$slug","Object","assign","views","slug","title","localeCompare","_b$views","_a$views","Date","date","getTime","React","Layout","Seo","Bio","PostTabs","onChange","tabs","showMoreButton","defaultThumbnail"],"sourceRoot":""}