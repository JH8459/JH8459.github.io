{"version":3,"file":"component---src-templates-category-template-tsx-9af7937fe723260db066.js","mappings":"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","sources":["webpack://blog.jh8459.com/./src/components/category-page-header/index.tsx","webpack://blog.jh8459.com/./src/templates/category-template.tsx"],"sourcesContent":["import React from 'react';\n\ninterface CategoryPageHeaderProps {\n  title: string;\n  subtitle: string;\n}\n\n/**\n * @description 카테고리 페이지 헤더\n * @param {CategoryPageHeaderProps} props 헤더 props\n * @return {JSX.Element}\n */\nfunction CategoryPageHeader({ title, subtitle }: CategoryPageHeaderProps) {\n  return (\n    <div className=\"flex flex-col items-center justify-center mt-[30px] mb-[30px]\">\n      <h1 className=\"w-fit pb-[7px] mb-[15px] text-[40px] font-bold text-center border-b-[3px] border-[var(--primary-text-color)]\">\n        {title}\n      </h1>\n      <p className=\"pb-[10px] text-[20px] font-medium text-center\">{subtitle}</p>\n    </div>\n  );\n}\n\nexport default CategoryPageHeader;\n","import React, { useMemo, useCallback, useState, useEffect } from 'react';\nimport { navigate, type PageProps } from 'gatsby';\nimport { useLocation } from '@gatsbyjs/reach-router';\nimport firebase from 'gatsby-plugin-firebase-v9.0';\nimport { getDatabase, ref, get } from 'firebase/database';\n\nimport Layout from '../layout';\nimport Seo from '../components/seo';\nimport Post from '../models/post';\nimport CategoryPageHeader from '../components/category-page-header';\nimport PostTabs from '../components/post-tabs';\nimport type { PostNode, PostModel } from '../types/post';\nimport type { GatsbyImageFile } from '../types/image';\n\ntype SortType = 'date-desc' | 'date-asc' | 'title-asc' | 'views-desc';\n\ninterface CategoryPageContext {\n  edges: Array<{ node: PostNode }>;\n  currentCategory: string;\n  categories: string[];\n  defaultThumbnail: GatsbyImageFile;\n}\n\ntype CategoryTemplateProps = PageProps<Record<string, never>, CategoryPageContext>;\n\n/**\n * @description 카테고리 목록 페이지 템플릿\n * @param {CategoryTemplateProps} props 페이지 props\n * @return {JSX.Element}\n */\nfunction CategoryTemplate({ pageContext }: CategoryTemplateProps) {\n  const { edges, currentCategory, defaultThumbnail, categories } = pageContext;\n\n  const location = useLocation();\n  // 쿼리스트링에서 초기 정렬 타입을 결정\n  const queryParams = new URLSearchParams(location.search);\n  const initialSortType = (queryParams.get('sort') as SortType) || 'date-desc';\n  const [sortType, setSortType] = useState<SortType>(initialSortType);\n\n  const posts: PostModel[] = useMemo(() => edges.map(({ node }) => new Post(node)), [edges]);\n\n  const currentTabIndex = useMemo(\n    () => categories.findIndex((category) => category === currentCategory),\n    [categories, currentCategory],\n  );\n\n  /**\n   * @description 탭 변경 핸들러\n   * @param {React.MouseEvent | null} _event 클릭 이벤트\n   * @param {number} value 탭 인덱스\n   * @return {void}\n   */\n  const onTabIndexChange = useCallback(\n    (_: React.MouseEvent | null, value: number) => {\n      // 탭 변경 시 카테고리 경로 이동\n      if (value === 0) return navigate(`/posts`);\n      navigate(`/posts/${categories[value]}`);\n    },\n    [categories],\n  );\n\n  /**\n   * @description 정렬 변경 핸들러\n   * @param {{ target: { value: SortType } }} event 정렬 이벤트\n   * @return {void}\n   */\n  const onSortChange = useCallback(\n    (event: { target: { value: SortType } }) => {\n      const newSortType = event.target.value;\n      setSortType(newSortType);\n\n      // 정렬 값을 URL에 동기화\n      const newQueryParams = new URLSearchParams(location.search);\n      newQueryParams.set('sort', newSortType);\n      navigate(`${location.pathname}?${newQueryParams.toString()}`, { replace: true });\n    },\n    [location],\n  );\n\n  const [viewCounts, setViewCounts] = useState<Record<string, { views?: number }>>({});\n  const [loadingViews, setLoadingViews] = useState<boolean>(true);\n\n  useEffect(() => {\n    const database = getDatabase(firebase);\n    const postsRef = ref(database, 'posts');\n    get(postsRef)\n      .then((snapshot) => {\n        if (snapshot.exists()) {\n          setViewCounts(snapshot.val() as Record<string, { views?: number }>);\n        }\n      })\n      .catch((error) => {\n        console.error('Firebase read failed: ', error);\n      })\n      .finally(() => {\n        // 조회수 로딩 종료 처리\n        setLoadingViews(false);\n      });\n  }, []);\n\n  const sortedPosts = useMemo(() => {\n    // 조회수 정보를 병합해 정렬 기준을 구성\n    const postsWithViews = posts.map((post) => ({\n      ...post,\n      views: viewCounts[post.slug.replace(/\\//g, '')]?.views || 0,\n    }));\n\n    switch (sortType) {\n      case 'title-asc':\n        return postsWithViews.sort((a, b) => a.title.localeCompare(b.title));\n      case 'views-desc':\n        return postsWithViews.sort((a, b) => (b.views ?? 0) - (a.views ?? 0));\n      case 'date-desc':\n      default:\n        return postsWithViews.sort(\n          (a, b) => new Date(b.date).getTime() - new Date(a.date).getTime(),\n        );\n    }\n  }, [posts, viewCounts, sortType]);\n\n  return (\n    <Layout>\n      <Seo title=\"Posts\" />\n      <CategoryPageHeader title={categories[currentTabIndex]} subtitle={`${posts.length} posts`} />\n      <PostTabs\n        tabIndex={currentTabIndex}\n        onChange={onTabIndexChange}\n        tabs={categories}\n        posts={sortedPosts}\n        defaultThumbnail={defaultThumbnail}\n        sortType={sortType}\n        onSortChange={onSortChange}\n        loadingViews={loadingViews} // Pass loading state down\n      />\n    </Layout>\n  );\n}\n\nexport default CategoryTemplate;\n"],"names":["_ref","title","subtitle","React","className","pageContext","edges","currentCategory","defaultThumbnail","categories","location","useLocation","initialSortType","URLSearchParams","search","get","sortType","setSortType","useState","posts","useMemo","map","_ref2","node","Post","currentTabIndex","findIndex","category","onTabIndexChange","useCallback","_","value","navigate","onSortChange","event","newSortType","target","newQueryParams","set","pathname","toString","replace","viewCounts","setViewCounts","loadingViews","setLoadingViews","useEffect","database","getDatabase","firebase","postsRef","ref","then","snapshot","exists","val","catch","error","console","finally","sortedPosts","postsWithViews","post","_viewCounts$post$slug","Object","assign","views","slug","sort","a","b","localeCompare","_b$views","_a$views","Date","date","getTime","Layout","Seo","CategoryPageHeader","length","PostTabs","tabIndex","onChange","tabs"],"sourceRoot":""}