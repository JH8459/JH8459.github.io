{"componentChunkName":"component---src-templates-blog-template-js","path":"/2022-02-09-PROJECT/","result":{"data":{"cur":{"id":"2d3c946f-552e-51fe-884f-e5b1964a125e","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBA//EABYBAQEBAAAAAAAAAAAAAAAAAAQAAf/aAAwDAQACEAMQAAAB71JJTVn/xAAWEAADAAAAAAAAAAAAAAAAAAAAESD/2gAIAQEAAQUCFP8A/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFhAAAwAAAAAAAAAAAAAAAAAAACBB/9oACAEBAAY/AiL/AP/EABwQAAICAgMAAAAAAAAAAAAAAAERADEQUUFxkf/aAAgBAQABPyG+QOzHFn1G4hqIax//2gAMAwEAAgADAAAAEOMv/8QAFhEBAQEAAAAAAAAAAAAAAAAAARBR/9oACAEDAQE/EBMn/8QAFxEAAwEAAAAAAAAAAAAAAAAAARARUf/aAAgBAgEBPxCHV//EAB0QAQABBAMBAAAAAAAAAAAAAAEAESExgRBBYXH/2gAIAQEAAT8QBTSiaYF1uN2gdiAFQQemKZD9Jmsv5x//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"github-blog.png\"\n        title=\"\"\n        src=\"/static/0da0186f8f100aaab0baf6a925d3285a/80e3c/project.jpg\"\n        srcset=\"/static/0da0186f8f100aaab0baf6a925d3285a/4ec73/project.jpg 180w,\n/static/0da0186f8f100aaab0baf6a925d3285a/158ba/project.jpg 360w,\n/static/0da0186f8f100aaab0baf6a925d3285a/80e3c/project.jpg 720w,\n/static/0da0186f8f100aaab0baf6a925d3285a/280b9/project.jpg 905w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<h2 id=\"️-refactoring\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-refactoring\" aria-label=\"️ refactoring permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⚒️ Refactoring</h2>\n<hr>\n<ul>\n<li>\n<p>민감정보 암호화 Task는 모두 끝냈다.</p>\n<p>다음 가져갈 Task로 로그아웃시 발생하는 에러 핸들링을 해보려한다.</p>\n</li>\n</ul>\n<br>\r\n<br>\n<h3 id=\"문제점\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C%EC%A0%90\" aria-label=\"문제점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제점</h3>\n<ul>\n<li>\n<p>현재 로그인 방식은 <code class=\"language-text\">cookie</code>에 JWT Token을 담아 인증하는 방식으로 로그인검증이 이루어지고 있으며, 로그아웃시에는 로그인 여부를 검증한 뒤, 쿠키를 만료시키는 방식으로 로그아웃 처리를 구현하였다.</p>\n<blockquote>\n<p><strong>controller/authentication/logout.js</strong></p>\n<p><img src=\"https://user-images.githubusercontent.com/83164003/153110704-f562c05e-890a-4512-a358-f2cc3e431102.png\" alt=\"스크린샷, 2022-02-09 11-31-35\"></p>\n</blockquote>\n</li>\n<li>\n<p>로그아웃시 에러가 발생하는 대표적인 경우는 다음과 같다.</p>\n<ul>\n<li>\n<p>웹이나 모바일 환경에서 강제로 쿠키를 삭제 후 로그아웃시 발생</p>\n<p><img src=\"https://user-images.githubusercontent.com/83164003/153110448-62615271-8a2c-4055-b3cd-59e80b7c1dbb.png\" alt=\"스크린샷, 2022-02-09 11-28-57\"></p>\n</li>\n</ul>\n<p>우선 위의 크롬환경에서 쿠키를 강제로 삭제하는 경우 <code class=\"language-text\">cookie</code>에 담긴 JWT Token값이 날아가기 때문에, 로그인 검증이 이뤄지지 않아 발생하는 에러이다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/83164003/153110122-099531cf-6e6f-4deb-bce3-96c4f73d9f2a.png\" alt=\"스크린샷, 2022-02-09 11-24-50\"></p>\n</li>\n<li>\n<p>검색 결과 우선 에러의 원인은 <strong>“서버가 클라이언트에 둘 이상의 응답을 보내려고 할 때 발생하는 에러”</strong> 였다.</p>\n</li>\n</ul>\n<br>\r\n<br>\n<h3 id=\"문제-해결\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0\" aria-label=\"문제 해결 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 해결</h3>\n<hr>\n<ul>\n<li>\n<p>우선 해결은 간단히 가능했다.</p>\n<p>키포인트는 <strong>“서버가 클라이언트에 둘 이상의 응답을 보내려고 할 때 발생하는 에러”</strong> 에러코드 그 자체가 정답이었다. <del>(기계는 거짓말을 하지않는다…)</del></p>\n<p>우선 로그아웃시 <code class=\"language-text\">userAuth</code> 미들웨어 함수가 호출된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 로그인 인증검사</span>\r\n<span class=\"token keyword\">await</span> <span class=\"token function\">userAuth</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>해당 함수로 로그인 여부가 검증이 이뤄지며 미들웨어 함수의 자세한 내용은 아래와 같다.</p>\n<blockquote>\n<p><strong>middlewares/authorized/userAuth.js</strong></p>\n<p><img src=\"https://user-images.githubusercontent.com/83164003/153112382-26f6e9dd-73c9-487e-bfa3-76c388d160e9.png\" alt=\"스크린샷, 2022-02-09 11-42-11\"></p>\n</blockquote>\n</li>\n<li>\n<p>코드를 살펴보니 원인은 다음과 같았다.</p>\n<ul>\n<li>\n<p>쿠키를 강제로 파괴하는 경우 <code class=\"language-text\">client</code> 상태는 로그인 상태이지만 JWT 토큰값이 없는 상황.</p>\n</li>\n<li>\n<p>JWT 토큰이 없는 상황에서 <code class=\"language-text\">userAuth</code> 미들웨어 함수를 거치며 <code class=\"language-text\">return</code>값으로 401번 에러코드 <code class=\"language-text\">json</code> 응답 결과를 반환함.</p>\n</li>\n<li>\n<p>결국 로그아웃 API 요청이 들어왔을 경우 반환되는 <code class=\"language-text\">json</code>응답 결과값이 2개가 되어서 **“서버가 클라이언트에 둘 이상의 응답을 보내려고 할 때 발생하는 에러”**가 발생이 된다.</p>\n</li>\n</ul>\n<blockquote>\n<p><strong>controller/authentication/logout.js</strong></p>\n<p><img src=\"https://user-images.githubusercontent.com/83164003/153113003-73804868-4fb3-4b21-bff6-e0b5b285c9c3.png\" alt=\"스크린샷, 2022-02-09 11-53-04\"></p>\n</blockquote>\n</li>\n<li>\n<p>우선은 로그인 인증검사 부분</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 로그인 인증검사</span>\r\n<span class=\"token comment\">// await userAuth(req, res);</span></code></pre></div>\n</li>\n<li>\n<p>해당 코드를 주석처리하면 에러는 발생하지 않는다.</p>\n<p>하지만, 조금더 나아가서 <code class=\"language-text\">userAuth</code>에서 로그인 검증 이후 <code class=\"language-text\">accessToken</code>값이 비어있다면 (즉, 유효하지 않은 로그인정보 상태라면) 메인페이지로 이동하고 로그인 모달을 띄워서 다시 로그인을 유도하는 방향으로 서버 &#x26; 클라이언트의 구조를 바꿔보아야 겠다. <del>(내일 진행 예정)</del></p>\n</li>\n</ul>\n<br>\r\n<br>\n<hr>\n<ul>\n<li>\n<p>요청값에 일반적으로 1개의 응답결과를 반환해야하는 당연하고 기본적인 개념을 실수하고 넘어가서 발생한 에러였다.</p>\n</li>\n<li>\n<p>우선 해당 내용에 대해서 조금더 학습해보고 로그인 검증 이후 유효하지 않은 로그인 정보를 보유중이라면 메인페이지로 이동하고 로그인을 다시 유도하는 방향으로 전반적인 코드를 다시 작성해보아야겠다.</p>\n</li>\n</ul>\n<br>\r\n<br>","excerpt":"⚒️ Refactoring 민감정보 암호화 Task는 모두 끝냈다. 다음 가져갈 Task로 로그아웃시 발생하는 에러 핸들링을 해보려한다. 문제점 현재 로그인 방식은 에 JWT Token을 담아 인증하는 방식으로 로그인검증이 이루어지고 있으며, 로그아웃시에는 로그인 여부를 검증한 뒤, 쿠키를 만료시키는 방식으로 로그아웃 처리를 구현하였다. controller/authentication/logout.js 스크린샷, 2022-02-09 11-31-35 로그아웃시 에러가 발생하는 대표적인 경우는 다음과 같다. 웹이나 모바일 환경에서 강제로 쿠키를 삭제 후 로그아웃시 발생 스크린샷, 2022-02-09 11-28-57 우선 위의 크롬환경에서 쿠키를 강제로 삭제하는 경우 에 담긴 JWT Token값이 날아가기 때문에, 로그인 검증이 이뤄지지 않아 발생하는 에러이다. 스크린샷, 2022-02-09 11-24-50 검색 결과 우선 에러의 원인은 “서버가 클라이언트에 둘 이상의 응답을 보내려고 할 …","timeToRead":1,"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EF%B8%8F-refactoring\">⚒️ Refactoring</a></p>\n<ul>\n<li><a href=\"#%EB%AC%B8%EC%A0%9C%EC%A0%90\">문제점</a></li>\n<li><a href=\"#%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0\">문제 해결</a></li>\n</ul>\n</li>\n</ul>","frontmatter":{"date":"2022.02.09","title":"ALL-CON Refactoring 3일차 - 하나의 요청에 두개 이상의 응답시 발생하는 에러 핸들링","categories":"Project","author":"JH8459","emoji":"🔥"},"fields":{"slug":"/2022-02-09-PROJECT/"}},"next":{"id":"bf173f9e-ab15-521c-8ef0-ea786a6a637f","frontmatter":{"date":"2022.02.09","title":"Node.js - code: ERR_HTTP_HEADERS_SENT 에러 핸들링","categories":"TIL","author":"JH8459","emoji":"📚"},"fields":{"slug":"/2022-02-09-TIL/"}},"prev":{"id":"af037899-6cbf-572d-972f-2ca3a073b23b","frontmatter":{"date":"2022.02.10","title":"ALL-CON Refactoring 4일차 - 유효하지 않은 로그인 상태 검증","categories":"Project","author":"JH8459","emoji":"🔥"},"fields":{"slug":"/2022-02-10-PROJECT/"}},"site":{"siteMetadata":{"comments":{"giscus":{"repo":"JH8459/JH8459.github.io","repoId":"R_kgDOI03HgA","category":"Comments","categoryId":"DIC_kwDOI03HgM4CtuXL"}}}}},"pageContext":{"slug":"/2022-02-09-PROJECT/","nextSlug":"/2022-02-09-TIL/","prevSlug":"/2022-02-10-PROJECT/"}},"staticQueryHashes":["1073350324","2009502679","2938748437","962130685"],"slicesMap":{}}