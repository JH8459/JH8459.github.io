{"componentChunkName":"component---src-templates-blog-template-js","path":"/2022-02-11-TIL/","result":{"data":{"cur":{"id":"49d1b001-980b-5003-a133-e5057dbc49e6","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECA//EABUBAQEAAAAAAAAAAAAAAAAAAAAF/9oADAMBAAIQAxAAAAHSaSawD//EABYQAAMAAAAAAAAAAAAAAAAAAAABIP/aAAgBAQABBQIU/wD/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAAIDH/2gAIAQEABj8CIv8A/8QAGBAAAgMAAAAAAAAAAAAAAAAAAAERIDH/2gAIAQEAAT8hGb2Ff//aAAwDAQACAAMAAAAQHD//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAZEAACAwEAAAAAAAAAAAAAAAABEQAgQVH/2gAIAQEAAT8QjVhju1//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"github-blog.png\"\n        title=\"github-blog.png\"\n        src=\"/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/80e3c/TIL.jpg\"\n        srcset=\"/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/4ec73/TIL.jpg 180w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/158ba/TIL.jpg 360w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/80e3c/TIL.jpg 720w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/47311/TIL.jpg 1080w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/ac614/TIL.jpg 1272w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<h2 id=\"️-today-i-learned\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-today-i-learned\" aria-label=\"️ today i learned permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✍️ <strong>T</strong>oday <strong>I</strong> <strong>L</strong>earned</h2>\n<br>\n<ul>\n<li>\n<p>Sequelize ORM을 사용하며 가장 편리한 점을 꼽는다면 마이그레이션을 선택할 것 같다.</p>\n</li>\n<li>\n<p>운영중인 서비스 중단없이 DB 스키마 모델을 변경한다던가 서비스 기획 및 설계단계에서 놓친 점을 나중에 추가할 때 DB를 갈아엎지 않고 수정할 수 있는 기능을 제공하는 마이그레이션은 써본 사람만 알 것이다.</p>\n</li>\n<li>\n<p>다만 스키마 수정이 필요한 경우가 많이 발생하지 않기 때문에 사용빈도가 많지가 않았다.</p>\n<p>익숙치 않은 문법이기 때문에 매번 사용할 때 마다 검색을 통하여 사용하였는데, 이참에 블로그에 학습한 내용을 정리해서 내가 보려고 남겨본다.</p>\n</li>\n</ul>\n<br>\n<br>\n<h3 id=\"1-migration\" style=\"position:relative;\"><a href=\"#1-migration\" aria-label=\"1 migration permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Migration</h3>\n<hr>\n<ul>\n<li>\n<p><code class=\"language-text\">Sequelize</code> 공식문서에서는 마이그레이션을 다음과 같이 설명하고 있다.</p>\n<blockquote>\n<p>Just like you use <strong>version control</strong> systems such as <strong>Git</strong> to manage changes in your source code, you can use <strong>migrations</strong> to keep track of changes to the database. With migrations you can transfer your existing database into another state and vice versa: Those state transitions are saved in migration files, which describe how to get to the new state and how to revert the changes in order to get back to the old state.</p>\n</blockquote>\n</li>\n<li>\n<p>간단히 설명하자면 <strong>마이그레이션</strong>은 Git과 같은 버전 컨트롤 시스템으로써, 이를 데이터베이스에 적용하며 지원해준다.</p>\n<p>즉, 마이그레이션은 데이터베이스의 수정및 롤백을 버전 컨트롤 시스템 처럼 이용할 수 있게끔 지원하는 강력한 기능이다.</p>\n</li>\n<li>\n<p>마이그레이션을 이용하기전 Sequelize CLI가 필요하다. CLI는 마이그레이션과 프로젝트 부트스트랩 지원을 제공하며 이를 설치한 환경이라는 가정하에 글을 남긴다.</p>\n</li>\n</ul>\n<br>\n<br>\n<h4 id=\"1-1-migration-생성\" style=\"position:relative;\"><a href=\"#1-1-migration-%EC%83%9D%EC%84%B1\" aria-label=\"1 1 migration 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-1. Migration 생성</h4>\n<hr>\n<ul>\n<li>\n<p>마이그레이션은 필요할 때마다 생성할 수 있다.</p>\n<p>스키마에 변경이 필요할 때(컬럼을 추가하거나, 기존 컬럼의 데이터 속성값을 변경할 때)마다 <code class=\"language-text\">migration.js</code> 파일을 생성하여 진행하는 것이다.</p>\n</li>\n<li>\n<p>우선 마이그레이션을 생성하는 명령어는 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"># using npm\nnpx sequelize<span class=\"token operator\">-</span>cli migration<span class=\"token operator\">:</span>generate <span class=\"token operator\">--</span>name 생성할 migration 이름\n# using yarn\nyarn sequelize<span class=\"token operator\">-</span>cli migration<span class=\"token operator\">:</span>generate <span class=\"token operator\">--</span>name 생성할 migration 이름</code></pre></div>\n<p>마이그레이션 파일을 보고 어떤 기능을 하는 코드인지 유추할 수 있을만한 이름만 입력해주면 생성이 된다.</p>\n<ul>\n<li>명령어를 입력시 아래와 같은 템플릿 코드가 제공이 된다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">up</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">queryInterface<span class=\"token punctuation\">,</span> Sequelize</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * Add altering commands here.\n     *\n     * Example:\n     * await queryInterface.createTable('users', { id: Sequelize.INTEGER });\n     */</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function-variable function\">down</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">queryInterface<span class=\"token punctuation\">,</span> Sequelize</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * Add reverting commands here.\n     *\n     * Example:\n     * await queryInterface.dropTable('users');\n     */</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">up</code>은 마이그레이션을 담당하고 있으며, <code class=\"language-text\">down</code>은 <code class=\"language-text\">undo</code> 기능(롤백)을 담당하고 있다.</p>\n</li>\n<li>\n<p>다음은 기능별로 함수들을 묶어 정리하였다.</p>\n</li>\n</ul>\n<br>\n<br>\n<h4 id=\"1-2-테이블을-새로-생성하거나-기존-테이블을-지워야-할-때\" style=\"position:relative;\"><a href=\"#1-2-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%84-%EC%83%88%EB%A1%9C-%EC%83%9D%EC%84%B1%ED%95%98%EA%B1%B0%EB%82%98-%EA%B8%B0%EC%A1%B4-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%84-%EC%A7%80%EC%9B%8C%EC%95%BC-%ED%95%A0-%EB%95%8C\" aria-label=\"1 2 테이블을 새로 생성하거나 기존 테이블을 지워야 할 때 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-2. 테이블을 새로 생성하거나 기존 테이블을 지워야 할 때</h4>\n<hr>\n<ul>\n<li>\n<p>우선 테이블을 생성할 때는 아래의 함수를 사용한다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">createTable()</code></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// await queryInterface.createTable('테이블명', 컬럼명: {데이터 속성, 옵션}...);</span>\n\n<span class=\"token keyword\">await</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token function\">createTable</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Users'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> Sequelize<span class=\"token punctuation\">.</span><span class=\"token constant\">INTEGER</span>\n    <span class=\"token literal-property property\">autoIncrement</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">allowNull</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">primaryKey</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">username</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> Sequelize<span class=\"token punctuation\">.</span><span class=\"token constant\">STRING</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">allowNull</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>그리고 테이블을 삭제할 때는 아래의 함수를 사용한다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">dropTable()</code></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// await queryInterface.createTable('테이블명');</span>\n\n<span class=\"token keyword\">await</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token function\">dropTable</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Users'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<br>\n<br>\n<h4 id=\"1-3-테이블에-새로운-컬럼을-추가하거나-기존의-컬럼을-삭제할-때\" style=\"position:relative;\"><a href=\"#1-3-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%97%90-%EC%83%88%EB%A1%9C%EC%9A%B4-%EC%BB%AC%EB%9F%BC%EC%9D%84-%EC%B6%94%EA%B0%80%ED%95%98%EA%B1%B0%EB%82%98-%EA%B8%B0%EC%A1%B4%EC%9D%98-%EC%BB%AC%EB%9F%BC%EC%9D%84-%EC%82%AD%EC%A0%9C%ED%95%A0-%EB%95%8C\" aria-label=\"1 3 테이블에 새로운 컬럼을 추가하거나 기존의 컬럼을 삭제할 때 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-3. 테이블에 새로운 컬럼을 추가하거나 기존의 컬럼을 삭제할 때</h4>\n<hr>\n<ul>\n<li>\n<p>우선 테이블에 새로운 컬럼을 추가할 때는 아래의 함수를 사용한다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">addColumn()</code></p>\n<p><code class=\"language-text\">Users</code> 테이블에 <code class=\"language-text\">role</code> 컬럼 추가 (데이터 속성은 <code class=\"language-text\">Integer</code>, <code class=\"language-text\">null</code>을 허용하지 않으며 기본값은 <code class=\"language-text\">1</code>)</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// await queryInterface.addColumn('테이블명', '컬럼명', {데이터 속성,옵션...});</span>\n\n<span class=\"token keyword\">await</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token function\">addColumn</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Users'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'role'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> Sequelize<span class=\"token punctuation\">.</span><span class=\"token constant\">INTEGER</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">allowNull</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">defaltValues</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>그리고 기존의 컬럼을 삭제할 때는 아래의 함수를 사용한다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">removeColumn()</code></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// await queryInterface.removeColumn('테이블명', '컬럼명');</span>\n\n<span class=\"token keyword\">await</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token function\">removeColumn</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Users'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'role'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<br>\n<br>\n<h4 id=\"1-4-기존-컬럼의-이름-변경할-때\" style=\"position:relative;\"><a href=\"#1-4-%EA%B8%B0%EC%A1%B4-%EC%BB%AC%EB%9F%BC%EC%9D%98-%EC%9D%B4%EB%A6%84-%EB%B3%80%EA%B2%BD%ED%95%A0-%EB%95%8C\" aria-label=\"1 4 기존 컬럼의 이름 변경할 때 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-4. 기존 컬럼의 이름 변경할 때</h4>\n<hr>\n<ul>\n<li>\n<p>테이블에 있는 기존 컬럼의 이름을 변경할 땐 아래의 함수를 사용한다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">renameColumn()</code></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// await queryInterface.renameColumn('테이블명', '컬럼명', '변경할 컬럼명');</span>\n\n<span class=\"token keyword\">await</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token function\">renameColumn</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Users'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'role'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'userRole'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<br>\n<br>\n<h4 id=\"1-5-기존-컬럼의-데이터-속성-및-옵션값-변경\" style=\"position:relative;\"><a href=\"#1-5-%EA%B8%B0%EC%A1%B4-%EC%BB%AC%EB%9F%BC%EC%9D%98-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%86%8D%EC%84%B1-%EB%B0%8F-%EC%98%B5%EC%85%98%EA%B0%92-%EB%B3%80%EA%B2%BD\" aria-label=\"1 5 기존 컬럼의 데이터 속성 및 옵션값 변경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-5. 기존 컬럼의 데이터 속성 및 옵션값 변경</h4>\n<hr>\n<ul>\n<li>\n<p>테이블에 있는 기존 컬럼의 이름을 변경할 땐 아래의 함수를 사용한다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">changeColumn()</code></p>\n<p><code class=\"language-text\">Users</code> 테이블에 <code class=\"language-text\">userRole</code> 컬럼 속성 변경 (데이터 속성은 <code class=\"language-text\">STRING</code>, 기본값은 <code class=\"language-text\">normal</code>)</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// await queryInterface.changeColumn('테이블명', '컬럼명', {데이터 속성, 옵션});</span>\n\n<span class=\"token keyword\">await</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token function\">changeColumn</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Users'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'userRole'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> Sequelize<span class=\"token punctuation\">.</span><span class=\"token constant\">STRING</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">defaltValues</span><span class=\"token operator\">:</span> <span class=\"token string\">'normal'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<br>\n<br>\n<h4 id=\"1-6-migration-실행과-롤백\" style=\"position:relative;\"><a href=\"#1-6-migration-%EC%8B%A4%ED%96%89%EA%B3%BC-%EB%A1%A4%EB%B0%B1\" aria-label=\"1 6 migration 실행과 롤백 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-6. Migration 실행과 롤백</h4>\n<hr>\n<ul>\n<li>\n<p>각각 필요한 기능을 <code class=\"language-text\">up()</code>과 <code class=\"language-text\">down()</code> 기능에 적절히 넣어두면 명령어를 통해 사용이 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"># using npm\nnpx sequelize<span class=\"token operator\">-</span>cli db<span class=\"token operator\">:</span>migrate\n# using yarn\nyarn sequelize<span class=\"token operator\">-</span>cli db<span class=\"token operator\">:</span>migrate</code></pre></div>\n</li>\n<li>\n<p>위 명령어를 통해 마이그레이션을 실행 할 수 있으며 롤백 또한 아래의 코드를 이용하여 사용이 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"># using npm\nnpx sequelize<span class=\"token operator\">-</span>cli db<span class=\"token operator\">:</span>migrate<span class=\"token operator\">:</span>undo\n# using yarn\nyarn sequelize<span class=\"token operator\">-</span>cli db<span class=\"token operator\">:</span>migrate<span class=\"token operator\">:</span>undo</code></pre></div>\n</li>\n</ul>\n<br>\n<br>\n<h2 id=\"-understanding\" style=\"position:relative;\"><a href=\"#-understanding\" aria-label=\" understanding permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🤔 Understanding</h2>\n<ul>\n<li>\n<p>서비스를 멈추거나 DB를 모두 삭제 후 스키마를 수정을 해야하는 번거로움 없이 <code class=\"language-text\">Sequelize</code> Migration은 DB 스키마 수정을 간편하게 도와준다.</p>\n</li>\n<li>\n<p>혹시 예상치 못한 스키마 수정결과가 일어나도 Git과 같이 <strong>버전 관리</strong> 기능이 있기 때문에 롤백또한 쉽게 가능하다.</p>\n<p>위 명령어들은 솔직히 자주 쓰지 못했기 때문에 매번 쓸 때마다 검색에 검색을 거듭해서 사용하곤 했었다.</p>\n<p>글로 정리하며 조금 머릿속에서 정리된 기분이다.</p>\n</li>\n</ul>\n<br>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EF%B8%8F-today-i-learned\">✍️ <strong>T</strong>oday <strong>I</strong> <strong>L</strong>earned</a></p>\n<ul>\n<li>\n<p><a href=\"#1-migration\">1. Migration</a></p>\n<ul>\n<li><a href=\"#1-1-migration-%EC%83%9D%EC%84%B1\">1-1. Migration 생성</a></li>\n<li><a href=\"#1-2-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%84-%EC%83%88%EB%A1%9C-%EC%83%9D%EC%84%B1%ED%95%98%EA%B1%B0%EB%82%98-%EA%B8%B0%EC%A1%B4-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%84-%EC%A7%80%EC%9B%8C%EC%95%BC-%ED%95%A0-%EB%95%8C\">1-2. 테이블을 새로 생성하거나 기존 테이블을 지워야 할 때</a></li>\n<li><a href=\"#1-3-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%97%90-%EC%83%88%EB%A1%9C%EC%9A%B4-%EC%BB%AC%EB%9F%BC%EC%9D%84-%EC%B6%94%EA%B0%80%ED%95%98%EA%B1%B0%EB%82%98-%EA%B8%B0%EC%A1%B4%EC%9D%98-%EC%BB%AC%EB%9F%BC%EC%9D%84-%EC%82%AD%EC%A0%9C%ED%95%A0-%EB%95%8C\">1-3. 테이블에 새로운 컬럼을 추가하거나 기존의 컬럼을 삭제할 때</a></li>\n<li><a href=\"#1-4-%EA%B8%B0%EC%A1%B4-%EC%BB%AC%EB%9F%BC%EC%9D%98-%EC%9D%B4%EB%A6%84-%EB%B3%80%EA%B2%BD%ED%95%A0-%EB%95%8C\">1-4. 기존 컬럼의 이름 변경할 때</a></li>\n<li><a href=\"#1-5-%EA%B8%B0%EC%A1%B4-%EC%BB%AC%EB%9F%BC%EC%9D%98-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%86%8D%EC%84%B1-%EB%B0%8F-%EC%98%B5%EC%85%98%EA%B0%92-%EB%B3%80%EA%B2%BD\">1-5. 기존 컬럼의 데이터 속성 및 옵션값 변경</a></li>\n<li><a href=\"#1-6-migration-%EC%8B%A4%ED%96%89%EA%B3%BC-%EB%A1%A4%EB%B0%B1\">1-6. Migration 실행과 롤백</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-understanding\">🤔 Understanding</a></p>\n</li>\n</ul>\n</div>","excerpt":"✍️ Today I Learned Sequelize ORM을 사용하며 가장 편리한 점을 꼽는다면 마이그레이션을 선택할 것 같다. 운영중인 서비스 중단없이 DB 스키마 모델을 변경한다던가 서비스 기획 및 설계단계에서 놓친 점을 나중에 추가할 때 DB를 갈아엎지 않고 수정할 수 있는 기능을 제공하는 마이그레이션은 써본 사람만 알 것이다. 다만 스키마 수정이 필요한 경우가 많이 발생하지 않기 때문에 사용빈도가 많지가 않았다. 익숙치 않은 문법이기 때문에 매번 사용할 때 마다 검색을 통하여 사용하였는데, 이참에 블로그에 학습한 내용을 정리해서 내가 보려고 남겨본다. 1. Migration  공식문서에서는 마이그레이션을 다음과 같이 설명하고 있다. Just like you use version control systems such as Git to manage changes in your source code, you can use migrations to keep track of chang…","frontmatter":{"date":"February 11, 2022","title":"Sequelize Migration","categories":"TIL","author":"JH8459","emoji":"📚"},"fields":{"slug":"/2022-02-11-TIL/"}},"next":{"id":"7cd24c2e-a6bb-5cb7-9fe9-94ec10ca2c45","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBA//EABYBAQEBAAAAAAAAAAAAAAAAAAQAAf/aAAwDAQACEAMQAAAB71JJTVn/xAAWEAEBAQAAAAAAAAAAAAAAAAARACD/2gAIAQEAAQUCgz//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAEBAQAAAAAAAAAAAAAAAABBACD/2gAIAQEABj8CIz//xAAcEAACAgIDAAAAAAAAAAAAAAAAARExEEFRcZH/2gAIAQEAAT8hvadslZ+iyCFxj//aAAwDAQACAAMAAAAQsy//xAAWEQEBAQAAAAAAAAAAAAAAAAABEFH/2gAIAQMBAT8QEyf/xAAXEQADAQAAAAAAAAAAAAAAAAABEBFR/9oACAECAQE/EIdX/8QAHBABAAEFAQEAAAAAAAAAAAAAASEAETFBgRBh/9oACAEBAAE/EAW2tW2x52mcszEyhBcEHTSHIPKzQn55/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"github-blog.png\"\n        title=\"github-blog.png\"\n        src=\"/static/0da0186f8f100aaab0baf6a925d3285a/80e3c/PROJECT.jpg\"\n        srcset=\"/static/0da0186f8f100aaab0baf6a925d3285a/4ec73/PROJECT.jpg 180w,\n/static/0da0186f8f100aaab0baf6a925d3285a/158ba/PROJECT.jpg 360w,\n/static/0da0186f8f100aaab0baf6a925d3285a/80e3c/PROJECT.jpg 720w,\n/static/0da0186f8f100aaab0baf6a925d3285a/280b9/PROJECT.jpg 905w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<h2 id=\"️-refactoring\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-refactoring\" aria-label=\"️ refactoring permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⚒️ Refactoring</h2>\n<ul>\n<li>\n<p>어제 발생한 <code class=\"language-text\">code: 'ERR_HTTP_HEADERS_SENT</code> 에러는 <code class=\"language-text\">userAuth</code> 미들웨어 함수를 수정하여 핸들링하였다.</p>\n<p>오늘은 전반적으로 유효하지 않은 로그인 상태를 검증하여 메인페이지로 이동 후 로그인을 유도하는 방향으로 프로젝트를 리팩토링해볼 예정이다.</p>\n</li>\n</ul>\n<br>\n<br>\n<h3 id=\"1-문제점\" style=\"position:relative;\"><a href=\"#1-%EB%AC%B8%EC%A0%9C%EC%A0%90\" aria-label=\"1 문제점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 문제점</h3>\n<hr>\n<ul>\n<li>\n<p>현재 ALL-CON 프로젝트는 로그인중 웹 브라우저 쿠키가 삭제되거나 쿠키의 유효기간이 지난 이후에도 로그인을 계속 하고 있다면, 로그인이 필요한 API 요청을 시도시 <code class=\"language-text\">Server Error</code>만 반환하고 자동으로 로그아웃 처리가 된다던지, 페이지가 이동한다던지의 상태변화는 이뤄지지 않는다.</p>\n<p>이렇게 서비스가 유지가 된다면 이용자가 직접 유효하지 않은 로그인 상태를 감지하기는 어려우니 당연히 ALL-CON 서버 측의 문제가 있다고 생각이 들것이다.</p>\n<p>만약 유효하지 않는 로그인 정보로 로그인 검증이 필요한 API 요청 사용시에는 메인페이지로 강제로 이동 시키며, 로그인을 유도하는 방면으로 프로젝트를 리팩토링 해 볼 예정이다.</p>\n</li>\n</ul>\n<br>\n<br>\n<h3 id=\"2-문제-해결\" style=\"position:relative;\"><a href=\"#2-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0\" aria-label=\"2 문제 해결 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 문제 해결</h3>\n<h4 id=\"2-1-loginredirect-모듈-생성\" style=\"position:relative;\"><a href=\"#2-1-loginredirect-%EB%AA%A8%EB%93%88-%EC%83%9D%EC%84%B1\" aria-label=\"2 1 loginredirect 모듈 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-1. LoginRedirect 모듈 생성</h4>\n<hr>\n<ul>\n<li>\n<p>우선 <code class=\"language-text\">LoginRedirect</code> 모듈을 만들었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/* Store import */</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> RootState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../index'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> logout<span class=\"token punctuation\">,</span> getUserInfo <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../store/AuthSlice'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">/* 생략 */</span>\n<span class=\"token comment\">/* Library import */</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useDispatch<span class=\"token punctuation\">,</span> useSelector <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-redux'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useNavigate <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-router-dom'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">LoginRedirect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* dispatch &amp; navigate &amp; useLocation 선언 */</span>\n  <span class=\"token keyword\">const</span> dispatch <span class=\"token operator\">=</span> <span class=\"token function\">useDispatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> navigate <span class=\"token operator\">=</span> <span class=\"token function\">useNavigate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* useSelector */</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> isLoginCheck <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useSelector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">state</span><span class=\"token operator\">:</span> RootState</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> state<span class=\"token punctuation\">.</span>auth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* handler 함수 (기능별 정렬) */</span>\n  <span class=\"token comment\">// 메인페이지 리다이렉트 핸들러</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">goHomeHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* 메인페이지 상태 초기화 */</span>\n    <span class=\"token comment\">// 생략</span>\n    <span class=\"token comment\">/* 켜져있는 모달창 모두 종료 */</span>\n    <span class=\"token comment\">// 생략</span>\n    <span class=\"token comment\">/* 홈으로 이동 */</span>\n    <span class=\"token function\">navigate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/main'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// 로그인 상태 변경 핸들러</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">loginStateHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* 로그아웃 상태로 변경 &amp; 유저정보 상태 초기화 */</span>\n    <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">getUserInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">/* 로그인 모달창 팝업 */</span>\n    <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">showLoginModal</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isLoginCheck<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">goHomeHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 메인페이지로 이동</span>\n      <span class=\"token function\">loginStateHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 로그인 상태 변경 &amp; 로그인 모달창 팝업</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>isLoginCheck<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> LoginRedirect<span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>해당 모듈의 주된 기능은 두가지 함수로 만들어주었다.</p>\n<ul>\n<li>\n<p>메인페이지 상태 초기화 &#x26; 켜져있는 모든 모달창 종료이후 메인페이지로 이동하는 <code class=\"language-text\">goHomeHandler()</code> 함수</p>\n</li>\n<li>\n<p>로그인 상태 초기화, 로그인한 유저정보 초기화 이후 로그인 모달창 띄워 재 로그인 유도하는 <code class=\"language-text\">loginStateHandler()</code> 함수</p>\n</li>\n</ul>\n</li>\n</ul>\n<center><img src=\"https://user-images.githubusercontent.com/83164003/153373384-2d37e9d0-f59b-4c11-ad77-6981f3356d4e.png\"></center><br>\n<p><code class=\"language-text\">index.tsx</code>에 해당 컴포넌트를 불러와서 <code class=\"language-text\">isLoginCheck</code> 상태가 변동될때 마다 위 두 함수가 작동하게끔 만들어 주었다.</p>\n<br>\n<br>\n<h4 id=\"2-2-로그인-검증이-필요한-api-요청-아래-분기-처리\" style=\"position:relative;\"><a href=\"#2-2-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%EA%B2%80%EC%A6%9D%EC%9D%B4-%ED%95%84%EC%9A%94%ED%95%9C-api-%EC%9A%94%EC%B2%AD-%EC%95%84%EB%9E%98-%EB%B6%84%EA%B8%B0-%EC%B2%98%EB%A6%AC\" aria-label=\"2 2 로그인 검증이 필요한 api 요청 아래 분기 처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-2. 로그인 검증이 필요한 API 요청 아래 분기 처리</h4>\n<hr>\n<p><img src=\"https://user-images.githubusercontent.com/83164003/153373104-0149fc03-a438-4dde-9b37-0737a2f40f46.png\" alt=\"스크린샷, 2022-02-10 17-57-11\"></p>\n<ul>\n<li>로그인 검증이 필요한 API 요청 아래에 응답 결과값이 <strong>상태코드 200번 &#x26;&#x26; 에러메시지</strong>를 반환하면 유효하지 않는 로그인 상태이므로 위와 같이 분기처리를 한뒤, <code class=\"language-text\">isLoginCheck</code> 상태값을 바꿔주어 다시 렌더링 해주었다.</li>\n</ul>\n<br>\n<br>\n<h3 id=\"3-결과\" style=\"position:relative;\"><a href=\"#3-%EA%B2%B0%EA%B3%BC\" aria-label=\"3 결과 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 결과</h3>\n<hr>\n<ul>\n<li>\n<p>로그인 중 웹 브라우저 쿠키가 삭제되거나 쿠키 만료로 유효하지 않은 로그인 상태에서 마이페이지 진입하면 메인페이지로 이동 후 로그인 창 팝업</p>\n<p><img src=\"https://user-images.githubusercontent.com/83164003/153384029-7cff7cd8-a60a-43c9-9013-14c77c74e344.gif\" alt=\"gif\"></p>\n</li>\n<li>\n<p>로그인 중 웹 브라우저 쿠키가 삭제되거나 쿠키 만료로 유효하지 않은 로그인 상태에서 로그인 검증이 필요한 기능 수행시 (댓글 작성) 메인 페이지로 이동 후 로그인 창 팝업</p>\n<p><img src=\"https://user-images.githubusercontent.com/83164003/153384922-c0f2be81-9822-4e84-a643-68571d70451a.gif\" alt=\"gif2\"></p>\n</li>\n</ul>\n<br>\n<br>\n<hr>\n<ul>\n<li>\n<p>우선 메인페이지에서 보여지는 영역은 모두 처리하였다.</p>\n</li>\n<li>\n<p>다른 영역, 예를 들어 콘친찾기 글쓰기 중 쿠키가 만료되거나 사라지는 경우 등을 대처하기 위해서 내일은 사이트 전반적인 로그인 검증이 필요한 API 요청시 메인페이지로 강제 이동 &#x26; 로그인 재시도를 할 수 있게 끔 수정해볼 예정이다.</p>\n</li>\n</ul>\n<br>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EF%B8%8F-refactoring\">⚒️ Refactoring</a></p>\n<ul>\n<li>\n<p><a href=\"#1-%EB%AC%B8%EC%A0%9C%EC%A0%90\">1. 문제점</a></p>\n</li>\n<li>\n<p><a href=\"#2-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0\">2. 문제 해결</a></p>\n<ul>\n<li><a href=\"#2-1-loginredirect-%EB%AA%A8%EB%93%88-%EC%83%9D%EC%84%B1\">2-1. LoginRedirect 모듈 생성</a></li>\n<li><a href=\"#2-2-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%EA%B2%80%EC%A6%9D%EC%9D%B4-%ED%95%84%EC%9A%94%ED%95%9C-api-%EC%9A%94%EC%B2%AD-%EC%95%84%EB%9E%98-%EB%B6%84%EA%B8%B0-%EC%B2%98%EB%A6%AC\">2-2. 로그인 검증이 필요한 API 요청 아래 분기 처리</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#3-%EA%B2%B0%EA%B3%BC\">3. 결과</a></p>\n</li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"February 10, 2022","title":"ALL-CON Refactoring 4일차 - 유효하지 않은 로그인 상태 검증","categories":"Project","author":"JH8459","emoji":"🔥"},"fields":{"slug":"/2022-02-10-PROJECT/"}},"prev":{"id":"ff84e1b5-d08b-5106-965b-376196796e84","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBA//EABYBAQEBAAAAAAAAAAAAAAAAAAQAAf/aAAwDAQACEAMQAAAB71JJTVn/xAAWEAEBAQAAAAAAAAAAAAAAAAARACD/2gAIAQEAAQUCgz//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAEBAQAAAAAAAAAAAAAAAABBACD/2gAIAQEABj8CIz//xAAcEAACAgIDAAAAAAAAAAAAAAAAARExEEFRcZH/2gAIAQEAAT8hvadslZ+iyCFxj//aAAwDAQACAAMAAAAQsy//xAAWEQEBAQAAAAAAAAAAAAAAAAABEFH/2gAIAQMBAT8QEyf/xAAXEQADAQAAAAAAAAAAAAAAAAABEBFR/9oACAECAQE/EIdX/8QAHBABAAEFAQEAAAAAAAAAAAAAASEAETFBgRBh/9oACAEBAAE/EAW2tW2x52mcszEyhBcEHTSHIPKzQn55/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"github-blog.png\"\n        title=\"github-blog.png\"\n        src=\"/static/0da0186f8f100aaab0baf6a925d3285a/80e3c/PROJECT.jpg\"\n        srcset=\"/static/0da0186f8f100aaab0baf6a925d3285a/4ec73/PROJECT.jpg 180w,\n/static/0da0186f8f100aaab0baf6a925d3285a/158ba/PROJECT.jpg 360w,\n/static/0da0186f8f100aaab0baf6a925d3285a/80e3c/PROJECT.jpg 720w,\n/static/0da0186f8f100aaab0baf6a925d3285a/280b9/PROJECT.jpg 905w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<h2 id=\"️-refactoring\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-refactoring\" aria-label=\"️ refactoring permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>⚒️ Refactoring</h2>\n<ul>\n<li>\n<p>어제~오후까지 어제부터 이어온 Task인 로그인이 검증이 필요한 API 요청시 유효하지 않은 로그인 상태라면 메인페이지로 강제 이동 후 로그인 창 팝업으로 다시 로그인을 유도하는 로직으로 서버와 클라이언트를 다시 설계하였다.</p>\n</li>\n<li>\n<p>생각보다 로그인 검증이 필요한 API 요청이 많아서 작업시간이 오래걸렸다..</p>\n<ul>\n<li>\n<p><strong>===main page===</strong></p>\n<ul>\n<li>\n<p>알람 요청 : [post] concert/:concertid/alarm</p>\n</li>\n<li>\n<p>알람 취소 : [delete] concert/:concertid/alarm</p>\n</li>\n<li>\n<p>알람 조회 : [get] concert/alarm</p>\n</li>\n<li>\n<p>콘서트 댓글 작성 : [post] concert/:concertid/comment</p>\n</li>\n<li>\n<p>콘서트 댓글 수정 : [patch] concert/:concertid/comment/:commentid</p>\n</li>\n<li>\n<p>콘서트 댓글 삭제 : [delete] concert/:concertid/comment/:commentid</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<br>\n<br>\n<ul>\n<li>\n<p><strong>===concert page===</strong></p>\n<ul>\n<li>없음</li>\n</ul>\n</li>\n</ul>\n<br>\n<br>\n<ul>\n<li>\n<p><strong>===conchin page===</strong></p>\n<ul>\n<li>\n<p>게시글 작성 : [post] concert/:concertid/article</p>\n</li>\n<li>\n<p>게시글 수정 : [patch] concert/:concertid/article/:articleid</p>\n</li>\n<li>\n<p>게시글 삭제 : [delete] concert/:concertid/article/:articleid</p>\n</li>\n<li>\n<p>게시글 댓글 작성 : [post] concert/:concertid/article/:articleid/comment</p>\n</li>\n<li>\n<p>게시글 댓글 수정 : [patch] concert/:concertid/article/:articleid/comment/:commentid</p>\n</li>\n<li>\n<p>게시글 댓글 삭제 : [delete] concert/:concertid/article/:articleid/comment/:commentid</p>\n</li>\n</ul>\n</li>\n</ul>\n<br>\n<br>\n<ul>\n<li>\n<p><strong>===my page===</strong></p>\n<ul>\n<li>\n<p>마이페이지 진입 : [get] user/me</p>\n</li>\n<li>\n<p>개인정보 수정 : [patch] user/me</p>\n</li>\n<li>\n<p>닉네임 중복 확인 : [post] user/username</p>\n</li>\n<li>\n<p>프로필사진 수정 : [patch] user/picture</p>\n</li>\n<li>\n<p>콘친 인증 : [patch] user/safe</p>\n</li>\n<li>\n<p>콘친 인증코드 요청 : [post] user/safe</p>\n</li>\n<li>\n<p>콘친 인증코드 입력 : [post] user/safe/confirm</p>\n</li>\n<li>\n<p>회원탈퇴 : [delete] user/me</p>\n</li>\n<li>\n<p>내가 쓴 게시글 : [get] user/myarticle</p>\n</li>\n<li>\n<p>내가 쓴 댓글 : [get] user/mycomment</p>\n</li>\n</ul>\n</li>\n</ul>\n<br>\n<br>\n<h3 id=\"1-추가적인-보완이-필요한-사항\" style=\"position:relative;\"><a href=\"#1-%EC%B6%94%EA%B0%80%EC%A0%81%EC%9D%B8-%EB%B3%B4%EC%99%84%EC%9D%B4-%ED%95%84%EC%9A%94%ED%95%9C-%EC%82%AC%ED%95%AD\" aria-label=\"1 추가적인 보완이 필요한 사항 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 추가적인 보완이 필요한 사항</h3>\n<hr>\n<ul>\n<li>\n<p>클라이언트를 담당하는 팀원분께서 현재 ALL-CON 프로젝트 스키마를 수정해달라는 요청을 해주셨다.</p>\n<p>현재 콘친찾기 게시글 작성시 총 멤버수는 <code class=\"language-text\">2</code> 현재원 수는 <code class=\"language-text\">1</code>값으로 항상 고정을 해두었다.</p>\n<p>처음부터 멤버수를 고정하기보다는 게시글 작성때부터 유연하게 멤버수를 수정할 수 있게 스키마를 수정해달라는 요청을 해주셨다.</p>\n</li>\n<li>\n<p>사실 민감정보 암호화 리팩토링을 할 때도 <code class=\"language-text\">sequelize</code> 문법중 특정 컬럼만 추가하여 <code class=\"language-text\">migration</code>하는 방법도 열심히 구글링하여 찾아보았는데, 이번 스키마 구조 수정 후 자주쓰는 <code class=\"language-text\">sequelize</code> 문법은 다시 한번 복습할 겸 블로그에 학습한 내용을 남겨봐야겠다. <del>(매번 스키마 수정할 때마다 구글링 중..)</del></p>\n<p>우선 클라이언트를 담당하는 팀원분께서 요청한 부분은 다음과 같다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/83164003/153529646-275d910a-f7ee-43e2-8818-c2f2c9087961.png\" alt=\"스크린샷, 2022-02-11 11-09-59 (사본)\"></p>\n</li>\n<li>\n<p>해당 <code class=\"language-text\">Articles</code> 테이블 컬럼중 두가지값을 수정 요청하셨다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">member_count</code> 디폴트값 삭제</p>\n</li>\n<li>\n<p><code class=\"language-text\">total_member</code> 디폴트값 삭제</p>\n</li>\n</ul>\n</li>\n</ul>\n<br>\n<br>\n<h3 id=\"2-문제-해결\" style=\"position:relative;\"><a href=\"#2-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0\" aria-label=\"2 문제 해결 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 문제 해결</h3>\n<h4 id=\"2-1-sequelize-model-파일-스키마-수정\" style=\"position:relative;\"><a href=\"#2-1-sequelize-model-%ED%8C%8C%EC%9D%BC-%EC%8A%A4%ED%82%A4%EB%A7%88-%EC%88%98%EC%A0%95\" aria-label=\"2 1 sequelize model 파일 스키마 수정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-1. Sequelize Model 파일 스키마 수정</h4>\n<hr>\n<ul>\n<li>현재 <code class=\"language-text\">Articles</code> 테이블의 모델구조는 다음과 같다.</li>\n</ul>\n<center><img src=\"https://user-images.githubusercontent.com/83164003/153530343-c5bc09d9-9c91-4f8b-bb9b-56be132b2c22.png\"></center><br>\n<ul>\n<li>\n<p><code class=\"language-text\">member_count</code>와 <code class=\"language-text\">total_member</code> 컬럼은 <code class=\"language-text\">INTEGER</code> 타입의 데이터이며, <code class=\"language-text\">NULL</code>이 허용되지 않고 기본값들이 각각 <code class=\"language-text\">1</code>과 <code class=\"language-text\">2</code>로 설정이 되어 있다.</p>\n<p>아래와 같이 불필요한 데이터 속성들을 삭제했다.</p>\n</li>\n</ul>\n<center><img src=\"https://user-images.githubusercontent.com/83164003/153530565-8e3c1057-f48a-446a-b7eb-1afcf3531e53.png\"></center>\n<br>\n<br>\n<h4 id=\"2-2-changecolumn-함수로-컬럼-데이터-속성값-변경\" style=\"position:relative;\"><a href=\"#2-2-changecolumn-%ED%95%A8%EC%88%98%EB%A1%9C-%EC%BB%AC%EB%9F%BC-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%86%8D%EC%84%B1%EA%B0%92-%EB%B3%80%EA%B2%BD\" aria-label=\"2 2 changecolumn 함수로 컬럼 데이터 속성값 변경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-2. changeColumn() 함수로 컬럼 데이터 속성값 변경</h4>\n<hr>\n<ul>\n<li>\n<p>우선 아래 명령어로 migration 파일을 생성해 준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"># using npm\nnpx sequelize<span class=\"token operator\">-</span>cli migration<span class=\"token operator\">:</span>generate <span class=\"token operator\">--</span>name 생성할 migration 이름\n# using yarn\nyarn sequelize<span class=\"token operator\">-</span>cli migration<span class=\"token operator\">:</span>generate <span class=\"token operator\">--</span>name 생성할 migration 이름</code></pre></div>\n</li>\n<li>\n<p>그 뒤, 컬럼 안 데이터 속성값을 변경할 예정이기 때문에 <code class=\"language-text\">changeColumn()</code> 함수를 사용한다.</p>\n<p>함수의 사용 방법은 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// await queryInterface.changeColumn(테이블명, 컬럼명, {</span>\n<span class=\"token comment\">//  컬럼 데이터 속성,</span>\n<span class=\"token comment\">//  컬럼 옵션</span>\n<span class=\"token comment\">// })</span>\n\n<span class=\"token keyword\">await</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token function\">changeColumn</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Articles'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'member_count'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> Sequelize<span class=\"token punctuation\">.</span><span class=\"token constant\">INTEGER</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">defaultValue</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">allowNull</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>두가지 속성이 비동기로 처리되어야 하므로 아래와 같이 작성하였다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/83164003/153529840-83dcc0fa-af69-4442-9395-dbc371849e23.png\" alt=\"스크린샷, 2022-02-11 11-42-54\"></p>\n</li>\n</ul>\n<br>\n<br>\n<hr>\n<ul>\n<li>\n<p>해당 스키마 수정외에 <code class=\"language-text\">controller</code> 부분에서도 <code class=\"language-text\">member_count</code>와 <code class=\"language-text\">total_member</code>는 고정값이 DB에 저장되므로 따로 <code class=\"language-text\">req.body</code>로 입력값을 전달받아 DB에 저장하지 않는 구조였다.</p>\n<p>게시글 작성 <code class=\"language-text\">controller</code>까지 수정하여 게시글 작성시 멤버수를 유연하게 적용할 수 있게끔 리팩토링하였다.</p>\n</li>\n</ul>\n<br>\n<br>\n<h3 id=\"3-결과\" style=\"position:relative;\"><a href=\"#3-%EA%B2%B0%EA%B3%BC\" aria-label=\"3 결과 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 결과</h3>\n<hr>\n<ul>\n<li>\n<p><code class=\"language-text\">Articles</code> 테이블 스키마가 다음과같이 변경되었다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/83164003/153530932-c18c05a1-c469-413f-97da-62c00be542ea.png\" alt=\"스크린샷, 2022-02-11 11-09-59\"></p>\n<p>이제 게시글 최초 작성시에도 멤버수를 유연하게 적용하여 게시글 생성이 가능하다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/83164003/153531161-6c35922d-cdce-458d-ae93-04daa29ab5b9.gif\" alt=\"test\"></p>\n</li>\n</ul>\n<br>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EF%B8%8F-refactoring\">⚒️ Refactoring</a></p>\n<ul>\n<li>\n<p><a href=\"#1-%EC%B6%94%EA%B0%80%EC%A0%81%EC%9D%B8-%EB%B3%B4%EC%99%84%EC%9D%B4-%ED%95%84%EC%9A%94%ED%95%9C-%EC%82%AC%ED%95%AD\">1. 추가적인 보완이 필요한 사항</a></p>\n</li>\n<li>\n<p><a href=\"#2-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0\">2. 문제 해결</a></p>\n<ul>\n<li><a href=\"#2-1-sequelize-model-%ED%8C%8C%EC%9D%BC-%EC%8A%A4%ED%82%A4%EB%A7%88-%EC%88%98%EC%A0%95\">2-1. Sequelize Model 파일 스키마 수정</a></li>\n<li><a href=\"#2-2-changecolumn-%ED%95%A8%EC%88%98%EB%A1%9C-%EC%BB%AC%EB%9F%BC-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%86%8D%EC%84%B1%EA%B0%92-%EB%B3%80%EA%B2%BD\">2-2. changeColumn() 함수로 컬럼 데이터 속성값 변경</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#3-%EA%B2%B0%EA%B3%BC\">3. 결과</a></p>\n</li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"February 11, 2022","title":"ALL-CON Refactoring 5일차 - Articles 테이블 스키마 수정(1)","categories":"Project","author":"JH8459","emoji":"🔥"},"fields":{"slug":"/2022-02-11-PROJECT/"}},"site":{"siteMetadata":{"siteUrl":"https://blog.jh8459.com","comments":{"utterances":{"repo":"JH8459/JH8459.github.io"}}}}},"pageContext":{"slug":"/2022-02-11-TIL/","nextSlug":"/2022-02-10-PROJECT/","prevSlug":"/2022-02-11-PROJECT/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}