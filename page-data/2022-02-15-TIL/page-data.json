{"componentChunkName":"component---src-templates-blog-template-js","path":"/2022-02-15-TIL/","result":{"data":{"cur":{"id":"589205ab-8072-5967-9f2d-d0e7b3160121","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECA//EABUBAQEAAAAAAAAAAAAAAAAAAAAF/9oADAMBAAIQAxAAAAHSaSawD//EABYQAAMAAAAAAAAAAAAAAAAAAAABIP/aAAgBAQABBQIU/wD/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAAIDH/2gAIAQEABj8CIv8A/8QAGBAAAgMAAAAAAAAAAAAAAAAAAAERIDH/2gAIAQEAAT8hGb2Ff//aAAwDAQACAAMAAAAQHD//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAZEAACAwEAAAAAAAAAAAAAAAABEQAgQVH/2gAIAQEAAT8QjVhju1//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"github-blog.png\"\n        title=\"github-blog.png\"\n        src=\"/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/80e3c/TIL.jpg\"\n        srcset=\"/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/4ec73/TIL.jpg 180w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/158ba/TIL.jpg 360w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/80e3c/TIL.jpg 720w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/47311/TIL.jpg 1080w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/ac614/TIL.jpg 1272w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<h2 id=\"️-today-i-learned\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-today-i-learned\" aria-label=\"️ today i learned permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✍️ <strong>T</strong>oday <strong>I</strong> <strong>L</strong>earned</h2>\n<hr>\n<br>\n<ul>\n<li>\n<p>시퀄라이즈는 SQL문을 JavaScript 환경에서 객체로 작성할 수 있는 ORM(Object Relational Mapping)이다.</p>\n</li>\n<li>\n<p>여러 문법중 Op라는 연산자를 사용하는 문법에 대해 학습한 내용을 정리해 보았다.</p>\n</li>\n</ul>\n<br>\n<br>\n<h3 id=\"1-op\" style=\"position:relative;\"><a href=\"#1-op\" aria-label=\"1 op permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Op</h3>\n<hr>\n<ul>\n<li>\n<p>Op 연산자는 <code class=\"language-text\">where</code>객체 안에서 쓰이는 <a href=\"https://developer.mozilla.org/ko/docs/Glossary/Symbol\">Symbol</a> 타입의 연산자이다.</p>\n</li>\n<li>\n<p>해당 연산자를 사용하여 복잡한 비교 연산을 지원해준다.</p>\n</li>\n</ul>\n<br>\n<br>\n<h4 id=\"1-1-연산자일반\" style=\"position:relative;\"><a href=\"#1-1-%EC%97%B0%EC%82%B0%EC%9E%90%EC%9D%BC%EB%B0%98\" aria-label=\"1 1 연산자일반 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-1. 연산자(일반)</h4>\n<hr>\n<ul>\n<li>\n<p>공식문서에서 설명하는 연산자는 다음 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Logical operator</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>and<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">a</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">b</span><span class=\"token operator\">:</span> <span class=\"token number\">6</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// (a = 5) &amp;&amp; (b = 6)</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>or<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">a</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">b</span><span class=\"token operator\">:</span> <span class=\"token number\">6</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// (a = 5) || (b = 6)</span>\n\n<span class=\"token comment\">// Basics</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>eq<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// = 3</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>ne<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// != 20</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>is<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// IS NULL</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// IS NOT TRUE</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>or<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// (someAttribute = 5) OR (someAttribute = 6)</span>\n\n<span class=\"token comment\">// Using dialect specific column identifiers (PG in the following example):</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>col<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token string\">'user.organization_id'</span><span class=\"token punctuation\">,</span>        <span class=\"token comment\">// = \"user\".\"organization_id\"</span>\n\n<span class=\"token comment\">// Number comparisons</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>gt<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// > 6</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>gte<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// >= 6</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>lt<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// &lt; 10</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>lte<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// &lt;= 10</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>between<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// BETWEEN 6 AND 10</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>notBetween<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">11</span><span class=\"token punctuation\">,</span> <span class=\"token number\">15</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// NOT BETWEEN 11 AND 15</span>\n\n<span class=\"token comment\">// Other operators</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>all<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> sequelize<span class=\"token punctuation\">.</span><span class=\"token function\">literal</span><span class=\"token punctuation\">(</span><span class=\"token string\">'SELECT 1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// > ALL (SELECT 1)</span>\n\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// IN [1, 2]</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>notIn<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// NOT IN [1, 2]</span>\n\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>like<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token string\">'%hat'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// LIKE '%hat'</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>notLike<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token string\">'%hat'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// NOT LIKE '%hat'</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>startsWith<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token string\">'hat'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// LIKE 'hat%'</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>endsWith<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token string\">'hat'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// LIKE '%hat'</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>substring<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token string\">'hat'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// LIKE '%hat%'</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>iLike<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token string\">'%hat'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// ILIKE '%hat' (case insensitive) (PG only)</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>notILike<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token string\">'%hat'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// NOT ILIKE '%hat'  (PG only)</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>regexp<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token string\">'^[h|a|t]'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// REGEXP/~ '^[h|a|t]' (MySQL/PG only)</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>notRegexp<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token string\">'^[h|a|t]'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// NOT REGEXP/!~ '^[h|a|t]' (MySQL/PG only)</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>iRegexp<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token string\">'^[h|a|t]'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// ~* '^[h|a|t]' (PG only)</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>notIRegexp<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token string\">'^[h|a|t]'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// !~* '^[h|a|t]' (PG only)</span>\n\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>any<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// ANY ARRAY[2, 3]::INTEGER (PG only)</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>match<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> Sequelize<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token string\">'to_tsquery'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'fat &amp; rat'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// match text search for strings 'fat' and 'rat' (PG only)</span>\n\n<span class=\"token comment\">// In Postgres, Op.like/Op.iLike/Op.notLike can be combined to Op.any:</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>like<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>any<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'cat'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hat'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span>  <span class=\"token comment\">// LIKE ANY ARRAY['cat', 'hat']</span></code></pre></div>\n</li>\n</ul>\n<br>\n<br>\n<h4 id=\"1-2-연산자범위\" style=\"position:relative;\"><a href=\"#1-2-%EC%97%B0%EC%82%B0%EC%9E%90%EB%B2%94%EC%9C%84\" aria-label=\"1 2 연산자범위 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-2. 연산자(범위)</h4>\n<hr>\n<ul>\n<li>\n<p>범위 연산자 또한 지원하여 다양한 종류의 범위를 쿼리할 수 있다.</p>\n</li>\n<li>\n<p>공식문서에서 설명하는 범위 연산자는 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>contains<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>            <span class=\"token comment\">// @> '2'::integer  (PG range contains element operator)</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>contains<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>       <span class=\"token comment\">// @> [1, 2)        (PG range contains range operator)</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>contained<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>      <span class=\"token comment\">// &lt;@ [1, 2)        (PG range is contained by operator)</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>overlap<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>        <span class=\"token comment\">// &amp;&amp; [1, 2)        (PG range overlap (have points in common) operator)</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>adjacent<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>       <span class=\"token comment\">// -|- [1, 2)       (PG range is adjacent to operator)</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>strictLeft<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>     <span class=\"token comment\">// &lt;&lt; [1, 2)        (PG range strictly left of operator)</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>strictRight<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>    <span class=\"token comment\">// >> [1, 2)        (PG range strictly right of operator)</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>noExtendRight<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// &amp;&lt; [1, 2)        (PG range does not extend to the right of operator)</span>\n<span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>noExtendLeft<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>   <span class=\"token comment\">// &amp;> [1, 2)        (PG range does not extend to the left of operator)</span></code></pre></div>\n</li>\n</ul>\n<br>\n<br>\n<h4 id=\"1-3-연산자-조합\" style=\"position:relative;\"><a href=\"#1-3-%EC%97%B0%EC%82%B0%EC%9E%90-%EC%A1%B0%ED%95%A9\" aria-label=\"1 3 연산자 조합 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-3. 연산자 조합</h4>\n<hr>\n<ul>\n<li>\n<p><code class=\"language-text\">where</code> 조건 객체에서 연산자들끼리의 중복 사용또한 가능하다.</p>\n</li>\n<li>\n<p>조건 객체에서 별 다른 연산자로 엮어주지 않고 속성을 나열한다면 AND로 간주된다.</p>\n</li>\n<li>\n<p>연산자안에서 여러 컬럼을 다루는 경우에는 각 컬럼에 대한 조건을 담은 객체의 배열로 작성해야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> Op <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sequelize\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nFoo<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">where</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">rank</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>or<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>lt<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>eq<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// rank &lt; 1000 OR rank IS NULL</span>\n\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">createdAt</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>lt<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>gt<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">24</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// createdAt &lt; [timestamp] AND createdAt > [timestamp]</span>\n\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>or<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>like<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token string\">'Boat%'</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token punctuation\">[</span>Op<span class=\"token punctuation\">.</span>like<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token string\">'%boat%'</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// title LIKE 'Boat%' OR description LIKE '%boat%'</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n<br>\n<br>\n<h2 id=\"-understanding\" style=\"position:relative;\"><a href=\"#-understanding\" aria-label=\" understanding permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🤔 Understanding</h2>\n<hr>\n<ul>\n<li>\n<p><del>항상 느끼지만 시퀄라이즈 공식문서는 너무 불친절..</del></p>\n</li>\n<li>\n<p>공식문서에서는 자세한 사용 방식을 안내하기보다는 다양한 예시를 제공해 준 뒤, 이에 맞춰 사용자가 찾아서 써라(?)라는 느낌을 많이 받았다.</p>\n</li>\n<li>\n<p>매번 <code class=\"language-text\">ctril + f</code> 로 검색하여 찾아 쓰기 귀찮아서 정리해보았다.</p>\n</li>\n</ul>\n<br>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EF%B8%8F-today-i-learned\">✍️ <strong>T</strong>oday <strong>I</strong> <strong>L</strong>earned</a></p>\n<ul>\n<li>\n<p><a href=\"#1-op\">1. Op</a></p>\n<ul>\n<li><a href=\"#1-1-%EC%97%B0%EC%82%B0%EC%9E%90%EC%9D%BC%EB%B0%98\">1-1. 연산자(일반)</a></li>\n<li><a href=\"#1-2-%EC%97%B0%EC%82%B0%EC%9E%90%EB%B2%94%EC%9C%84\">1-2. 연산자(범위)</a></li>\n<li><a href=\"#1-3-%EC%97%B0%EC%82%B0%EC%9E%90-%EC%A1%B0%ED%95%A9\">1-3. 연산자 조합</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-understanding\">🤔 Understanding</a></p>\n</li>\n</ul>\n</div>","excerpt":"✍️ Today I Learned 시퀄라이즈는 SQL문을 JavaScript 환경에서 객체로 작성할 수 있는 ORM(Object Relational Mapping)이다. 여러 문법중 Op라는 연산자를 사용하는 문법에 대해 학습한 내용을 정리해 보았다. 1. Op Op 연산자는 객체 안에서 쓰이는 Symbol 타입의 연산자이다. 해당 연산자를 사용하여 복잡한 비교 연산을 지원해준다. 1-1. 연산자(일반) 공식문서에서 설명하는 연산자는 다음 아래와 같다. 1-2. 연산자(범위) 범위 연산자 또한 지원하여 다양한 종류의 범위를 쿼리할 수 있다. 공식문서에서 설명하는 범위 연산자는 아래와 같다. 1-3. 연산자 조합  조건 객체에서 연산자들끼리의 중복 사용또한 가능하다. 조건 객체에서 별 다른 연산자로 엮어주지 않고 속성을 나열한다면 AND로 간주된다. 연산자안에서 여러 컬럼을 다루는 경우에는 각 컬럼에 대한 조건을 담은 객체의 배열로 작성해야 한다. 🤔 Understanding 항상 느…","frontmatter":{"date":"February 15, 2022","title":"Sequelize Op","categories":"TIL","author":"JH8459","emoji":"📚"},"fields":{"slug":"/2022-02-15-TIL/"}},"next":{"id":"49d1b001-980b-5003-a133-e5057dbc49e6","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECA//EABUBAQEAAAAAAAAAAAAAAAAAAAAF/9oADAMBAAIQAxAAAAHSaSawD//EABYQAAMAAAAAAAAAAAAAAAAAAAABIP/aAAgBAQABBQIU/wD/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAAIDH/2gAIAQEABj8CIv8A/8QAGBAAAgMAAAAAAAAAAAAAAAAAAAERIDH/2gAIAQEAAT8hGb2Ff//aAAwDAQACAAMAAAAQHD//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAZEAACAwEAAAAAAAAAAAAAAAABEQAgQVH/2gAIAQEAAT8QjVhju1//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"github-blog.png\"\n        title=\"github-blog.png\"\n        src=\"/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/80e3c/TIL.jpg\"\n        srcset=\"/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/4ec73/TIL.jpg 180w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/158ba/TIL.jpg 360w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/80e3c/TIL.jpg 720w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/47311/TIL.jpg 1080w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/ac614/TIL.jpg 1272w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<h2 id=\"️-today-i-learned\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-today-i-learned\" aria-label=\"️ today i learned permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✍️ <strong>T</strong>oday <strong>I</strong> <strong>L</strong>earned</h2>\n<hr>\n<br>\n<ul>\n<li>\n<p>Sequelize ORM을 사용하며 가장 편리한 점을 꼽는다면 마이그레이션을 선택할 것 같다.</p>\n</li>\n<li>\n<p>운영중인 서비스 중단없이 DB 스키마 모델을 변경한다던가 서비스 기획 및 설계단계에서 놓친 점을 나중에 추가할 때 DB를 갈아엎지 않고 수정할 수 있는 기능을 제공하는 마이그레이션은 써본 사람만 알 것이다.</p>\n</li>\n<li>\n<p>다만 스키마 수정이 필요한 경우가 많이 발생하지 않기 때문에 사용빈도가 많지가 않았다.</p>\n<p>익숙치 않은 문법이기 때문에 매번 사용할 때 마다 검색을 통하여 사용하였는데, 이참에 블로그에 학습한 내용을 정리해서 내가 보려고 남겨본다.</p>\n</li>\n</ul>\n<br>\n<br>\n<h3 id=\"1-migration\" style=\"position:relative;\"><a href=\"#1-migration\" aria-label=\"1 migration permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Migration</h3>\n<hr>\n<ul>\n<li>\n<p><code class=\"language-text\">Sequelize</code> 공식문서에서는 마이그레이션을 다음과 같이 설명하고 있다.</p>\n<blockquote>\n<p>Just like you use <strong>version control</strong> systems such as <strong>Git</strong> to manage changes in your source code, you can use <strong>migrations</strong> to keep track of changes to the database. With migrations you can transfer your existing database into another state and vice versa: Those state transitions are saved in migration files, which describe how to get to the new state and how to revert the changes in order to get back to the old state.</p>\n</blockquote>\n</li>\n<li>\n<p>간단히 설명하자면 <strong>마이그레이션</strong>은 Git과 같은 버전 컨트롤 시스템으로써, 이를 데이터베이스에 적용하며 지원해준다.</p>\n<p>즉, 마이그레이션은 데이터베이스의 수정및 롤백을 버전 컨트롤 시스템 처럼 이용할 수 있게끔 지원하는 강력한 기능이다.</p>\n</li>\n<li>\n<p>마이그레이션을 이용하기전 Sequelize CLI가 필요하다. CLI는 마이그레이션과 프로젝트 부트스트랩 지원을 제공하며 이를 설치한 환경이라는 가정하에 글을 남긴다.</p>\n</li>\n</ul>\n<br>\n<br>\n<h4 id=\"1-1-migration-생성\" style=\"position:relative;\"><a href=\"#1-1-migration-%EC%83%9D%EC%84%B1\" aria-label=\"1 1 migration 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-1. Migration 생성</h4>\n<hr>\n<ul>\n<li>\n<p>마이그레이션은 필요할 때마다 생성할 수 있다.</p>\n<p>스키마에 변경이 필요할 때(컬럼을 추가하거나, 기존 컬럼의 데이터 속성값을 변경할 때)마다 <code class=\"language-text\">migration.js</code> 파일을 생성하여 진행하는 것이다.</p>\n</li>\n<li>\n<p>우선 마이그레이션을 생성하는 명령어는 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"># using npm\nnpx sequelize<span class=\"token operator\">-</span>cli migration<span class=\"token operator\">:</span>generate <span class=\"token operator\">--</span>name 생성할 migration 이름\n# using yarn\nyarn sequelize<span class=\"token operator\">-</span>cli migration<span class=\"token operator\">:</span>generate <span class=\"token operator\">--</span>name 생성할 migration 이름</code></pre></div>\n<p>마이그레이션 파일을 보고 어떤 기능을 하는 코드인지 유추할 수 있을만한 이름만 입력해주면 생성이 된다.</p>\n<ul>\n<li>명령어를 입력시 아래와 같은 템플릿 코드가 제공이 된다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">up</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">queryInterface<span class=\"token punctuation\">,</span> Sequelize</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * Add altering commands here.\n     *\n     * Example:\n     * await queryInterface.createTable('users', { id: Sequelize.INTEGER });\n     */</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function-variable function\">down</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">queryInterface<span class=\"token punctuation\">,</span> Sequelize</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * Add reverting commands here.\n     *\n     * Example:\n     * await queryInterface.dropTable('users');\n     */</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">up</code>은 마이그레이션을 담당하고 있으며, <code class=\"language-text\">down</code>은 <code class=\"language-text\">undo</code> 기능(롤백)을 담당하고 있다.</p>\n</li>\n<li>\n<p>다음은 기능별로 함수들을 묶어 정리하였다.</p>\n</li>\n</ul>\n<br>\n<br>\n<h4 id=\"1-2-테이블을-새로-생성하거나-기존-테이블을-지워야-할-때\" style=\"position:relative;\"><a href=\"#1-2-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%84-%EC%83%88%EB%A1%9C-%EC%83%9D%EC%84%B1%ED%95%98%EA%B1%B0%EB%82%98-%EA%B8%B0%EC%A1%B4-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%84-%EC%A7%80%EC%9B%8C%EC%95%BC-%ED%95%A0-%EB%95%8C\" aria-label=\"1 2 테이블을 새로 생성하거나 기존 테이블을 지워야 할 때 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-2. 테이블을 새로 생성하거나 기존 테이블을 지워야 할 때</h4>\n<hr>\n<ul>\n<li>\n<p>우선 테이블을 생성할 때는 아래의 함수를 사용한다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">createTable()</code></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// await queryInterface.createTable('테이블명', 컬럼명: {데이터 속성, 옵션}...);</span>\n\n<span class=\"token keyword\">await</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token function\">createTable</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Users'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> Sequelize<span class=\"token punctuation\">.</span><span class=\"token constant\">INTEGER</span>\n    <span class=\"token literal-property property\">autoIncrement</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">allowNull</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">primaryKey</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">username</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> Sequelize<span class=\"token punctuation\">.</span><span class=\"token constant\">STRING</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">allowNull</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>그리고 테이블을 삭제할 때는 아래의 함수를 사용한다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">dropTable()</code></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// await queryInterface.createTable('테이블명');</span>\n\n<span class=\"token keyword\">await</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token function\">dropTable</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Users'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<br>\n<br>\n<h4 id=\"1-3-테이블에-새로운-컬럼을-추가하거나-기존의-컬럼을-삭제할-때\" style=\"position:relative;\"><a href=\"#1-3-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%97%90-%EC%83%88%EB%A1%9C%EC%9A%B4-%EC%BB%AC%EB%9F%BC%EC%9D%84-%EC%B6%94%EA%B0%80%ED%95%98%EA%B1%B0%EB%82%98-%EA%B8%B0%EC%A1%B4%EC%9D%98-%EC%BB%AC%EB%9F%BC%EC%9D%84-%EC%82%AD%EC%A0%9C%ED%95%A0-%EB%95%8C\" aria-label=\"1 3 테이블에 새로운 컬럼을 추가하거나 기존의 컬럼을 삭제할 때 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-3. 테이블에 새로운 컬럼을 추가하거나 기존의 컬럼을 삭제할 때</h4>\n<hr>\n<ul>\n<li>\n<p>우선 테이블에 새로운 컬럼을 추가할 때는 아래의 함수를 사용한다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">addColumn()</code></p>\n<p><code class=\"language-text\">Users</code> 테이블에 <code class=\"language-text\">role</code> 컬럼 추가 (데이터 속성은 <code class=\"language-text\">Integer</code>, <code class=\"language-text\">null</code>을 허용하지 않으며 기본값은 <code class=\"language-text\">1</code>)</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// await queryInterface.addColumn('테이블명', '컬럼명', {데이터 속성,옵션...});</span>\n\n<span class=\"token keyword\">await</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token function\">addColumn</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Users'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'role'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> Sequelize<span class=\"token punctuation\">.</span><span class=\"token constant\">INTEGER</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">allowNull</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">defaltValues</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>그리고 기존의 컬럼을 삭제할 때는 아래의 함수를 사용한다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">removeColumn()</code></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// await queryInterface.removeColumn('테이블명', '컬럼명');</span>\n\n<span class=\"token keyword\">await</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token function\">removeColumn</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Users'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'role'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<br>\n<br>\n<h4 id=\"1-4-기존-컬럼의-이름-변경할-때\" style=\"position:relative;\"><a href=\"#1-4-%EA%B8%B0%EC%A1%B4-%EC%BB%AC%EB%9F%BC%EC%9D%98-%EC%9D%B4%EB%A6%84-%EB%B3%80%EA%B2%BD%ED%95%A0-%EB%95%8C\" aria-label=\"1 4 기존 컬럼의 이름 변경할 때 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-4. 기존 컬럼의 이름 변경할 때</h4>\n<hr>\n<ul>\n<li>\n<p>테이블에 있는 기존 컬럼의 이름을 변경할 땐 아래의 함수를 사용한다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">renameColumn()</code></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// await queryInterface.renameColumn('테이블명', '컬럼명', '변경할 컬럼명');</span>\n\n<span class=\"token keyword\">await</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token function\">renameColumn</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Users'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'role'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'userRole'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<br>\n<br>\n<h4 id=\"1-5-기존-컬럼의-데이터-속성-및-옵션값-변경\" style=\"position:relative;\"><a href=\"#1-5-%EA%B8%B0%EC%A1%B4-%EC%BB%AC%EB%9F%BC%EC%9D%98-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%86%8D%EC%84%B1-%EB%B0%8F-%EC%98%B5%EC%85%98%EA%B0%92-%EB%B3%80%EA%B2%BD\" aria-label=\"1 5 기존 컬럼의 데이터 속성 및 옵션값 변경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-5. 기존 컬럼의 데이터 속성 및 옵션값 변경</h4>\n<hr>\n<ul>\n<li>\n<p>테이블에 있는 기존 컬럼의 이름을 변경할 땐 아래의 함수를 사용한다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">changeColumn()</code></p>\n<p><code class=\"language-text\">Users</code> 테이블에 <code class=\"language-text\">userRole</code> 컬럼 속성 변경 (데이터 속성은 <code class=\"language-text\">STRING</code>, 기본값은 <code class=\"language-text\">normal</code>)</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// await queryInterface.changeColumn('테이블명', '컬럼명', {데이터 속성, 옵션});</span>\n\n<span class=\"token keyword\">await</span> queryInterface<span class=\"token punctuation\">.</span><span class=\"token function\">changeColumn</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Users'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'userRole'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> Sequelize<span class=\"token punctuation\">.</span><span class=\"token constant\">STRING</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">defaltValues</span><span class=\"token operator\">:</span> <span class=\"token string\">'normal'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<br>\n<br>\n<h4 id=\"1-6-migration-실행과-롤백\" style=\"position:relative;\"><a href=\"#1-6-migration-%EC%8B%A4%ED%96%89%EA%B3%BC-%EB%A1%A4%EB%B0%B1\" aria-label=\"1 6 migration 실행과 롤백 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-6. Migration 실행과 롤백</h4>\n<hr>\n<ul>\n<li>\n<p>각각 필요한 기능을 <code class=\"language-text\">up()</code>과 <code class=\"language-text\">down()</code> 기능에 적절히 넣어두면 명령어를 통해 사용이 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"># using npm\nnpx sequelize<span class=\"token operator\">-</span>cli db<span class=\"token operator\">:</span>migrate\n# using yarn\nyarn sequelize<span class=\"token operator\">-</span>cli db<span class=\"token operator\">:</span>migrate</code></pre></div>\n</li>\n<li>\n<p>위 명령어를 통해 마이그레이션을 실행 할 수 있으며 롤백 또한 아래의 코드를 이용하여 사용이 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"># using npm\nnpx sequelize<span class=\"token operator\">-</span>cli db<span class=\"token operator\">:</span>migrate<span class=\"token operator\">:</span>undo\n# using yarn\nyarn sequelize<span class=\"token operator\">-</span>cli db<span class=\"token operator\">:</span>migrate<span class=\"token operator\">:</span>undo</code></pre></div>\n</li>\n</ul>\n<br>\n<br>\n<h2 id=\"-understanding\" style=\"position:relative;\"><a href=\"#-understanding\" aria-label=\" understanding permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🤔 Understanding</h2>\n<hr>\n<ul>\n<li>\n<p>서비스를 멈추거나 DB를 모두 삭제 후 스키마를 수정을 해야하는 번거로움 없이 <code class=\"language-text\">Sequelize</code> Migration은 DB 스키마 수정을 간편하게 도와준다.</p>\n</li>\n<li>\n<p>혹시 예상치 못한 스키마 수정결과가 일어나도 Git과 같이 <strong>버전 관리</strong> 기능이 있기 때문에 롤백또한 쉽게 가능하다.</p>\n<p>위 명령어들은 솔직히 자주 쓰지 못했기 때문에 매번 쓸 때마다 검색에 검색을 거듭해서 사용하곤 했었다.</p>\n<p>글로 정리하며 조금 머릿속에서 정리된 기분이다.</p>\n</li>\n</ul>\n<br>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EF%B8%8F-today-i-learned\">✍️ <strong>T</strong>oday <strong>I</strong> <strong>L</strong>earned</a></p>\n<ul>\n<li>\n<p><a href=\"#1-migration\">1. Migration</a></p>\n<ul>\n<li><a href=\"#1-1-migration-%EC%83%9D%EC%84%B1\">1-1. Migration 생성</a></li>\n<li><a href=\"#1-2-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%84-%EC%83%88%EB%A1%9C-%EC%83%9D%EC%84%B1%ED%95%98%EA%B1%B0%EB%82%98-%EA%B8%B0%EC%A1%B4-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%84-%EC%A7%80%EC%9B%8C%EC%95%BC-%ED%95%A0-%EB%95%8C\">1-2. 테이블을 새로 생성하거나 기존 테이블을 지워야 할 때</a></li>\n<li><a href=\"#1-3-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%97%90-%EC%83%88%EB%A1%9C%EC%9A%B4-%EC%BB%AC%EB%9F%BC%EC%9D%84-%EC%B6%94%EA%B0%80%ED%95%98%EA%B1%B0%EB%82%98-%EA%B8%B0%EC%A1%B4%EC%9D%98-%EC%BB%AC%EB%9F%BC%EC%9D%84-%EC%82%AD%EC%A0%9C%ED%95%A0-%EB%95%8C\">1-3. 테이블에 새로운 컬럼을 추가하거나 기존의 컬럼을 삭제할 때</a></li>\n<li><a href=\"#1-4-%EA%B8%B0%EC%A1%B4-%EC%BB%AC%EB%9F%BC%EC%9D%98-%EC%9D%B4%EB%A6%84-%EB%B3%80%EA%B2%BD%ED%95%A0-%EB%95%8C\">1-4. 기존 컬럼의 이름 변경할 때</a></li>\n<li><a href=\"#1-5-%EA%B8%B0%EC%A1%B4-%EC%BB%AC%EB%9F%BC%EC%9D%98-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%86%8D%EC%84%B1-%EB%B0%8F-%EC%98%B5%EC%85%98%EA%B0%92-%EB%B3%80%EA%B2%BD\">1-5. 기존 컬럼의 데이터 속성 및 옵션값 변경</a></li>\n<li><a href=\"#1-6-migration-%EC%8B%A4%ED%96%89%EA%B3%BC-%EB%A1%A4%EB%B0%B1\">1-6. Migration 실행과 롤백</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-understanding\">🤔 Understanding</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"February 11, 2022","title":"Sequelize Migration","categories":"TIL","author":"JH8459","emoji":"📚"},"fields":{"slug":"/2022-02-11-TIL/"}},"prev":{"id":"99f0bf24-ac4a-5c15-bad3-d9b05e761bed","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECA//EABUBAQEAAAAAAAAAAAAAAAAAAAAF/9oADAMBAAIQAxAAAAHSaSawD//EABYQAAMAAAAAAAAAAAAAAAAAAAABIP/aAAgBAQABBQIU/wD/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAAIDH/2gAIAQEABj8CIv8A/8QAGBAAAgMAAAAAAAAAAAAAAAAAAAERIDH/2gAIAQEAAT8hGb2Ff//aAAwDAQACAAMAAAAQHD//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAZEAACAwEAAAAAAAAAAAAAAAABEQAgQVH/2gAIAQEAAT8QjVhju1//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"github-blog.png\"\n        title=\"github-blog.png\"\n        src=\"/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/80e3c/TIL.jpg\"\n        srcset=\"/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/4ec73/TIL.jpg 180w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/158ba/TIL.jpg 360w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/80e3c/TIL.jpg 720w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/47311/TIL.jpg 1080w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/ac614/TIL.jpg 1272w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<h2 id=\"️-today-i-learned\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-today-i-learned\" aria-label=\"️ today i learned permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✍️ <strong>T</strong>oday <strong>I</strong> <strong>L</strong>earned</h2>\n<hr>\n<br>\n<ul>\n<li>\n<p>프로젝트들을 진행하며 대용량 서비스를 염두하고 서버를 개발해본 경험이 아직없다.</p>\n</li>\n<li>\n<p>Node.js 기반의 웹 서버 사용시 트래픽이 많아지는 경우 서버에 걸리는 과부하에 대응 하는 방법들을 학습해 보고 글로 남겨보려 한다.</p>\n</li>\n<li>\n<p>우선 Node.js 환경 뿐 아니라 대개의 서버는 중앙 집중형태로 다수의 클라이언트를 위해 존재한다.</p>\n<p><img src=\"https://user-images.githubusercontent.com/83164003/157154569-5c971607-3357-424a-a2d4-e4511c353ecf.png\" alt=\"server\"></p>\n</li>\n</ul>\n<br>\n<br>\n<ul>\n<li>때문에 클라이언트로부터 수많은 요청을 동시에 받으므로 병목현상이 발생하기 쉬우며 이를 대비해 처리 성능에 항상 주목해야 한다.</li>\n</ul>\n<br>\n<br>\n<h3 id=\"1-nodejs의-비동기-처리\" style=\"position:relative;\"><a href=\"#1-nodejs%EC%9D%98-%EB%B9%84%EB%8F%99%EA%B8%B0-%EC%B2%98%EB%A6%AC\" aria-label=\"1 nodejs의 비동기 처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Node.js의 비동기 처리</h3>\n<hr>\n<ul>\n<li>\n<p>Node.js는 비동기 IO를 지원하며 싱글 쓰레드 기반으로 동작하는 서버이다. <del>(여기서 비동기 처리란? 어떤 코드의 출력이 끝날 때까지 기다려주지 않고 다른 코드를 먼저 실행하는 방식이다.)</del></p>\n<p><img src=\"https://user-images.githubusercontent.com/83164003/157156519-26f217ba-ac29-4128-b318-552f94239f73.png\" alt=\"eventloop\"></p>\n<center><span style=\"font-size: 0.75em;\">출처 : <a href=\"https://www.nextree.co.kr/p7292/\" target=\"_blank\">넥스트리</a></span></center><br>\n</li>\n<li>\n<p>비동기 처리방식은 이벤트 방식으로 풀어낸다.</p>\n<p>클라이언트에서 발생된 요청을 처리하기 위해 이벤트가 발생하며, 서버 내부에 메시지 형태로 전달된다.</p>\n<p>이 메시지는 Event Loop에서 처리가 되며 서버는 다음 클라이언트 요청을 다시 받아들인다.</p>\n</li>\n<li>\n<p>Event Loop에서 요청 처리가 완료되면 CallBack을 호출하여 처리완료를 서버에 알려준다.</p>\n<p>이러한 이벤트 처리는 싱글 쓰레드 기반으로 Event Loop에서 처리되므로 Node.js는 싱글 쓰레드 기반으로 동작한다 일컫는다.</p>\n<p>즉, 클라이언트 요청은 하나의 쓰레드 안에서 처리된다.</p>\n</li>\n<li>\n<p>그래서 이벤트 호출 측면으로 본다면 비동기로 처리되지만 요청의 작업 단위가 프로세스를 크게 요구하는 요청일 경우에는 쓰레드 하나에서 해당 처리작업이 오래걸리므로 전체 서버 처리에 영향을 미치게된다. (이는 Node.js의 치명적인 약점이다.)</p>\n</li>\n<li>\n<p>따라서 Node.js의 Event Loop 처리 과정은 싱글 쓰레드 기반으로 작업이 처리가 되며, 클라이언트의 요청은 비동기 메시지로 처리된다.</p>\n</li>\n<li>\n<p>따라서 사용자는 반드시 처리 로직을 비동기로 구현해야 Node.js를 올바르게 활용하는 방법이며, 클라이언트가 요청하는 처리 작업 단위가 CPU를 많이 소모하지 않는 작업이라면 고효율 고성능을 보장해주지만 CPU를 많이 소모하는 작업이라면 Node.js는 알맞지 않은 서버일 수 있다.</p>\n</li>\n<li>\n<p>서비스에 알맞는 서버 환경을 구축하는게 바람직한 방향이다.</p>\n<blockquote>\n<p>PayPal, Netflix, LinkedIn, Groupon 등 전 세계적인 서비스에서 이미 Node.js를 사용하고 있다.</p>\n</blockquote>\n</li>\n</ul>\n<br>\n<br>\n<h3 id=\"2-트래픽이-많아지는-경우-분산처리\" style=\"position:relative;\"><a href=\"#2-%ED%8A%B8%EB%9E%98%ED%94%BD%EC%9D%B4-%EB%A7%8E%EC%95%84%EC%A7%80%EB%8A%94-%EA%B2%BD%EC%9A%B0-%EB%B6%84%EC%82%B0%EC%B2%98%EB%A6%AC\" aria-label=\"2 트래픽이 많아지는 경우 분산처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 트래픽이 많아지는 경우 분산처리</h3>\n<hr>\n<ul>\n<li>\n<p>위에서 언급했듯이 Node.js는 결국 싱글 쓰레드 기반으로 작업이 처리된다.</p>\n<p>아무리 클라이언트에서 많은 요청이 와도, Node.js는 싱글스레드를 통해서 이를 하나씩 처리한다. 때문에, 분산처리가 중요 할 수 밖에 없다.</p>\n</li>\n</ul>\n<br>\n<br>\n<h4 id=\"2-1-클라우드-서비스-환경에서-로드-밸런서-사용\" style=\"position:relative;\"><a href=\"#2-1-%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C-%EC%84%9C%EB%B9%84%EC%8A%A4-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C-%EB%A1%9C%EB%93%9C-%EB%B0%B8%EB%9F%B0%EC%84%9C-%EC%82%AC%EC%9A%A9\" aria-label=\"2 1 클라우드 서비스 환경에서 로드 밸런서 사용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-1. 클라우드 서비스 환경에서 로드 밸런서 사용</h4>\n<hr>\n<ul>\n<li>\n<p>AWS를 예로 들면, <em>로드밸런서</em> 는 분산 환경을 제공하여 단일 대역으로의 대용량 트래픽이 집중 라우팅되는 것을 방지할 수 있다.</p>\n<blockquote>\n<p><strong>로드 밸런서가 하는 일?</strong></p>\n<ol>\n<li>클라이언트의 요청을 여러 대의 서버로 분산시킨다.</li>\n<li>온라인 상태인 서버에만 요청을 전송하여 신뢰성과 고가용성을 준다.</li>\n<li>수요에 따라(요청의 양에 따라) 서버를 추가하거나 제거할 수 있는 유연성을 제공해준다.</li>\n</ol>\n<p>대게 로드 밸런서는 Round Robin 알고리즘을 이용하기 때문에 특별한 우선순위 없이 유저/클라이언트의 요청을 들어오는 순서대로 처리한다.</p>\n</blockquote>\n</li>\n<li>\n<p>클라우드 서비스를 이용할 경우 서버에 부하되는 환경을 고려하여 가상이미지로 서버환경을 만든다.</p>\n<p>이때 Auto Scaling을 통해 각각의 적절한 용량의 서버를 생성해주므로 트래픽이 많아져도 대응이 가능하다.</p>\n</li>\n</ul>\n<br>\n<br>\n<h4 id=\"2-2-캐싱\" style=\"position:relative;\"><a href=\"#2-2-%EC%BA%90%EC%8B%B1\" aria-label=\"2 2 캐싱 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-2. 캐싱</h4>\n<hr>\n<ul>\n<li>\n<p>클라이언트에서 자주 요청이되는 내용이 매번 서버를 거쳐 DB에 쿼리를 하는 것은 비효율적이다.</p>\n<p>DB에 있는 데이터에 접근할 때 발생하는 디스크 I/O 작업은 CPU를 상당히 많이 사용하기 때문이다.</p>\n</li>\n<li>\n<p>때문에 대용량 서비스를 고려한다면 캐싱은 반드시 이뤄져야 한다.</p>\n<p>Node.js에서는 <code class=\"language-text\">Redis</code>라던지 <code class=\"language-text\">lru-cache</code>같은 모듈을 이용하여 자주쓰이는 요청 결과값들을 메모리에 캐쉬해두고 사용할 수 있다.</p>\n<center><img src=\"https://user-images.githubusercontent.com/83164003/157170159-0af5c3a9-2077-4703-8b28-aeb9220a154f.png\"></center><br>\n</li>\n<li>\n<p>자주 요청이 들어오는 내용은 쿼리문을 거쳐 DB를 거쳐 답을 가져오지않고 응답속도가 빠른 곳에 캐싱해 두고 DB에 검색하기 전 해당 요청 내용이 캐시에 존재하는지 부터 검색해주기 때문에 서버의 CPU 사용량을 낮추는 결과를 가져온다.</p>\n</li>\n</ul>\n<br>\n<br>\n<h2 id=\"-understanding\" style=\"position:relative;\"><a href=\"#-understanding\" aria-label=\" understanding permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🤔 Understanding</h2>\n<hr>\n<ul>\n<li>\n<p>기본적인 내용만 우선 다루어보았다.</p>\n<p>실제 서비스되고 있는 여러 매체들은 더욱 더 다양한 방법으로 트래픽 처리를 시행하고 있다.</p>\n</li>\n<li>\n<p>앞으로 배워 나가야 할 부분들이 너무 많다는 점 만 새삼스레 느꼈다.</p>\n</li>\n<li>\n<p>국내 웹사이트중 트래픽이 많아 보이는 네이버 메인페이지 트래픽 처리를 어떻게 하는지 <del>(2018년도 글이긴하다..)</del> [참조 : <a href=\"https://d2.naver.com/helloworld/6070967\" target=\"_blank\">네이버 D2</a>] 좋은 글이 있어 링크를 남겨둔다.</p>\n<br>\n<br>\n</li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EF%B8%8F-today-i-learned\">✍️ <strong>T</strong>oday <strong>I</strong> <strong>L</strong>earned</a></p>\n<ul>\n<li>\n<p><a href=\"#1-nodejs%EC%9D%98-%EB%B9%84%EB%8F%99%EA%B8%B0-%EC%B2%98%EB%A6%AC\">1. Node.js의 비동기 처리</a></p>\n</li>\n<li>\n<p><a href=\"#2-%ED%8A%B8%EB%9E%98%ED%94%BD%EC%9D%B4-%EB%A7%8E%EC%95%84%EC%A7%80%EB%8A%94-%EA%B2%BD%EC%9A%B0-%EB%B6%84%EC%82%B0%EC%B2%98%EB%A6%AC\">2. 트래픽이 많아지는 경우 분산처리</a></p>\n<ul>\n<li><a href=\"#2-1-%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C-%EC%84%9C%EB%B9%84%EC%8A%A4-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C-%EB%A1%9C%EB%93%9C-%EB%B0%B8%EB%9F%B0%EC%84%9C-%EC%82%AC%EC%9A%A9\">2-1. 클라우드 서비스 환경에서 로드 밸런서 사용</a></li>\n<li><a href=\"#2-2-%EC%BA%90%EC%8B%B1\">2-2. 캐싱</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-understanding\">🤔 Understanding</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"March 07, 2022","title":"Node.js 트래픽이 많아지는 경우 서버 과부화 대응 방법","categories":"TIL","author":"JH8459","emoji":"📚"},"fields":{"slug":"/2022-03-07-TIL/"}},"site":{"siteMetadata":{"siteUrl":"https://blog.jh8459.com","comments":{"utterances":{"repo":"JH8459/JH8459.github.io"}}}}},"pageContext":{"slug":"/2022-02-15-TIL/","nextSlug":"/2022-02-11-TIL/","prevSlug":"/2022-03-07-TIL/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}