{"componentChunkName":"component---src-templates-blog-template-js","path":"/2025-03-16-TIL/","result":{"data":{"cur":{"id":"9f81c968-5f6f-5433-b4be-b26ce7279982","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAID/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/2gAMAwEAAhADEAAAAdJomgf/xAAWEAADAAAAAAAAAAAAAAAAAAAAASD/2gAIAQEAAQUCFP8A/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFhAAAwAAAAAAAAAAAAAAAAAAACAx/9oACAEBAAY/AiL/AP/EABgQAAIDAAAAAAAAAAAAAAAAAAABESAx/9oACAEBAAE/IRm9hX//2gAMAwEAAgADAAAAEAw//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGRAAAgMBAAAAAAAAAAAAAAAAAREAIEFR/9oACAEBAAE/EI1YY7tf/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"github-blog.png\"\n        title=\"\"\n        src=\"/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/80e3c/til.jpg\"\n        srcset=\"/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/4ec73/til.jpg 180w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/158ba/til.jpg 360w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/80e3c/til.jpg 720w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/47311/til.jpg 1080w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/ac614/til.jpg 1272w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<h2 id=\"ï¸-today-i-learned\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-today-i-learned\" aria-label=\"ï¸ today i learned permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>âœï¸ <strong>T</strong>oday <strong>I</strong> <strong>L</strong>earned</h2>\n<p>ì‚¬ë‚´ ì¸í”„ë¼ëŠ” ë¹„êµì  ì„±ëŠ¥ì´ ì¢‹ì€ ì„œë²„ë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤. <del>(ìˆ˜í‰ì  í™•ì¥ì´ í˜ë“¤ì–´ì„œ.. ğŸ¥²)</del> ê·¸ë ‡ê¸°ì— ì´ˆê¸° ì¸í”„ë¼ë¥¼ êµ¬ì„±í•  ë• ë¦¬ì†ŒìŠ¤ ë¶€ì¡±ì— í—ˆë•ì´ì§„ ì•Šê³ ìˆë‹¤. (ë‹¤ë§Œ, ìš”ì²­ì´ ê¸‰ì¦í• êº¼ë¼ ì˜ˆìƒë  ë•Œ ìˆ˜í‰ì ìœ¼ë¡œ í™•ì¥í•˜ê¸°ëŠ” ì‰½ì§€ ì•Šë‹¤.)</p>\n<p>ì´ëŸ¬í•œ ë°”íƒ•ì„ í† ëŒ€ë¡œ ì˜¨í”„ë ˆë¯¸ìŠ¤ í™˜ê²½ì—ì„œ Docker Composeë¡œ Blue/Green ë°°í¬ ì „ëµì„ êµ¬í˜„í•œ ê³¼ì •ì„ ê°„ëµíˆ í¬ìŠ¤íŒ…ìœ¼ë¡œ ë‚¨ê¸°ë ¤í•œë‹¤.</p>\n<br>\r\n<br>\n<h3 id=\"1-bluegreen-ë°°í¬ë€\" style=\"position:relative;\"><a href=\"#1-bluegreen-%EB%B0%B0%ED%8F%AC%EB%9E%80\" aria-label=\"1 bluegreen ë°°í¬ë€ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Blue/Green ë°°í¬ë€?</h3>\n<hr>\n<p>ê°„ë‹¨íˆ ì†Œê°œí•˜ìë©´, ì—¬ëŸ¬ ë¬´ì¤‘ë‹¨ ë°°í¬ ê¸°ë²• ì¤‘ í•˜ë‚˜ì´ë©° ë‘ ê°œì˜ ë…ë¦½ì ì¸ í™˜ê²½ Blue(êµ¬ë²„ì „) í™˜ê²½ê³¼ Green(ì‹ ë²„ì „) í™˜ê²½ì„ ê°€ì§€ê³  ì§„í–‰ë˜ëŠ” ë°°í¬ ì „ëµì´ë‹¤.</p>\n<br>\n<p><img src=\"https://jh8459.s3.ap-northeast-2.amazonaws.com/blog/2025-03-16-TIL/blue_green.jpg\" alt=\"blue/green\"></p>\n<center>ì¶œì²˜ : <a href=\"https://www.samsungsds.com/kr/insights/1256264_4627.html\" target=\"_blank\">ë¬´ì¤‘ë‹¨ ë°°í¬ ì•„í‚¤í…ì²˜(Zero Downtime Deployment)- ê¸€ë¡œë²Œ ì„œë¹„ìŠ¤ ìš´ì˜ì˜ í•„ìˆ˜ ìš”ì†Œ\r\n</a></center><br><br>\n<p>êµ¬ë²„ì „ì´ ìš´ì˜ë˜ëŠ” ë™ì•ˆ ì‹ ë²„ì „ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ êµ¬ì„±í•œ í›„ ë¡œë“œë°¸ëŸ°ì„œë¥¼ í†µí•´ ì‹ ë²„ì „ìœ¼ë¡œ ëª¨ë“  íŠ¸ë˜í”½ì„ ì¼ì‹œì— ì „í™˜í•˜ëŠ” ë°°í¬ ë°©ì‹ì´ë‹¤.</p>\n<p>ì‹ ë²„ì „ì— ë¬¸ì œê°€ ìƒê¸°ëŠ” ê²½ìš° ë¡œë“œë°¸ëŸ°ì„œì˜ ë¼ìš°íŒ…ë§Œ êµ¬ë²„ì „ìœ¼ë¡œ ë³€ê²½í•´ì£¼ë©´ ì† ì‰½ê²Œ ë¡¤ë°±ì´ ê°€ëŠ¥í•œ ì¥ì  ë˜í•œ ìˆì§€ë§Œ ê·¸ ë§Œí¼ ë¦¬ì†ŒìŠ¤ë¥¼ ë§ì´ ì‚¬ìš©í•œë‹¤. (ë™ì¼í•œ í™˜ê²½ìœ¼ë¡œ ê°™ì€ ìˆ˜ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ì¶”ê°€ë¡œ í•„ìš”í•˜ë‹¤.)</p>\n<p>ì‚¬ìš©í•œ ë§Œí¼ ì§€ë¶ˆí•˜ëŠ” ì„œë²„ë¦¬ìŠ¤ ì»´í“¨íŒ… í™˜ê²½ì´ë¼ë©´ ì±„íƒ ëª»í• ê±°ê°™ë‹¤. ğŸ¥²</p>\n<br>\r\n<br>\n<h3 id=\"2-docker-compose\" style=\"position:relative;\"><a href=\"#2-docker-compose\" aria-label=\"2 docker compose permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Docker Compose</h3>\n<hr>\n<p>Docker Composeë¡œ êµ¬ì„±í•˜ëŠ” ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ì€ ìµœì†Œí•œì˜ ë³µì¡ì„±ìœ¼ë¡œ íŒ¨í‚¤ì§€ëœ ì»¨í…Œì´ë„ˆë“¤ì„ ì‰½ê²Œ ìš´ìš©í•  ìˆ˜ ìˆê³  ì´ì‹ì„± ë˜í•œ ë›°ì–´ë‚˜ê¸°ì— í˜„ì¬ ì‚¬ë‚´ ì¸í”„ë¼ êµ¬ì¡°ì—ì„œ ì‚¬ìš©í•˜ê¸° ì•Œë§ëŠ”ë‹¤ ìƒê°í•œë‹¤.</p>\n<p>ì´ë²ˆ ë°°í¬ ì „ëµ ì˜ˆì‹œ ë˜í•œ, ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆë“¤ì„ Docker Compose í™˜ê²½ìœ¼ë¡œ êµ¬ì„±í•˜ì—¬ ì ì ˆí•œ Bash ìŠ¤í¬ë¦½íŒ…ìœ¼ë¡œ <code class=\"language-text\">traefik</code> ì„œë¹„ìŠ¤ì—ì„œ ë¼ìš°íŒ…ì„ ì¡°ì ˆí•˜ëŠ” ë°©ë²•ìœ¼ë¡œ Blue/Green ë°°í¬ ì „ëµì„ êµ¬í˜„í•˜ì˜€ë‹¤.</p>\n<p>ìš°ì„  ìƒ˜í”Œ <code class=\"language-text\">docker-compose.yml</code> íŒŒì¼ì„ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì„±í•˜ì˜€ë‹¤. (í•˜ë‚˜í•˜ë‚˜ ì²œì²œíˆ ì‚´í´ ë³¼ ì˜ˆì •ì´ë‹¤.)</p>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">traefik</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> traefik<span class=\"token punctuation\">:</span>latest\r\n    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>log.level=ERROR\r\n      <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.docker=true\r\n      <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.docker.watch=true\r\n      <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.docker.exposedbydefault=false\r\n      <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>entrypoints.web.address=<span class=\"token punctuation\">:</span><span class=\"token number\">3000</span>\r\n      <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>entrypoints.web.forwardedHeaders.insecure=true\r\n      <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.file.filename=/etc/traefik/dynamic<span class=\"token punctuation\">-</span>config.yml\r\n      <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.file.watch=true\r\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"3000:3000\"</span>\r\n    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always\r\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> /var/run/docker.sock<span class=\"token punctuation\">:</span>/var/run/docker.sock<span class=\"token punctuation\">:</span>ro\r\n      <span class=\"token punctuation\">-</span> ./dynamic<span class=\"token punctuation\">-</span>config.yml<span class=\"token punctuation\">:</span>/etc/traefik/dynamic<span class=\"token punctuation\">-</span>config.yml\r\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> net_default\r\n\r\n  <span class=\"token key atrule\">web-server-blue</span><span class=\"token punctuation\">:</span> <span class=\"token important\">&amp;web-server-template</span>\r\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token key atrule\">context</span><span class=\"token punctuation\">:</span> .\r\n      <span class=\"token key atrule\">dockerfile</span><span class=\"token punctuation\">:</span> Dockerfile\r\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> ./src<span class=\"token punctuation\">:</span>/myfolder/src\r\n    <span class=\"token key atrule\">env_file</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> ./.env\r\n    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always\r\n    <span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\r\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> traefik.enable=true\r\n      <span class=\"token punctuation\">-</span> traefik.http.services.web<span class=\"token punctuation\">-</span>server<span class=\"token punctuation\">-</span>blue.loadbalancer.server.port=3000\r\n    <span class=\"token key atrule\">healthcheck</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token key atrule\">test</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'CMD'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'curl'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-f'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'http://localhost:3000/health'</span><span class=\"token punctuation\">]</span>\r\n      <span class=\"token key atrule\">interval</span><span class=\"token punctuation\">:</span> 30s\r\n      <span class=\"token key atrule\">timeout</span><span class=\"token punctuation\">:</span> 10s\r\n      <span class=\"token key atrule\">retries</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\r\n      <span class=\"token key atrule\">start_period</span><span class=\"token punctuation\">:</span> 30s\r\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> net_default\r\n\r\n  <span class=\"token key atrule\">web-server-green</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">&lt;&lt;</span><span class=\"token punctuation\">:</span> <span class=\"token important\">*web-server-template</span>\r\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> traefik.enable=true\r\n      <span class=\"token punctuation\">-</span> traefik.http.services.web<span class=\"token punctuation\">-</span>server<span class=\"token punctuation\">-</span>green.loadbalancer.server.port=3000\r\n\r\n<span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">net_default</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">driver</span><span class=\"token punctuation\">:</span> bridge</code></pre></div>\n<br>\r\n<br>\n<h4 id=\"2-1-traefik\" style=\"position:relative;\"><a href=\"#2-1-traefik\" aria-label=\"2 1 traefik permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-1. traefik</h4>\n<hr>\n<p><code class=\"language-text\">traefik</code> ì»¨í…Œì´ë„ˆëŠ” ë¡œë“œë°¸ëŸ°ì„œ ì—­í• ì„ ë‹´ë‹¹í•¨ìœ¼ë¡œì¨ êµ¬ë²„ì „ í™˜ê²½ê³¼ ì‹ ë²„ì „ í™˜ê²½ì— í˜„ì¬ ë°°í¬ ìš”ì²­ì— ì•Œë§ëŠ” ë¼ìš°íŒ… ì •ì±…ì„ ë‹´ë‹¹í•  ì˜ˆì •ì´ë‹¤.</p>\n<ul>\n<li><code class=\"language-text\">dynamic-config.yml</code> íŒŒì¼ì„ ì œì–´í•´ì„œ ë™ì ìœ¼ë¡œ ë¼ìš°íŒ…ì„ ë³€ê²½í•  ì˜ˆì •ì´ë¯€ë¡œ í•´ë‹¹ íŒŒì¼ ë³¼ë£¸ì„ ê¼­ ì„¤ì •í•´ì£¼ì.</li>\n</ul>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">traefik</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> traefik<span class=\"token punctuation\">:</span>latest\r\n  <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>log.level=ERROR\r\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.docker=true  <span class=\"token comment\">#Docker ì»¨í…Œì´ë„ˆì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì„œë¹„ìŠ¤ë“¤ì„ ìë™ìœ¼ë¡œ ê°ì§€í•˜ë„ë¡ ì„¤ì •</span>\r\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.docker.watch=true  <span class=\"token comment\">#Dockerì—ì„œ ìƒˆë¡œìš´ ì»¨í…Œì´ë„ˆê°€ ìƒì„±ë˜ê±°ë‚˜ ë³€ê²½ë  ê²½ìš° ìë™ìœ¼ë¡œ ê°ì§€.</span>\r\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.docker.exposedbydefault=false  <span class=\"token comment\">#ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  Docker ì»¨í…Œì´ë„ˆë¥¼ Traefikì´ ë¼ìš°íŒ…í•˜ì§€ ì•Šë„ë¡ ì„¤ì •. (labelsë¥¼ í†µí•´ ê°œë³„ì ìœ¼ë¡œ ë…¸ì¶œí•´ì•¼ í•¨)</span>\r\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>entrypoints.web.address=<span class=\"token punctuation\">:</span><span class=\"token number\">3000</span>\r\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>entrypoints.web.forwardedHeaders.insecure=true\r\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.file.filename=/etc/traefik/dynamic<span class=\"token punctuation\">-</span>config.yml  <span class=\"token comment\">#dynamic-config.yml íŒŒì¼ì—ì„œ ì¶”ê°€ì ì¸ ë™ì  ì„¤ì •ì„ ì½ë„ë¡ ì§€ì •.</span>\r\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.file.watch=true  <span class=\"token comment\">#ì„¤ì • íŒŒì¼(dynamic-config.yml)ì´ ë³€ê²½ë˜ë©´ ìë™ìœ¼ë¡œ ê°ì§€í•˜ì—¬ ì ìš©í•˜ë„ë¡ ì„¤ì •.</span>\r\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"3000:3000\"</span>\r\n  <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always\r\n  <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token punctuation\">-</span> /var/run/docker.sock<span class=\"token punctuation\">:</span>/var/run/docker.sock<span class=\"token punctuation\">:</span>ro\r\n    <span class=\"token punctuation\">-</span> ./dynamic<span class=\"token punctuation\">-</span>config.yml<span class=\"token punctuation\">:</span>/etc/traefik/dynamic<span class=\"token punctuation\">-</span>config.yml\r\n  <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token punctuation\">-</span> net_default</code></pre></div>\n<br>\n<p><code class=\"language-text\">docker-compose.yml</code> íŒŒì¼ì€ ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ë  ë•Œë§Œ ì ìš©ë˜ëŠ” ì •ì ì¸ ì„¤ì •ê°’ë“¤ì´ë‹¤. ë•Œë¬¸ì— ë™ì ìœ¼ë¡œ ë³€í•´ì•¼ í•˜ëŠ” ë¼ìš°íŒ… ëŒ€ìƒì€ í˜„ì¬ ìš´ì˜ ì¤‘ì¸ ë²„ì „(Blue / Green)ì´ ë¬´ì—‡ì¸ì§€ë¥¼ í™•ì¸í•´ì„œ ë°°í¬ê°€ ë  ë•Œë§ˆë‹¤ ë³€í™˜ë˜ì–´ì•¼ í•œë‹¤.</p>\n<p>ë™ì  ë¼ìš°íŒ… ë³€ê²½ì€ <code class=\"language-text\">dynamic-config.yml</code> íŒŒì¼ì„ Bash ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ìë™ìœ¼ë¡œ ìƒì„± ë° ìˆ˜ì •ì´ ë˜ê²Œë” êµ¬ì„±í•˜ì—¬ ë¼ìš°íŒ… ì •ì±…ì„ ì œì–´í•  ì˜ˆì •ì´ë‹¤.</p>\n<p>ë”°ë¼ì„œ ì•„ë˜ì˜ ì„¤ì •ê°’ì´ ë°˜ë“œì‹œ ë°˜ì˜ë˜ì–´ì•¼í•œë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.file.filename=/etc/traefik/dynamic<span class=\"token punctuation\">-</span>config.yml  <span class=\"token comment\">#dynamic-config.yml íŒŒì¼ì—ì„œ ì¶”ê°€ì ì¸ ë™ì  ì„¤ì •ì„ ì½ë„ë¡ ì§€ì •.</span>\r\n<span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.file.watch=true  <span class=\"token comment\">#ì„¤ì • íŒŒì¼(dynamic-config.yml)ì´ ë³€ê²½ë˜ë©´ ìë™ìœ¼ë¡œ ê°ì§€í•˜ì—¬ ì ìš©í•˜ë„ë¡ ì„¤ì •.</span></code></pre></div>\n<br>\r\n<br>\n<h4 id=\"2-2-web-server\" style=\"position:relative;\"><a href=\"#2-2-web-server\" aria-label=\"2 2 web server permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-2. web-server</h4>\n<hr>\n<p><code class=\"language-text\">web-server</code> ì„œë¹„ìŠ¤ë“¤ì€ ì˜ˆì‹œë¡œ <code class=\"language-text\">replicas</code>ë¥¼ 2ê°œë¡œ êµ¬ì„±í•´ ë‘ì—ˆë‹¤. ì¦‰, ê°ê° 2ê°œì˜ ì»¨í…Œì´ë„ˆì”© Blue / Green í™˜ê²½ì´ ì¡´ì¬í•œë‹¤ê³  ê°€ì •í–ˆë‹¤.</p>\n<ul>\n<li>ë™ì¼í•œ í™˜ê²½ìœ¼ë¡œ êµ¬ì„±í•´ì•¼í•˜ë¯€ë¡œ Blue ì»¨í…Œì´ë„ˆë¥¼ í…œí”Œë¦¿ìœ¼ë¡œ êµ¬ì„±í•˜ì—¬ Green ì»¨í…Œì´ë„ˆì— ì‚¬ìš©í•˜ì˜€ë‹¤.</li>\n<li>ìƒ˜í”Œì—ì„œëŠ” <code class=\"language-text\">Dockerfile</code>ì„ ì‚¬ìš©í•´ì„œ Bash ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì§ì ‘ ë¹Œë“œí•˜ì—¬ ë°°í¬í•˜ì˜€ì§€ë§Œ, ì´ëŠ” ì—¬ëŸ¬ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ìˆ˜ì •í•´ë„ ë¬´ë°©í•˜ë‹¤.</li>\n</ul>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">web-server-blue</span><span class=\"token punctuation\">:</span> <span class=\"token important\">&amp;web-server-template</span>  <span class=\"token comment\">#&amp;web-server-templateì„ ì‚¬ìš©í•˜ì—¬ YAML ì•µì»¤(Anchor)ë¡œ ì„¤ì •ì„ ì €ì¥. â†’ web-server-greenì´ ì´ ì„¤ì •ì„ ê·¸ëŒ€ë¡œ ê°€ì ¸ë‹¤ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ.</span>\r\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\">#í˜„ì¬ ë””ë ‰í† ë¦¬(.)ì—ì„œ Dockerfileì„ ì‚¬ìš©í•˜ì—¬ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•¨. (ì´ë¯¸ì§€ íŒŒì¼ì„ ì‚¬ìš©í•´ë„ ëœë‹¤.)</span>\r\n    <span class=\"token key atrule\">context</span><span class=\"token punctuation\">:</span> .\r\n    <span class=\"token key atrule\">dockerfile</span><span class=\"token punctuation\">:</span> Dockerfile\r\n  <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token punctuation\">-</span> ./src<span class=\"token punctuation\">:</span>/myfolder/src\r\n  <span class=\"token key atrule\">env_file</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token punctuation\">-</span> ./.env\r\n  <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always\r\n  <span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\r\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token punctuation\">-</span> traefik.enable=true  <span class=\"token comment\">#ì´ ì»¨í…Œì´ë„ˆê°€ Traefikì˜ ë¼ìš°íŒ… ëŒ€ìƒìœ¼ë¡œ í¬í•¨ë˜ë„ë¡ ì„¤ì •.</span>\r\n    <span class=\"token punctuation\">-</span> traefik.http.services.web<span class=\"token punctuation\">-</span>server<span class=\"token punctuation\">-</span>blue.loadbalancer.server.port=3000\r\n  <span class=\"token key atrule\">healthcheck</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">test</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'CMD'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'curl'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-f'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'http://localhost:3000/health'</span><span class=\"token punctuation\">]</span>\r\n    <span class=\"token key atrule\">interval</span><span class=\"token punctuation\">:</span> 30s\r\n    <span class=\"token key atrule\">timeout</span><span class=\"token punctuation\">:</span> 10s\r\n    <span class=\"token key atrule\">retries</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\r\n    <span class=\"token key atrule\">start_period</span><span class=\"token punctuation\">:</span> 30s\r\n  <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token punctuation\">-</span> net_default\r\n\r\n<span class=\"token key atrule\">web-server-green</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">&lt;&lt;</span><span class=\"token punctuation\">:</span> <span class=\"token important\">*web-server-template</span>  <span class=\"token comment\">#web-server-greenì€ web-server-blueì™€ ê°™ì€ ì´ë¯¸ì§€, ë³¼ë¥¨, ë„¤íŠ¸ì›Œí¬ ë“±ì„ ì‚¬ìš©.</span>\r\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token punctuation\">-</span> traefik.enable=true\r\n    <span class=\"token punctuation\">-</span> traefik.http.services.web<span class=\"token punctuation\">-</span>server<span class=\"token punctuation\">-</span>green.loadbalancer.server.port=3000</code></pre></div>\n<br>\r\n<br>\n<h4 id=\"2-3-ë°°í¬-ìŠ¤í¬ë¦½íŠ¸\" style=\"position:relative;\"><a href=\"#2-3-%EB%B0%B0%ED%8F%AC-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8\" aria-label=\"2 3 ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-3. ë°°í¬ ìŠ¤í¬ë¦½íŠ¸</h4>\n<hr>\n<p>ìœ„ì—ì„œ ì‘ì„±ì´ ì™„ì„±ëœ <code class=\"language-text\">docker-compose.yml</code> íŒŒì¼ì„ <code class=\"language-text\">docker compose up --build -d</code> ëª…ë ¹ì–´ë¡œ ì‹¤í–‰í•˜ë©´ Blue / Green ì„œë¹„ìŠ¤ë§ˆë‹¤ ì»¨í…Œì´ë„ˆê°€ 2ê°œì”© ìƒì„±ëœë‹¤.</p>\n<p>ì´ëŠ” ì˜ë„í•œë°”ê°€ ì•„ë‹ˆë¯€ë¡œ Bash ìŠ¤í¬ë¦½íŠ¸ë¡œ í˜„ì¬ íƒ€ê²Ÿ ì„œë¹„ìŠ¤ê°€ ë¬´ì—‡ì¸ì§€ í™•ì¸í•˜ë©° ë¼ìš°íŒ… ëŒ€ìƒì„ ë³€ê²½í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë°°í¬ê°€ ì´ë¤„ì§„ë‹¤.</p>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\r\n<span class=\"token comment\"># í™˜ê²½ ë³€ìˆ˜ ì„¤ì •</span>\r\n<span class=\"token assign-left variable\">DYNAMIC_CONFIG</span><span class=\"token operator\">=</span><span class=\"token string\">\"dynamic-config.yml\"</span>\r\n<span class=\"token assign-left variable\">COMPOSE_FILE</span><span class=\"token operator\">=</span><span class=\"token string\">\"docker-compose.yml\"</span>\r\n<span class=\"token assign-left variable\">DOMAIN</span><span class=\"token operator\">=</span><span class=\"token string\">\"localhost\"</span>\r\n<span class=\"token assign-left variable\">SERVICE</span><span class=\"token operator\">=</span><span class=\"token string\">\"web-server\"</span>\r\n<span class=\"token assign-left variable\">BLUE_SERVICE</span><span class=\"token operator\">=</span><span class=\"token string\">\"web-server-blue\"</span>\r\n<span class=\"token assign-left variable\">GREEN_SERVICE</span><span class=\"token operator\">=</span><span class=\"token string\">\"web-server-green\"</span>\r\n<span class=\"token assign-left variable\">PORT</span><span class=\"token operator\">=</span><span class=\"token number\">3000</span>\r\n<span class=\"token assign-left variable\">REPLICAS</span><span class=\"token operator\">=</span><span class=\"token number\">2</span>\r\n\r\n<span class=\"token comment\"># 1ï¸âƒ£ dynamic-config.yml íŒŒì¼(ë™ì  ë¼ìš°íŒ… ë‹´ë‹¹)ì´ ì—†ìœ¼ë©´ ìƒì„±</span>\r\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token operator\">!</span> <span class=\"token parameter variable\">-f</span> <span class=\"token string\">\"<span class=\"token variable\">$DYNAMIC_CONFIG</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\r\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"âš ï¸ <span class=\"token variable\">$DYNAMIC_CONFIG</span> íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê¸°ë³¸ê°’ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.\"</span>\r\n  <span class=\"token function\">cat</span> <span class=\"token operator\">></span> <span class=\"token variable\">$DYNAMIC_CONFIG</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOL\r\nhttp:\r\n  routers:\r\n    <span class=\"token variable\">$SERVICE</span>:\r\n      entryPoints:\r\n        - \"web\"\r\n      rule: \"Host(\\<span class=\"token variable\">$DOMAIN</span>\\)\"\r\n      service: \"<span class=\"token variable\">$BLUE_SERVICE</span>\"\r\n\r\n  services:\r\n    <span class=\"token variable\">$BLUE_SERVICE</span>:\r\n      loadBalancer:\r\n        servers:\r\n          - url: \"http://<span class=\"token variable\">$BLUE_SERVICE</span>:<span class=\"token variable\">$PORT</span>\"\r\n\r\n    <span class=\"token variable\">$GREEN_SERVICE</span>:\r\n      loadBalancer:\r\n        servers:\r\n          - url: \"http://<span class=\"token variable\">$GREEN_SERVICE</span>:<span class=\"token variable\">$PORT</span>\"\r\nEOL</span>\r\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"âœ… ê¸°ë³¸ <span class=\"token variable\">$DYNAMIC_CONFIG</span> íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.\"</span>\r\n<span class=\"token keyword\">fi</span>\r\n\r\n<span class=\"token comment\"># 2ï¸âƒ£ í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì„œë¹„ìŠ¤ í™•ì¸</span>\r\n<span class=\"token assign-left variable\">BLUE_RUNNING</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">docker</span> <span class=\"token function\">ps</span> <span class=\"token parameter variable\">--filter</span> <span class=\"token string\">\"name=<span class=\"token variable\">$BLUE_SERVICE</span>\"</span> <span class=\"token parameter variable\">--format</span> <span class=\"token string\">\"{{.Names}}\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> <span class=\"token parameter variable\">-l</span><span class=\"token variable\">)</span></span>\r\n<span class=\"token assign-left variable\">GREEN_RUNNING</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">docker</span> <span class=\"token function\">ps</span> <span class=\"token parameter variable\">--filter</span> <span class=\"token string\">\"name=<span class=\"token variable\">$GREEN_SERVICE</span>\"</span> <span class=\"token parameter variable\">--format</span> <span class=\"token string\">\"{{.Names}}\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> <span class=\"token parameter variable\">-l</span><span class=\"token variable\">)</span></span>\r\n\r\n<span class=\"token assign-left variable\">FIRST_DEPLOY</span><span class=\"token operator\">=</span>false\r\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$BLUE_RUNNING</span>\"</span> <span class=\"token parameter variable\">-eq</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$GREEN_RUNNING</span>\"</span> <span class=\"token parameter variable\">-eq</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\r\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"ğŸ†• ìµœì´ˆ ë°°í¬ì…ë‹ˆë‹¤. Blue ì„œë¹„ìŠ¤ë¶€í„° ì‹œì‘í•©ë‹ˆë‹¤.\"</span>\r\n  <span class=\"token assign-left variable\">TARGET_SERVICE</span><span class=\"token operator\">=</span><span class=\"token variable\">$BLUE_SERVICE</span>\r\n  <span class=\"token assign-left variable\">OLD_SERVICE</span><span class=\"token operator\">=</span><span class=\"token string\">\"\"</span>\r\n  <span class=\"token assign-left variable\">FIRST_DEPLOY</span><span class=\"token operator\">=</span>true\r\n<span class=\"token keyword\">else</span>\r\n  <span class=\"token comment\"># 3ï¸âƒ£ dynamic-config.ymlì—ì„œ OLD_SERVICE ê°€ì ¸ì˜¤ê¸°</span>\r\n  <span class=\"token assign-left variable\">OLD_SERVICE</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">grep</span> <span class=\"token string\">\"service:\"</span> $DYNAMIC_CONFIG <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> -F<span class=\"token string\">'\"'</span> <span class=\"token string\">'{print $2}'</span><span class=\"token variable\">)</span></span>\r\n\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-z</span> <span class=\"token string\">\"<span class=\"token variable\">$OLD_SERVICE</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\r\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"âŒ í˜„ì¬ ë¼ìš°íŒ…ëœ ì„œë¹„ìŠ¤ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë°°í¬ë¥¼ ì¤‘ë‹¨í•©ë‹ˆë‹¤.\"</span>\r\n    <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span>\r\n  <span class=\"token keyword\">fi</span>\r\n\r\n  <span class=\"token comment\"># 4ï¸âƒ£ í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ í™•ì¸í•˜ì—¬ OLD_SERVICEê°€ ì•„ë‹Œ ì»¨í…Œì´ë„ˆ ì°¾ê¸°</span>\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$OLD_SERVICE</span>\"</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"<span class=\"token variable\">$BLUE_SERVICE</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\r\n    <span class=\"token assign-left variable\">TARGET_SERVICE</span><span class=\"token operator\">=</span><span class=\"token variable\">$GREEN_SERVICE</span>\r\n  <span class=\"token keyword\">else</span>\r\n    <span class=\"token assign-left variable\">TARGET_SERVICE</span><span class=\"token operator\">=</span><span class=\"token variable\">$BLUE_SERVICE</span>\r\n  <span class=\"token keyword\">fi</span>\r\n\r\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"ğŸ”„ í˜„ì¬ ë¼ìš°íŒ…ëœ ì„œë¹„ìŠ¤: <span class=\"token variable\">$OLD_SERVICE</span>\"</span>\r\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"ğŸš€ ìƒˆë¡œìš´ ë°°í¬ ëŒ€ìƒ ì„œë¹„ìŠ¤: <span class=\"token variable\">$TARGET_SERVICE</span>\"</span>\r\n<span class=\"token keyword\">fi</span>\r\n\r\n<span class=\"token comment\"># 5ï¸âƒ£ ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ ë¹Œë“œ</span>\r\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"ğŸš€ Building the new version of the service: <span class=\"token variable\">$TARGET_SERVICE</span>...\"</span>\r\n<span class=\"token function\">docker</span> compose <span class=\"token parameter variable\">-f</span> <span class=\"token variable\">$COMPOSE_FILE</span> build <span class=\"token variable\">$TARGET_SERVICE</span>\r\n\r\n<span class=\"token comment\"># 6ï¸âƒ£ ìƒˆë¡œìš´ ì»¨í…Œì´ë„ˆ ì‹¤í–‰</span>\r\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"ğŸš€ Deploying new service: <span class=\"token variable\">$TARGET_SERVICE</span> with <span class=\"token variable\">$REPLICAS</span> replicas...\"</span>\r\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$FIRST_DEPLOY</span>\"</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\r\n  <span class=\"token function\">docker</span> compose <span class=\"token parameter variable\">-f</span> <span class=\"token variable\">$COMPOSE_FILE</span> up <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--scale</span> <span class=\"token variable\">$BLUE_SERVICE</span><span class=\"token operator\">=</span><span class=\"token variable\">$REPLICAS</span> <span class=\"token parameter variable\">--scale</span> <span class=\"token variable\">$GREEN_SERVICE</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>\r\n<span class=\"token keyword\">else</span>\r\n  <span class=\"token function\">docker</span> compose <span class=\"token parameter variable\">-f</span> <span class=\"token variable\">$COMPOSE_FILE</span> up <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--scale</span> <span class=\"token variable\">$TARGET_SERVICE</span><span class=\"token operator\">=</span><span class=\"token variable\">$REPLICAS</span>\r\n<span class=\"token keyword\">fi</span>\r\n\r\n<span class=\"token comment\"># 7ï¸âƒ£ ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ Health Check</span>\r\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"ğŸ› ï¸ Checking health status of <span class=\"token variable\">$TARGET_SERVICE</span>...\"</span>\r\n<span class=\"token function\">sleep</span> <span class=\"token number\">10</span>  <span class=\"token comment\"># ì•ˆì •í™” ì‹œê°„</span>\r\n\r\n<span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">i</span> <span class=\"token keyword\">in</span> <span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">..</span><span class=\"token number\">12</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span>\r\n  <span class=\"token assign-left variable\">HEALTHY_COUNT</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">docker</span> <span class=\"token function\">ps</span> <span class=\"token parameter variable\">--filter</span> <span class=\"token string\">\"name=<span class=\"token variable\">$TARGET_SERVICE</span>\"</span> <span class=\"token parameter variable\">--filter</span> <span class=\"token string\">\"health=healthy\"</span> <span class=\"token parameter variable\">--format</span> <span class=\"token string\">\"{{.Names}}\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> <span class=\"token parameter variable\">-l</span><span class=\"token variable\">)</span></span>\r\n\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$HEALTHY_COUNT</span>\"</span> <span class=\"token parameter variable\">-gt</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\r\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"âœ… New service <span class=\"token variable\">$TARGET_SERVICE</span> is healthy!\"</span>\r\n    <span class=\"token builtin class-name\">break</span>\r\n  <span class=\"token keyword\">fi</span>\r\n\r\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"â³ Waiting for <span class=\"token variable\">$TARGET_SERVICE</span> to be healthy... (<span class=\"token variable\">$i</span>/12)\"</span>\r\n  <span class=\"token function\">sleep</span> <span class=\"token number\">10</span>\r\n<span class=\"token keyword\">done</span>\r\n\r\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$HEALTHY_COUNT</span>\"</span> <span class=\"token parameter variable\">-eq</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\r\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"âŒ New service <span class=\"token variable\">$TARGET_SERVICE</span> failed to start properly. Rolling back...\"</span>\r\n  <span class=\"token function\">docker</span> compose <span class=\"token parameter variable\">-f</span> <span class=\"token variable\">$COMPOSE_FILE</span> down <span class=\"token variable\">$TARGET_SERVICE</span>\r\n  <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span>\r\n<span class=\"token keyword\">fi</span>\r\n\r\n<span class=\"token comment\"># 8ï¸âƒ£ `dynamic-config.yml` ì—…ë°ì´íŠ¸ (ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ë¡œ ë¼ìš°íŒ… ë³€ê²½)</span>\r\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"ğŸ”„ Updating dynamic-config.yml to point to <span class=\"token variable\">$TARGET_SERVICE</span>...\"</span>\r\n<span class=\"token function\">cat</span> <span class=\"token operator\">></span> <span class=\"token variable\">$DYNAMIC_CONFIG</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOL\r\nhttp:\r\n  routers:\r\n    <span class=\"token variable\">$SERVICE</span>:\r\n      entryPoints:\r\n        - \"web\"\r\n      rule: \"Host(\\<span class=\"token variable\"><span class=\"token variable\">`</span>$DOMAIN<span class=\"token punctuation\">\\</span><span class=\"token variable\">`</span></span>)\"\r\n      service: \"<span class=\"token variable\">$TARGET_SERVICE</span>\"\r\n\r\n  services:\r\n    <span class=\"token variable\">$BLUE_SERVICE</span>:\r\n      loadBalancer:\r\n        servers:\r\n          - url: \"http://<span class=\"token variable\">$BLUE_SERVICE</span>:<span class=\"token variable\">$PORT</span>\"\r\n\r\n    <span class=\"token variable\">$GREEN_SERVICE</span>:\r\n      loadBalancer:\r\n        servers:\r\n          - url: \"http://<span class=\"token variable\">$GREEN_SERVICE</span>:<span class=\"token variable\">$PORT</span>\"\r\nEOL</span>\r\n\r\n<span class=\"token comment\"># 9ï¸âƒ£ Traefikì´ ì„¤ì •ì„ ìë™ ê°ì§€í•˜ë„ë¡ íŠ¸ë¦¬ê±°</span>\r\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"â™»ï¸ Triggering Traefik reload...\"</span>\r\n<span class=\"token function\">touch</span> <span class=\"token variable\">$DYNAMIC_CONFIG</span>\r\n\r\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"ğŸ‰ Deployment complete!\"</span></code></pre></div>\n<br>\n<p>ê°ê° í”„ë¡œì íŠ¸ë§ˆë‹¤ ê³ ìœ í•œ ê°’ë“¤ì€ í™˜ê²½ ë³€ìˆ˜ë¡œ ë§Œë“¤ì–´ ë‘ì—ˆìœ¼ë©° ìŠ¤í¬ë¦½íŠ¸ë¥¼ ê°„ë‹¨íˆ ì„¤ëª…í•˜ìë©´ ì•„ë˜ì˜ ìˆœì„œëŒ€ë¡œ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ë©° Blue / Green ë°°í¬ê°€ ì§„í–‰ëœë‹¤.</p>\n<ol>\n<li>ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ëœ ë””ë ‰í† ë¦¬ì— <code class=\"language-text\">dynamic-config.yml</code> íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ”ì§€ ê°ì§€í•˜ê³  ì—†ë‹¤ë©´ ê¸°ë³¸ ë¼ìš°íŒ… ì •ì±…(Blue í™˜ê²½ ìš°ì„  ë¼ìš°íŒ…)ì„ ë‹´ì€ íŒŒì¼ì„ ìƒì„±í•œë‹¤.</li>\n<li>í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ Blue / Green ì»¨í…Œì´ë„ˆë“¤ì„ í™•ì¸ í›„ ìµœì´ˆ ë°°í¬ê°€ ì´ë¤„ì§€ëŠ” ê²½ìš°ì¸ì§€ í™•ì¸í•œë‹¤.</li>\n<li>ìµœì´ˆ ë°°í¬ê°€ ì§„í–‰ë˜ëŠ” ê²½ìš°ë¼ë©´ Blue í™˜ê²½ìœ¼ë¡œ ë°°í¬ë¥¼ ì§„í–‰í•œë‹¤. (Green í™˜ê²½ì€ ë°°í¬í•˜ì§€ ì•ŠëŠ”ë‹¤.)</li>\n<li>ìµœì´ˆ ë°°í¬ê°€ ì§„í–‰ë˜ëŠ” ê²½ìš°ê°€ ì•„ë‹ˆë¼ë©´ ìš´ì˜ ì¤‘ì¸ <code class=\"language-text\">dynamic-config.yml</code> íŒŒì¼ì„ í™•ì¸í•˜ì—¬ í˜„ì¬ ë¼ìš°íŒ… ì¤‘ì¸ ì»¨í…Œì´ë„ˆ(OLD_SERVICE) ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ë‹¤.</li>\n<li>ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ë¥¼ ë¹Œë“œí•œë‹¤.</li>\n<li>ë¹Œë“œëœ ì´ë¯¸ì§€ë¡œ ìƒˆë¡œìš´ ì»¨í…Œì´ë„ˆ(TARGET_SERVICE)ë¥¼ ì‹¤í–‰í•œë‹¤.</li>\n<li>ìƒˆë¡œìš´ ì»¨í…Œì´ë„ˆì˜ Health Checkë¥¼ ê¸°ë‹¤ë¦°ë‹¤. (ì‹¤íŒ¨ì‹œ TARGET_SERVICE ì»¨í…Œì´ë„ˆë¥¼ ì‚­ì œ í›„ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¢…ë£Œ)</li>\n<li><code class=\"language-text\">dynamic-config.yml</code>ì˜ ë¼ìš°íŒ… ëŒ€ìƒì„ ì—…ë°ì´íŠ¸ í•œë‹¤. (OLD_SERVICE â†’ TARGET_SERVICE)</li>\n<li>ì„¤ì • íŒŒì¼ì˜ ë³€ê²½ì„ ìë™ìœ¼ë¡œ ê°ì§€í•  ìˆ˜ ìˆë„ë¡ <code class=\"language-text\">dynamic-config.yml</code> íŒŒì¼ì„ ìˆ˜ì •í•œë‹¤.</li>\n</ol>\n<br>\r\n<br>\n<p>ìœ„ ìˆœì„œëŒ€ë¡œ ë™ì‘í•˜ë¯€ë¡œ ì‹ ë²„ì „(TARGET_SERVICE)ì´ ë°°í¬ë˜ê³  ì•ˆì •í™” ë˜ëŠ” ë™ì•ˆ êµ¬ë²„ì „(OLD_SERVICE)ì´ íŠ¸ë˜í”½ì„ ë°›ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë¬´ì¤‘ë‹¨ ë°°í¬ê°€ ê°€ëŠ¥í•˜ë©°, Blue / Green í™˜ê²½ì´ ëª¨ë‘ ê³µì¡´í•˜ë¯€ë¡œ ì† ì‰½ê²Œ ë¡¤ë°± ë˜í•œ ê°€ëŠ¥í•˜ë‹¤.</p>\n<br>\r\n<br>\n<h4 id=\"2-4-ë¼ìš°íŒ…-ì •ì±…-ë³€ê²½-ìŠ¤í¬ë¦½íŠ¸\" style=\"position:relative;\"><a href=\"#2-4-%EB%9D%BC%EC%9A%B0%ED%8C%85-%EC%A0%95%EC%B1%85-%EB%B3%80%EA%B2%BD-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8\" aria-label=\"2 4 ë¼ìš°íŒ… ì •ì±… ë³€ê²½ ìŠ¤í¬ë¦½íŠ¸ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-4. ë¼ìš°íŒ… ì •ì±… ë³€ê²½ ìŠ¤í¬ë¦½íŠ¸</h4>\n<hr>\n<p>ì‹ ë²„ì „(TARGET_SERVICE)ì´ ìƒˆë¡œ ë°°í¬ê°€ ë˜ì—ˆë‹¤ë©´, êµ¬ë²„ì „(OLD_SERVICE) í™˜ê²½ì€ ë”ì´ìƒ íŠ¸ë˜í”½ì„ ë°›ì§€ ëª»í•˜ëŠ” ìœ íœ´ ì»¨í…Œì´ë„ˆë“¤ë¡œ ì¡´ì¬í•œë‹¤.</p>\n<p>ì´ ê²½ìš°ì— ìƒˆë¡œ ë°°í¬í•œ í™˜ê²½ì—ì„œ ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤ë©´ êµ¬ë²„ì „(OLD_SERVICE) í™˜ê²½ìœ¼ë¡œ ë¼ìš°íŒ… ì •ì±…ë§Œ ë³€ê²½í•˜ë©´ ì† ì‰½ê²Œ ë¡¤ë°±ì´ ê°€ëŠ¥í•˜ë‹¤.</p>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\r\n<span class=\"token comment\"># í™˜ê²½ ë³€ìˆ˜ ì„¤ì •</span>\r\n<span class=\"token assign-left variable\">DYNAMIC_CONFIG</span><span class=\"token operator\">=</span><span class=\"token string\">\"dynamic-config.yml\"</span>\r\n<span class=\"token assign-left variable\">COMPOSE_FILE</span><span class=\"token operator\">=</span><span class=\"token string\">\"docker-compose.yml\"</span>\r\n<span class=\"token assign-left variable\">DOMAIN</span><span class=\"token operator\">=</span><span class=\"token string\">\"localhost\"</span>\r\n<span class=\"token assign-left variable\">SERVICE</span><span class=\"token operator\">=</span><span class=\"token string\">\"web-server\"</span>\r\n<span class=\"token assign-left variable\">BLUE_SERVICE</span><span class=\"token operator\">=</span><span class=\"token string\">\"web-server-blue\"</span>\r\n<span class=\"token assign-left variable\">GREEN_SERVICE</span><span class=\"token operator\">=</span><span class=\"token string\">\"web-server-green\"</span>\r\n<span class=\"token assign-left variable\">PORT</span><span class=\"token operator\">=</span><span class=\"token number\">3000</span>\r\n\r\n<span class=\"token comment\"># 1ï¸âƒ£ í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì„œë¹„ìŠ¤ í™•ì¸</span>\r\n<span class=\"token assign-left variable\">BLUE_RUNNING</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">docker</span> <span class=\"token function\">ps</span> <span class=\"token parameter variable\">--filter</span> <span class=\"token string\">\"name=<span class=\"token variable\">$BLUE_SERVICE</span>\"</span> <span class=\"token parameter variable\">--format</span> <span class=\"token string\">\"{{.Names}}\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> <span class=\"token parameter variable\">-l</span><span class=\"token variable\">)</span></span>\r\n<span class=\"token assign-left variable\">GREEN_RUNNING</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">docker</span> <span class=\"token function\">ps</span> <span class=\"token parameter variable\">--filter</span> <span class=\"token string\">\"name=<span class=\"token variable\">$GREEN_SERVICE</span>\"</span> <span class=\"token parameter variable\">--format</span> <span class=\"token string\">\"{{.Names}}\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> <span class=\"token parameter variable\">-l</span><span class=\"token variable\">)</span></span>\r\n\r\n<span class=\"token comment\"># ë‘˜ ë‹¤ ì‹¤í–‰ ì¤‘ì´ì–´ì•¼ ë¼ìš°íŒ… ì •ì±… ë³€ê²½ ê°€ëŠ¥ (ë‘˜ ì¤‘ í•˜ë‚˜ë¼ë„ êº¼ì ¸ ìˆìœ¼ë©´ ì¢…ë£Œ)</span>\r\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$BLUE_RUNNING</span>\"</span> <span class=\"token parameter variable\">-eq</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$GREEN_RUNNING</span>\"</span> <span class=\"token parameter variable\">-eq</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\r\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"âŒ Blueì™€ Green ì¤‘ í•˜ë‚˜ë¼ë„ ì‹¤í–‰ë˜ì§€ ì•Šìœ¼ë©´ ë¼ìš°íŒ…ì„ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\"</span>\r\n  <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span>\r\n<span class=\"token keyword\">fi</span>\r\n\r\n<span class=\"token comment\"># 2ï¸âƒ£ í˜„ì¬ dynamic-config.ymlì—ì„œ OLD_SERVICE ê°€ì ¸ì˜¤ê¸°</span>\r\n<span class=\"token assign-left variable\">OLD_SERVICE</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">grep</span> <span class=\"token string\">\"service:\"</span> $DYNAMIC_CONFIG <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> -F<span class=\"token string\">'\"'</span> <span class=\"token string\">'{print $2}'</span><span class=\"token variable\">)</span></span>\r\n\r\n<span class=\"token comment\"># OLD_SERVICEê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ì˜¤ë¥˜ ì²˜ë¦¬</span>\r\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-z</span> <span class=\"token string\">\"<span class=\"token variable\">$OLD_SERVICE</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\r\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"âŒ í˜„ì¬ ë¼ìš°íŒ…ëœ ì„œë¹„ìŠ¤ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë¼ìš°íŒ… ë³€ê²½ì„ ì¤‘ë‹¨í•©ë‹ˆë‹¤.\"</span>\r\n  <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span>\r\n<span class=\"token keyword\">fi</span>\r\n\r\n<span class=\"token comment\"># 3ï¸âƒ£ OLD_SERVICEê°€ Blueì¸ì§€ Greenì¸ì§€ í™•ì¸í•˜ê³  ë°˜ëŒ€ ì„œë¹„ìŠ¤ë¡œ ì „í™˜</span>\r\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$OLD_SERVICE</span>\"</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"<span class=\"token variable\">$BLUE_SERVICE</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\r\n  <span class=\"token assign-left variable\">TARGET_SERVICE</span><span class=\"token operator\">=</span><span class=\"token variable\">$GREEN_SERVICE</span>\r\n<span class=\"token keyword\">else</span>\r\n  <span class=\"token assign-left variable\">TARGET_SERVICE</span><span class=\"token operator\">=</span><span class=\"token variable\">$BLUE_SERVICE</span>\r\n<span class=\"token keyword\">fi</span>\r\n\r\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"ğŸ”„ í˜„ì¬ ìš´ì˜ ì¤‘ì¸ ì„œë¹„ìŠ¤: <span class=\"token variable\">$OLD_SERVICE</span>\"</span>\r\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"ğŸš€ ìƒˆë¡œìš´ ë¼ìš°íŒ… ëŒ€ìƒ ì„œë¹„ìŠ¤: <span class=\"token variable\">$TARGET_SERVICE</span>\"</span>\r\n\r\n<span class=\"token comment\"># 4ï¸âƒ£ `dynamic-config.yml` ì—…ë°ì´íŠ¸ (ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ë¡œ ë¼ìš°íŒ… ë³€ê²½)</span>\r\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"ğŸ”„ Updating dynamic-config.yml to roll back to <span class=\"token variable\">$TARGET_SERVICE</span>...\"</span>\r\n<span class=\"token function\">cat</span> <span class=\"token operator\">></span> <span class=\"token variable\">$DYNAMIC_CONFIG</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOL\r\nhttp:\r\n  routers:\r\n    <span class=\"token variable\">$SERVICE</span>:\r\n      entryPoints:\r\n        - \"web\"\r\n      rule: \"Host(\\<span class=\"token variable\"><span class=\"token variable\">`</span>$DOMAIN<span class=\"token punctuation\">\\</span><span class=\"token variable\">`</span></span>)\"\r\n      service: \"<span class=\"token variable\">$TARGET_SERVICE</span>\"\r\n\r\n  services:\r\n    <span class=\"token variable\">$BLUE_SERVICE</span>:\r\n      loadBalancer:\r\n        servers:\r\n          - url: \"http://<span class=\"token variable\">$BLUE_SERVICE</span>:<span class=\"token variable\">$PORT</span>\"\r\n\r\n    <span class=\"token variable\">$GREEN_SERVICE</span>:\r\n      loadBalancer:\r\n        servers:\r\n          - url: \"http://<span class=\"token variable\">$GREEN_SERVICE</span>:<span class=\"token variable\">$PORT</span>\"\r\nEOL</span>\r\n\r\n<span class=\"token comment\"># 5ï¸âƒ£ Traefikì´ ì„¤ì •ì„ ìë™ ê°ì§€í•˜ë„ë¡ íŠ¸ë¦¬ê±°</span>\r\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"â™»ï¸ Triggering Traefik reload...\"</span>\r\n<span class=\"token function\">touch</span> <span class=\"token variable\">$DYNAMIC_CONFIG</span>\r\n\r\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"ğŸ‰ Rollback complete! Traffic is now routed to <span class=\"token variable\">$TARGET_SERVICE</span>.\"</span></code></pre></div>\n<br>\r\n<br>\n<h3 id=\"3-ì–´ë ¤ì› ë˜-ì \" style=\"position:relative;\"><a href=\"#3-%EC%96%B4%EB%A0%A4%EC%9B%A0%EB%8D%98-%EC%A0%90\" aria-label=\"3 ì–´ë ¤ì› ë˜ ì  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. ì–´ë ¤ì› ë˜ ì </h3>\n<hr>\n<p>ê°€ì¥ ë§ì´ ê¸°ìˆ ì ìœ¼ë¡œ ì‹œê°„ì„ í• ì• í•œ ë¶€ë¶„ì€ Blue í™˜ê²½ì´ ìš´ì˜ì¤‘ì— Green í™˜ê²½ ì¶”ê°€ë¡œ ì»¨í…Œì´ë„ˆë¡œ ë°°í¬í•˜ë©´ <code class=\"language-text\">traefik</code>ì´ ìë™ìœ¼ë¡œ Green í™˜ê²½ê¹Œì§€ ì¸ì‹í•˜ì—¬ íŠ¸ë˜í”½ì„ ë³´ë‚´ëŠ” ìƒí™©ì„ ê°œì„ í•˜ëŠ” ë¶€ë¶„ì´ì—ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.docker=true  <span class=\"token comment\">#Docker ì»¨í…Œì´ë„ˆì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì„œë¹„ìŠ¤ë“¤ì„ ìë™ìœ¼ë¡œ ê°ì§€í•˜ë„ë¡ ì„¤ì •</span>\r\n<span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.docker.watch=true  <span class=\"token comment\">#Dockerì—ì„œ ìƒˆë¡œìš´ ì»¨í…Œì´ë„ˆê°€ ìƒì„±ë˜ê±°ë‚˜ ë³€ê²½ë  ê²½ìš° ìë™ìœ¼ë¡œ ê°ì§€.</span></code></pre></div>\n<p><code class=\"language-text\">traefik</code> ì»¨í…Œì´ë„ˆì˜ ìœ„ ë‘ ì„¤ì •ì€ ë°˜ë“œì‹œ í•„ìš”í•˜ì§€ë§Œ ê·¸ë ‡ê¸°ì— Blue / Green í™˜ê²½ì„ ë…ë¦½ì ì¸ í™˜ê²½ìœ¼ë¡œ ê°ê° ë¶„ë¦¬í•˜ê¸°ê°€ ì–´ë µê²Œí•˜ëŠ” ìš”ì¸ ì¤‘ í•˜ë‚˜ì˜€ë‹¤. ğŸ¥²</p>\n<br>\n<p>ìµœì¢…ì ìœ¼ë¡œëŠ” ì»¨í…Œì´ë„ˆë§ˆë‹¤ Blue / Green ë¼ë²¨ì„ ë¶€ì—¬í•´ì„œ ë¼ìš°íŒ…ì„ ë™ì ìœ¼ë¡œ í• ë‹¹í•˜ëŠ” ë°©ë²•ì„ ì±„íƒí•˜ì—¬ ì‚¬ìš©í•˜ì˜€ì§€ë§Œ, ê·¸ ê³¼ì •ì´ ìˆœíƒ„í•˜ì§€ëŠ” ì•Šì•˜ë‹¤.</p>\n<ul>\n<li><strong>TARGET_SERVICE</strong>ë¡œ ì „ë‹¬ë˜ëŠ” íŠ¸ë˜í”½ì„ ì°¨ë‹¨ í•˜ê¸° ìœ„í•´ Docker Networkë¥¼ ì„ì‹œë¡œ ì—°ê²°ì„ ëŠëŠ”ë‹¤. â†’ ì™¸ë¶€ DB ì—°ê²°ì´ ëŠê¸°ë©° ORMì—ì„œ DB ì—°ê²° ì´ˆê¸°í™”ê°€ ë˜ì§€ ì•ŠëŠ” ì´ìŠˆê°€ ë°œìƒí•˜ë©° Health Checkë¥¼ í†µê³¼í•˜ì§€ ëª»í•œë‹¤. ğŸ˜…</li>\n<li><strong>TARGET_SERVICE</strong>ê°€ ìƒˆë¡œ ë°°í¬ í›„ Health Checkë¥¼ í†µê³¼í•˜ë©´ <strong>OLD_SERVICE</strong>ë¥¼ ë°”ë¡œ ì œê±°í•œë‹¤. â†’ ìˆ˜ ì´ˆ ë‚´ì™¸ë¡œ ë‘ ì„œë¹„ìŠ¤ê°€ ê³µì¡´í•˜ëŠ” ìˆœê°„ì´ ë°œìƒí•  ìˆ˜ ë°–ì— ì—†ìœ¼ë©°, ì´ìƒì ì¸ Blue / Green ë°°í¬ ì „ëµê³¼ëŠ” ê±°ë¦¬ê°€ ë©€ë‹¤. ğŸ˜…</li>\n</ul>\n<br>\n<p>ìƒê°ë‚˜ëŠ”ëŒ€ë¡œ ì ì–´ë³´ë‹ˆ ìœ„ì™€ ê°™ì€ ê²½ìš°ë“¤ì´ ìƒê°ì´ ë‚œë‹¤.</p>\n<br>\r\n<br>\n<h2 id=\"-understanding\" style=\"position:relative;\"><a href=\"#-understanding\" aria-label=\" understanding permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ğŸ¤” Understanding</h2>\n<p>ì‚¬ì‹¤ ì‹¤ì œë¡œ ê°€ì¥ ë§ì€ ì‹œê°„ì„ í• ì• í•œ ë¶€ë¶„ì€ ê¸°ìˆ  ê²€ì¦ì´ì—ˆë‹¤.</p>\n<ul>\n<li>ìœ íœ´ ì»¨í…Œì´ë„ˆë“¤ë¡œ ì¸í•´ ë¦¬ì†ŒìŠ¤ ë‚­ë¹„ê°€ ë°œìƒí•  ìˆ˜ ë°–ì— ì—†ëŠ”ë° ì´ëŠ” ì–¼ë§ˆë‚˜ í° ì˜í–¥ì„ ë¯¸ì¹˜ëŠ”ê°€?</li>\n<li>ê¸°ì¡´ì— ë°°í¬í•˜ëŠ” ë°©ì‹(Recreated)ì— ë¹„í•´ ì–´ë–¤ì ì´ ì–¼ë§ˆë‚˜ ê°œì„ í•˜ëŠ”ì§€ì— ëŒ€í•œ ì •ëŸ‰ì ì¸ ìˆ˜ì¹˜í™”</li>\n<li>ë°°í¬ ì‹¤íŒ¨ì‹œ í”ŒëœB ê³„íš</li>\n</ul>\n<p>ì´ ì™¸ì— ë¬´ì¤‘ë‹¨ ë°°í¬ë¥¼ í™œìš©í•  ìˆ˜ ìˆëŠ” íŒŒì´í”„ë¼ì¸ (Hotfix) ì¶”ê°€ ë“±ë“±.. ê°œë°œ ì™¸ì ì¸ ë¶€ë¶„ë“¤ì—ì„œ ë”ìš± ë” ì‹œê°„ê³¼ ì‹ ê²½ì„ ë§ì´ ì¼ë˜ê±° ê°™ë‹¤.</p>\n<br>\r\n<br>","excerpt":"âœï¸ Today I Learned ì‚¬ë‚´ ì¸í”„ë¼ëŠ” ë¹„êµì  ì„±ëŠ¥ì´ ì¢‹ì€ ì„œë²„ë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤. (ìˆ˜í‰ì  í™•ì¥ì´ í˜ë“¤ì–´ì„œ.. ğŸ¥²) ê·¸ë ‡ê¸°ì— ì´ˆê¸° ì¸í”„ë¼ë¥¼ êµ¬ì„±í•  ë• ë¦¬ì†ŒìŠ¤ ë¶€ì¡±ì— í—ˆë•ì´ì§„ ì•Šê³ ìˆë‹¤. (ë‹¤ë§Œ, ìš”ì²­ì´ ê¸‰ì¦í• êº¼ë¼ ì˜ˆìƒë  ë•Œ ìˆ˜í‰ì ìœ¼ë¡œ í™•ì¥í•˜ê¸°ëŠ” ì‰½ì§€ ì•Šë‹¤.) ì´ëŸ¬í•œ ë°”íƒ•ì„ í† ëŒ€ë¡œ ì˜¨í”„ë ˆë¯¸ìŠ¤ í™˜ê²½ì—ì„œ Docker Composeë¡œ Blue/Green ë°°í¬ ì „ëµì„ êµ¬í˜„í•œ ê³¼ì •ì„ ê°„ëµíˆ í¬ìŠ¤íŒ…ìœ¼ë¡œ ë‚¨ê¸°ë ¤í•œë‹¤. 1. Blue/Green ë°°í¬ë€? ê°„ë‹¨íˆ ì†Œê°œí•˜ìë©´, ì—¬ëŸ¬ ë¬´ì¤‘ë‹¨ ë°°í¬ ê¸°ë²• ì¤‘ í•˜ë‚˜ì´ë©° ë‘ ê°œì˜ ë…ë¦½ì ì¸ í™˜ê²½ Blue(êµ¬ë²„ì „) í™˜ê²½ê³¼ Green(ì‹ ë²„ì „) í™˜ê²½ì„ ê°€ì§€ê³  ì§„í–‰ë˜ëŠ” ë°°í¬ ì „ëµì´ë‹¤. blue/green êµ¬ë²„ì „ì´ ìš´ì˜ë˜ëŠ” ë™ì•ˆ ì‹ ë²„ì „ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ êµ¬ì„±í•œ í›„ ë¡œë“œë°¸ëŸ°ì„œë¥¼ í†µí•´ ì‹ ë²„ì „ìœ¼ë¡œ ëª¨ë“  íŠ¸ë˜í”½ì„ ì¼ì‹œì— ì „í™˜í•˜ëŠ” ë°°í¬ ë°©ì‹ì´ë‹¤. ì‹ ë²„ì „ì— ë¬¸ì œê°€ ìƒê¸°ëŠ” ê²½ìš° ë¡œë“œë°¸ëŸ°ì„œì˜ ë¼ìš°íŒ…ë§Œ êµ¬ë²„ì „ìœ¼ë¡œ ë³€ê²½í•´ì£¼ë©´ ì† ì‰½ê²Œ ë¡¤ë°±ì´ ê°€ëŠ¥í•œ ì¥ì  ë˜í•œ ìˆì§€ë§Œ ê·¸ ë§Œí¼ ë¦¬ì†ŒìŠ¤ë¥¼ ë§ì´ â€¦","timeToRead":8,"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EF%B8%8F-today-i-learned\">âœï¸ <strong>T</strong>oday <strong>I</strong> <strong>L</strong>earned</a></p>\n<ul>\n<li>\n<p><a href=\"#1-bluegreen-%EB%B0%B0%ED%8F%AC%EB%9E%80\">1. Blue/Green ë°°í¬ë€?</a></p>\n</li>\n<li>\n<p><a href=\"#2-docker-compose\">2. Docker Compose</a></p>\n<ul>\n<li><a href=\"#2-1-traefik\">2-1. traefik</a></li>\n<li><a href=\"#2-2-web-server\">2-2. web-server</a></li>\n<li><a href=\"#2-3-%EB%B0%B0%ED%8F%AC-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8\">2-3. ë°°í¬ ìŠ¤í¬ë¦½íŠ¸</a></li>\n<li><a href=\"#2-4-%EB%9D%BC%EC%9A%B0%ED%8C%85-%EC%A0%95%EC%B1%85-%EB%B3%80%EA%B2%BD-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8\">2-4. ë¼ìš°íŒ… ì •ì±… ë³€ê²½ ìŠ¤í¬ë¦½íŠ¸</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#3-%EC%96%B4%EB%A0%A4%EC%9B%A0%EB%8D%98-%EC%A0%90\">3. ì–´ë ¤ì› ë˜ ì </a></p>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-understanding\">ğŸ¤” Understanding</a></p>\n</li>\n</ul>","frontmatter":{"date":"2025.03.16","title":"Docker Composeì™€ Traefikì„ í™œìš©í•œ Blue/Green ë°°í¬ ì „ëµ","categories":"TIL","author":"JH8459","emoji":"ğŸ“š"},"fields":{"slug":"/2025-03-16-TIL/"}},"next":{"id":"ccc5aa54-c730-5be1-9ccb-ce216aea93bb","frontmatter":{"date":"2025.03.13","title":"í”„ë¡œê·¸ë˜ë¨¸ìŠ¤ - ì¡°ì´ìŠ¤í‹± (JS)","categories":"TIL","author":"JH8459","emoji":"ğŸ“š"},"fields":{"slug":"/2025-03-13-TIL/"}},"prev":{"id":"432cde99-c9ea-5abf-b506-22f44bd4aa83","frontmatter":{"date":"2025.03.19","title":"Nest CLI ëœ¯ì–´ë³´ê¸° (nest start)","categories":"TIL","author":"JH8459","emoji":"ğŸ“š"},"fields":{"slug":"/2025-03-19-TIL/"}},"site":{"siteMetadata":{"siteUrl":"https://blog.jh8459.com","comments":{"giscus":{"repo":"JH8459/JH8459.github.io","repoId":"R_kgDOI03HgA","category":"Comments","categoryId":"DIC_kwDOI03HgM4CtuXL"}}}}},"pageContext":{"slug":"/2025-03-16-TIL/","nextSlug":"/2025-03-13-TIL/","prevSlug":"/2025-03-19-TIL/"}},"staticQueryHashes":["1073350324","2009502679","2938748437","962130685"],"slicesMap":{}}