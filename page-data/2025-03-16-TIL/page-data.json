{"componentChunkName":"component---src-templates-blog-template-js","path":"/2025-03-16-TIL/","result":{"data":{"cur":{"id":"ef14b66f-1f4b-5a84-b362-df00d9c6bfd9","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECA//EABUBAQEAAAAAAAAAAAAAAAAAAAAF/9oADAMBAAIQAxAAAAHSaSawD//EABYQAAMAAAAAAAAAAAAAAAAAAAABIP/aAAgBAQABBQIU/wD/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAAIDH/2gAIAQEABj8CIv8A/8QAGBAAAgMAAAAAAAAAAAAAAAAAAAERIDH/2gAIAQEAAT8hGb2Ff//aAAwDAQACAAMAAAAQHD//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAZEAACAwEAAAAAAAAAAAAAAAABEQAgQVH/2gAIAQEAAT8QjVhju1//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"github-blog.png\"\n        title=\"github-blog.png\"\n        src=\"/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/80e3c/TIL.jpg\"\n        srcset=\"/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/4ec73/TIL.jpg 180w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/158ba/TIL.jpg 360w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/80e3c/TIL.jpg 720w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/47311/TIL.jpg 1080w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/ac614/TIL.jpg 1272w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<h2 id=\"️-today-i-learned\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-today-i-learned\" aria-label=\"️ today i learned permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✍️ <strong>T</strong>oday <strong>I</strong> <strong>L</strong>earned</h2>\n<p>사내 인프라는 비교적 성능이 좋은 서버를 사용하고 있다. <del>(수평적 확장이 힘들어서.. 🥲)</del> 그렇기에 많은 유휴 리소스들을 바탕으로 사내 배포 전략은 Blue/Green 배포 전략을 사용 중이다.</p>\n<p>온프레미스 환경에서 Docker Compose 환경으로 배포 전략을 구현한 과정을 간략히 포스팅으로 남기려한다.</p>\n<br>\n<br>\n<h3 id=\"1-bluegreen-배포란\" style=\"position:relative;\"><a href=\"#1-bluegreen-%EB%B0%B0%ED%8F%AC%EB%9E%80\" aria-label=\"1 bluegreen 배포란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Blue/Green 배포란?</h3>\n<hr>\n<p>간단히 소개하자면, 여러 무중단 배포 기법 중 하나이며 두 개의 독립적인 환경 <code class=\"language-text\">Blue</code>(구버전) 환경과 <code class=\"language-text\">Green</code>(신버전) 환경을 가지고 진행되는 배포 전략이다.</p>\n<br>\n<p><img src=\"https://jh8459.s3.ap-northeast-2.amazonaws.com/blog/2025-03-16-TIL/blue_green.jpg\" alt=\"blue/green\"></p>\n<center>출처 : <a href=\"https://www.samsungsds.com/kr/insights/1256264_4627.html\" target=\"_blank\">무중단 배포 아키텍처(Zero Downtime Deployment)- 글로벌 서비스 운영의 필수 요소\n</a></center><br>\n<p>구버전이 운영되는 동안 신버전의 인스턴스를 구성한 후 로드밸런서를 통해 신버전으로 모든 트래픽을 일시에 전환하는 배포 방식이다.</p>\n<p>신버전에 문제가 생기는 경우 로드밸런서의 라우팅만 구버전으로 변경해주면 손 쉽게 롤백이 가능한 장점 또한 있지만 그 만큼 리소스를 많이 사용한다. (사용한 만큼 지불하는 서버리스 컴퓨팅 환경이라면 채택 못할거같다. 🥲)</p>\n<br>\n<br>\n<h3 id=\"2-구현-과정\" style=\"position:relative;\"><a href=\"#2-%EA%B5%AC%ED%98%84-%EA%B3%BC%EC%A0%95\" aria-label=\"2 구현 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 구현 과정</h3>\n<hr>\n<p>여러 컨테이너들을 Docker Compose 환경으로 구성하여 Blue/Green 배포 전략을 구현해볼 예정이다.</p>\n<p>우선 <code class=\"language-text\">docker-compose.yml</code> 파일을 살펴보면 다음과 같이 구성하였다. (하나하나 천천히 살펴 볼 예정이다.)</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">traefik</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> traefik<span class=\"token punctuation\">:</span>latest\n    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>log.level=ERROR\n      <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.docker=true\n      <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.docker.watch=true\n      <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.docker.exposedbydefault=false\n      <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>entrypoints.web.address=<span class=\"token punctuation\">:</span><span class=\"token number\">3000</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>entrypoints.web.forwardedHeaders.insecure=true\n      <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.file.filename=/etc/traefik/dynamic<span class=\"token punctuation\">-</span>config.yml\n      <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.file.watch=true\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"3000:3000\"</span>\n    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> /var/run/docker.sock<span class=\"token punctuation\">:</span>/var/run/docker.sock<span class=\"token punctuation\">:</span>ro\n      <span class=\"token punctuation\">-</span> ./dynamic<span class=\"token punctuation\">-</span>config.yml<span class=\"token punctuation\">:</span>/etc/traefik/dynamic<span class=\"token punctuation\">-</span>config.yml\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> net_default\n\n  <span class=\"token key atrule\">web-server-blue</span><span class=\"token punctuation\">:</span> <span class=\"token important\">&amp;web-server-template</span>\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">context</span><span class=\"token punctuation\">:</span> .\n      <span class=\"token key atrule\">dockerfile</span><span class=\"token punctuation\">:</span> Dockerfile\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> ./src<span class=\"token punctuation\">:</span>/myfolder/src\n    <span class=\"token key atrule\">env_file</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> ./.env\n    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always\n    <span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> traefik.enable=true\n      <span class=\"token punctuation\">-</span> traefik.http.services.web<span class=\"token punctuation\">-</span>server<span class=\"token punctuation\">-</span>blue.loadbalancer.server.port=3000\n    <span class=\"token key atrule\">healthcheck</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">test</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'CMD'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'curl'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-f'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'http://localhost:3000/health'</span><span class=\"token punctuation\">]</span>\n      <span class=\"token key atrule\">interval</span><span class=\"token punctuation\">:</span> 30s\n      <span class=\"token key atrule\">timeout</span><span class=\"token punctuation\">:</span> 10s\n      <span class=\"token key atrule\">retries</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n      <span class=\"token key atrule\">start_period</span><span class=\"token punctuation\">:</span> 30s\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> net_default\n\n  <span class=\"token key atrule\">web-server-green</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">&lt;&lt;</span><span class=\"token punctuation\">:</span> <span class=\"token important\">*web-server-template</span>\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> traefik.enable=true\n      <span class=\"token punctuation\">-</span> traefik.http.services.web<span class=\"token punctuation\">-</span>server<span class=\"token punctuation\">-</span>green.loadbalancer.server.port=3000\n\n<span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">net_default</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">driver</span><span class=\"token punctuation\">:</span> bridge</code></pre></div>\n<br>\n<br>\n<h4 id=\"2-1-traefik\" style=\"position:relative;\"><a href=\"#2-1-traefik\" aria-label=\"2 1 traefik permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-1. traefik</h4>\n<hr>\n<p><code class=\"language-text\">traefik</code> 컨테이너는 로드밸런서로써 구버전과 신버전 컨테이너에 라우팅 정책을 담당할 예정이다. (볼룸을 꼭 설정해주자.)</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">traefik</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> traefik<span class=\"token punctuation\">:</span>latest\n  <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>log.level=ERROR\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.docker=true  <span class=\"token comment\">#Docker 컨테이너에서 실행 중인 서비스들을 자동으로 감지하도록 설정</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.docker.watch=true  <span class=\"token comment\">#Docker에서 새로운 컨테이너가 생성되거나 변경될 경우 자동으로 감지.</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.docker.exposedbydefault=false  <span class=\"token comment\">#기본적으로 모든 Docker 컨테이너를 Traefik이 라우팅하지 않도록 설정. (labels를 통해 개별적으로 노출해야 함)</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>entrypoints.web.address=<span class=\"token punctuation\">:</span><span class=\"token number\">3000</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>entrypoints.web.forwardedHeaders.insecure=true\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.file.filename=/etc/traefik/dynamic<span class=\"token punctuation\">-</span>config.yml  <span class=\"token comment\">#dynamic-config.yml 파일에서 추가적인 동적 설정을 읽도록 지정.</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>providers.file.watch=true  <span class=\"token comment\">#설정 파일이 변경되면 자동으로 감지하여 적용하도록 설정.</span>\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"3000:3000\"</span>\n  <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always\n  <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> /var/run/docker.sock<span class=\"token punctuation\">:</span>/var/run/docker.sock<span class=\"token punctuation\">:</span>ro\n    <span class=\"token punctuation\">-</span> ./dynamic<span class=\"token punctuation\">-</span>config.yml<span class=\"token punctuation\">:</span>/etc/traefik/dynamic<span class=\"token punctuation\">-</span>config.yml\n  <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> net_default</code></pre></div>\n<p>라우팅은 현재 운영 중인 버전(Blue/Green)을 확인해서 변환되어야하므로 추후 기재할 <code class=\"language-text\">dynamic-config.yml</code> 파일로 동적으로 제어할 예정이다.</p>\n<br>\n<br>\n<h4 id=\"2-2-web-server\" style=\"position:relative;\"><a href=\"#2-2-web-server\" aria-label=\"2 2 web server permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-2. web-server</h4>\n<hr>\n<p><code class=\"language-text\">web-server</code> 컨테이너는 예제에는 <code class=\"language-text\">replicas</code>를 2개로 구성해 두었다. 각각 2개의 컨테이너씩 Blue / Green 환경이 존재한다. (동일한 환경으로 구성해야하므로 Blue 컨테이너를 템플릿으로 Green 컨테이너에 사용하였다.)</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">web-server-blue</span><span class=\"token punctuation\">:</span> <span class=\"token important\">&amp;web-server-template</span>  <span class=\"token comment\">#&amp;web-server-template을 사용하여 YAML 앵커(Anchor)로 설정을 저장. → web-server-green이 이 설정을 그대로 가져다 사용할 수 있음.</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\">#현재 디렉토리(.)에서 Dockerfile을 사용하여 컨테이너 이미지를 빌드함. (이미지 파일을 사용해도 된다.)</span>\n    <span class=\"token key atrule\">context</span><span class=\"token punctuation\">:</span> .\n    <span class=\"token key atrule\">dockerfile</span><span class=\"token punctuation\">:</span> Dockerfile\n  <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> ./src<span class=\"token punctuation\">:</span>/myfolder/src\n  <span class=\"token key atrule\">env_file</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> ./.env\n  <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always\n  <span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> traefik.enable=true  <span class=\"token comment\">#이 컨테이너가 Traefik의 라우팅 대상으로 포함되도록 설정.</span>\n    <span class=\"token punctuation\">-</span> traefik.http.services.web<span class=\"token punctuation\">-</span>server<span class=\"token punctuation\">-</span>blue.loadbalancer.server.port=3000\n  <span class=\"token key atrule\">healthcheck</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">test</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'CMD'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'curl'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-f'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'http://localhost:3000/health'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">interval</span><span class=\"token punctuation\">:</span> 30s\n    <span class=\"token key atrule\">timeout</span><span class=\"token punctuation\">:</span> 10s\n    <span class=\"token key atrule\">retries</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n    <span class=\"token key atrule\">start_period</span><span class=\"token punctuation\">:</span> 30s\n  <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> net_default\n\n<span class=\"token key atrule\">web-server-green</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">&lt;&lt;</span><span class=\"token punctuation\">:</span> <span class=\"token important\">*web-server-template</span>  <span class=\"token comment\">#web-server-green은 web-server-blue와 같은 이미지, 볼륨, 네트워크 등을 사용.</span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> traefik.enable=true\n    <span class=\"token punctuation\">-</span> traefik.http.services.web<span class=\"token punctuation\">-</span>server<span class=\"token punctuation\">-</span>green.loadbalancer.server.port=3000</code></pre></div>\n<p>위 코드는 예시 이므로 각자 환경에 알맞게 이미지를 내려받던 빌드를 직접하던지 상황에 알맞게 구성하면 된다.</p>\n<br>\n<br>\n<h4 id=\"2-3-배포-스크립트\" style=\"position:relative;\"><a href=\"#2-3-%EB%B0%B0%ED%8F%AC-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8\" aria-label=\"2 3 배포 스크립트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-3. 배포 스크립트</h4>\n<hr>\n<p>위 <code class=\"language-text\">docker-compose.yml</code> 파일을 <code class=\"language-text\">docker compose up --build -d</code> 명령어로 실행하면 Blue / Green 서비스마다 컨테이너가 2개씩 생성된다. 이는 의도한바가 아니므로 bash 스크립트로 적절히 제어하여 컨테이너를 구성하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n<span class=\"token comment\"># 환경 변수 설정</span>\n<span class=\"token assign-left variable\">DYNAMIC_CONFIG</span><span class=\"token operator\">=</span><span class=\"token string\">\"dynamic-config.yml\"</span>\n<span class=\"token assign-left variable\">COMPOSE_FILE</span><span class=\"token operator\">=</span><span class=\"token string\">\"docker-compose.yml\"</span>\n<span class=\"token assign-left variable\">DOMAIN</span><span class=\"token operator\">=</span><span class=\"token string\">\"localhost\"</span>\n<span class=\"token assign-left variable\">SERVICE</span><span class=\"token operator\">=</span><span class=\"token string\">\"web-server\"</span>\n<span class=\"token assign-left variable\">BLUE_SERVICE</span><span class=\"token operator\">=</span><span class=\"token string\">\"web-server-blue\"</span>\n<span class=\"token assign-left variable\">GREEN_SERVICE</span><span class=\"token operator\">=</span><span class=\"token string\">\"web-server-green\"</span>\n<span class=\"token assign-left variable\">PORT</span><span class=\"token operator\">=</span><span class=\"token number\">3000</span>\n<span class=\"token assign-left variable\">REPLICAS</span><span class=\"token operator\">=</span><span class=\"token number\">2</span>\n\n<span class=\"token comment\"># 1️⃣ dynamic-config.yml 파일(동적 라우팅 담당)이 없으면 생성</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token operator\">!</span> <span class=\"token parameter variable\">-f</span> <span class=\"token string\">\"<span class=\"token variable\">$DYNAMIC_CONFIG</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"⚠️ <span class=\"token variable\">$DYNAMIC_CONFIG</span> 파일이 존재하지 않습니다. 기본값으로 생성합니다.\"</span>\n  <span class=\"token function\">cat</span> <span class=\"token operator\">></span> <span class=\"token variable\">$DYNAMIC_CONFIG</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOL\nhttp:\n  routers:\n    <span class=\"token variable\">$SERVICE</span>:\n      entryPoints:\n        - \"web\"\n      rule: \"Host(\\<span class=\"token variable\">$DOMAIN</span>\\)\"\n      service: \"<span class=\"token variable\">$BLUE_SERVICE</span>\"\n\n  services:\n    <span class=\"token variable\">$BLUE_SERVICE</span>:\n      loadBalancer:\n        servers:\n          - url: \"http://<span class=\"token variable\">$BLUE_SERVICE</span>:<span class=\"token variable\">$PORT</span>\"\n\n    <span class=\"token variable\">$GREEN_SERVICE</span>:\n      loadBalancer:\n        servers:\n          - url: \"http://<span class=\"token variable\">$GREEN_SERVICE</span>:<span class=\"token variable\">$PORT</span>\"\nEOL</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"✅ 기본 <span class=\"token variable\">$DYNAMIC_CONFIG</span> 파일이 생성되었습니다.\"</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token comment\"># 2️⃣ 현재 실행 중인 서비스 확인</span>\n<span class=\"token assign-left variable\">BLUE_RUNNING</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">docker</span> <span class=\"token function\">ps</span> <span class=\"token parameter variable\">--filter</span> <span class=\"token string\">\"name=<span class=\"token variable\">$BLUE_SERVICE</span>\"</span> <span class=\"token parameter variable\">--format</span> <span class=\"token string\">\"{{.Names}}\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> <span class=\"token parameter variable\">-l</span><span class=\"token variable\">)</span></span>\n<span class=\"token assign-left variable\">GREEN_RUNNING</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">docker</span> <span class=\"token function\">ps</span> <span class=\"token parameter variable\">--filter</span> <span class=\"token string\">\"name=<span class=\"token variable\">$GREEN_SERVICE</span>\"</span> <span class=\"token parameter variable\">--format</span> <span class=\"token string\">\"{{.Names}}\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> <span class=\"token parameter variable\">-l</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token assign-left variable\">FIRST_DEPLOY</span><span class=\"token operator\">=</span>false\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$BLUE_RUNNING</span>\"</span> <span class=\"token parameter variable\">-eq</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$GREEN_RUNNING</span>\"</span> <span class=\"token parameter variable\">-eq</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"🆕 최초 배포입니다. Blue 서비스부터 시작합니다.\"</span>\n  <span class=\"token assign-left variable\">TARGET_SERVICE</span><span class=\"token operator\">=</span><span class=\"token variable\">$BLUE_SERVICE</span>\n  <span class=\"token assign-left variable\">OLD_SERVICE</span><span class=\"token operator\">=</span><span class=\"token string\">\"\"</span>\n  <span class=\"token assign-left variable\">FIRST_DEPLOY</span><span class=\"token operator\">=</span>true\n<span class=\"token keyword\">else</span>\n  <span class=\"token comment\"># 3️⃣ dynamic-config.yml에서 OLD_SERVICE 가져오기</span>\n  <span class=\"token assign-left variable\">OLD_SERVICE</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">grep</span> <span class=\"token string\">\"service:\"</span> $DYNAMIC_CONFIG <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> -F<span class=\"token string\">'\"'</span> <span class=\"token string\">'{print $2}'</span><span class=\"token variable\">)</span></span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-z</span> <span class=\"token string\">\"<span class=\"token variable\">$OLD_SERVICE</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"❌ 현재 라우팅된 서비스 정보를 가져오지 못했습니다. 배포를 중단합니다.\"</span>\n    <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span>\n  <span class=\"token keyword\">fi</span>\n\n  <span class=\"token comment\"># 4️⃣ 현재 실행 중인 컨테이너 확인하여 OLD_SERVICE가 아닌 컨테이너 찾기</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$OLD_SERVICE</span>\"</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"<span class=\"token variable\">$BLUE_SERVICE</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token assign-left variable\">TARGET_SERVICE</span><span class=\"token operator\">=</span><span class=\"token variable\">$GREEN_SERVICE</span>\n  <span class=\"token keyword\">else</span>\n    <span class=\"token assign-left variable\">TARGET_SERVICE</span><span class=\"token operator\">=</span><span class=\"token variable\">$BLUE_SERVICE</span>\n  <span class=\"token keyword\">fi</span>\n\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"🔄 현재 라우팅된 서비스: <span class=\"token variable\">$OLD_SERVICE</span>\"</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"🚀 새로운 배포 대상 서비스: <span class=\"token variable\">$TARGET_SERVICE</span>\"</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token comment\"># 5️⃣ 새로운 서비스 빌드</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"🚀 Building the new version of the service: <span class=\"token variable\">$TARGET_SERVICE</span>...\"</span>\n<span class=\"token function\">docker</span> compose <span class=\"token parameter variable\">-f</span> <span class=\"token variable\">$COMPOSE_FILE</span> build <span class=\"token variable\">$TARGET_SERVICE</span>\n\n<span class=\"token comment\"># 6️⃣ 새로운 컨테이너 실행</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"🚀 Deploying new service: <span class=\"token variable\">$TARGET_SERVICE</span> with <span class=\"token variable\">$REPLICAS</span> replicas...\"</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$FIRST_DEPLOY</span>\"</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  <span class=\"token function\">docker</span> compose <span class=\"token parameter variable\">-f</span> <span class=\"token variable\">$COMPOSE_FILE</span> up <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--scale</span> <span class=\"token variable\">$BLUE_SERVICE</span><span class=\"token operator\">=</span><span class=\"token variable\">$REPLICAS</span> <span class=\"token parameter variable\">--scale</span> <span class=\"token variable\">$GREEN_SERVICE</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>\n<span class=\"token keyword\">else</span>\n  <span class=\"token function\">docker</span> compose <span class=\"token parameter variable\">-f</span> <span class=\"token variable\">$COMPOSE_FILE</span> up <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--scale</span> <span class=\"token variable\">$TARGET_SERVICE</span><span class=\"token operator\">=</span><span class=\"token variable\">$REPLICAS</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token comment\"># 7️⃣ 새로운 서비스 Health Check</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"🛠️ Checking health status of <span class=\"token variable\">$TARGET_SERVICE</span>...\"</span>\n<span class=\"token function\">sleep</span> <span class=\"token number\">10</span>  <span class=\"token comment\"># 안정화 시간</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">i</span> <span class=\"token keyword\">in</span> <span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">..</span><span class=\"token number\">12</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span>\n  <span class=\"token assign-left variable\">HEALTHY_COUNT</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">docker</span> <span class=\"token function\">ps</span> <span class=\"token parameter variable\">--filter</span> <span class=\"token string\">\"name=<span class=\"token variable\">$TARGET_SERVICE</span>\"</span> <span class=\"token parameter variable\">--filter</span> <span class=\"token string\">\"health=healthy\"</span> <span class=\"token parameter variable\">--format</span> <span class=\"token string\">\"{{.Names}}\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> <span class=\"token parameter variable\">-l</span><span class=\"token variable\">)</span></span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$HEALTHY_COUNT</span>\"</span> <span class=\"token parameter variable\">-gt</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"✅ New service <span class=\"token variable\">$TARGET_SERVICE</span> is healthy!\"</span>\n    <span class=\"token builtin class-name\">break</span>\n  <span class=\"token keyword\">fi</span>\n\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"⏳ Waiting for <span class=\"token variable\">$TARGET_SERVICE</span> to be healthy... (<span class=\"token variable\">$i</span>/12)\"</span>\n  <span class=\"token function\">sleep</span> <span class=\"token number\">10</span>\n<span class=\"token keyword\">done</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$HEALTHY_COUNT</span>\"</span> <span class=\"token parameter variable\">-eq</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"❌ New service <span class=\"token variable\">$TARGET_SERVICE</span> failed to start properly. Rolling back...\"</span>\n  <span class=\"token function\">docker</span> compose <span class=\"token parameter variable\">-f</span> <span class=\"token variable\">$COMPOSE_FILE</span> down <span class=\"token variable\">$TARGET_SERVICE</span>\n  <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token comment\"># 8️⃣ `dynamic-config.yml` 업데이트 (새로운 서비스로 라우팅 변경)</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"🔄 Updating dynamic-config.yml to point to <span class=\"token variable\">$TARGET_SERVICE</span>...\"</span>\n<span class=\"token function\">cat</span> <span class=\"token operator\">></span> <span class=\"token variable\">$DYNAMIC_CONFIG</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOL\nhttp:\n  routers:\n    <span class=\"token variable\">$SERVICE</span>:\n      entryPoints:\n        - \"web\"\n      rule: \"Host(\\<span class=\"token variable\"><span class=\"token variable\">`</span>$DOMAIN<span class=\"token punctuation\">\\</span><span class=\"token variable\">`</span></span>)\"\n      service: \"<span class=\"token variable\">$TARGET_SERVICE</span>\"\n\n  services:\n    <span class=\"token variable\">$BLUE_SERVICE</span>:\n      loadBalancer:\n        servers:\n          - url: \"http://<span class=\"token variable\">$BLUE_SERVICE</span>:<span class=\"token variable\">$PORT</span>\"\n\n    <span class=\"token variable\">$GREEN_SERVICE</span>:\n      loadBalancer:\n        servers:\n          - url: \"http://<span class=\"token variable\">$GREEN_SERVICE</span>:<span class=\"token variable\">$PORT</span>\"\nEOL</span>\n\n<span class=\"token comment\"># 9️⃣ Traefik이 설정을 자동 감지하도록 트리거</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"♻️ Triggering Traefik reload...\"</span>\n<span class=\"token function\">touch</span> <span class=\"token variable\">$DYNAMIC_CONFIG</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"🎉 Deployment complete!\"</span></code></pre></div>\n<br>\n<p>변인 요인들은 환경 변수로 만들어 두었다.</p>\n<p>주석으로 최대한 적어 보았지만 간단히 설명하자면 아래의 순서대로 Blue/Green 배포가 진행된다.</p>\n<ol>\n<li>배포 스크립트가 실행된 디렉토리에 <code class=\"language-text\">dynamic-config.yml</code> 파일이 존재하는지 감지하고 없다면 기본 라우팅 정책(Blue 환경 우선 라우팅)을 담은 파일을 생성한다.</li>\n<li>현재 실행 중인 컨테이너를 확인 후 최초 배포가 이뤄지는 경우인지 확인한다.</li>\n<li>최초 배포가 진행되는 경우가 아니라면, <code class=\"language-text\">dynamic-config.yml</code> 파일을 확인하여 현재 라우팅 중인 <code class=\"language-text\">OLD_SERVICE</code>를 가져온다.</li>\n<li>새로운 서비스를 빌드한다. (경우에 따라 생략 가능)</li>\n<li>새로운 컨테이너(<code class=\"language-text\">TARGET_SERVICE</code>)를 실행한다.</li>\n<li>새로운 컨테이너의 Health Check를 기다린다. (실패시 <code class=\"language-text\">TARGET_SERVICE</code> 컨테이너를 삭제 후 스크립트를 종료)</li>\n<li><code class=\"language-text\">traefik</code> 라우팅 정책을 업데이트 한다. (<code class=\"language-text\">OLD_SERVICE</code> → <code class=\"language-text\">TARGET_SERVICE</code>)</li>\n<li>설정 파일의 변경을 자동으로 감지하도록 <code class=\"language-text\">dynamic-config.yml</code> 파일을 수정한다.</li>\n</ol>\n<p>위 순서대로 동작하므로 신버전(<code class=\"language-text\">TARGET_SERVICE</code>)이 배포되고 안정화 되는 동안 구버전(<code class=\"language-text\">OLD_SERVICE</code>)이 트래픽을 받을 수 있으므로 무중단 배포가 가능하다.</p>\n<br>\n<br>\n<h4 id=\"2-4-라우팅-정책-변경-스크립트\" style=\"position:relative;\"><a href=\"#2-4-%EB%9D%BC%EC%9A%B0%ED%8C%85-%EC%A0%95%EC%B1%85-%EB%B3%80%EA%B2%BD-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8\" aria-label=\"2 4 라우팅 정책 변경 스크립트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-4. 라우팅 정책 변경 스크립트</h4>\n<hr>\n<p>Blue 환경이 새로 배포가 되었다면, Green 환경은 더이상 트래픽을 받지 못하는 유휴 컨테이너로 존재하고 있다.</p>\n<p>이 경우 Blue 환경에 문제가 생겨 Green 환경으로 되돌리고 싶다면 라우팅 정책만 변경해주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n<span class=\"token comment\"># 환경 변수 설정</span>\n<span class=\"token assign-left variable\">DYNAMIC_CONFIG</span><span class=\"token operator\">=</span><span class=\"token string\">\"dynamic-config.yml\"</span>\n<span class=\"token assign-left variable\">COMPOSE_FILE</span><span class=\"token operator\">=</span><span class=\"token string\">\"docker-compose.yml\"</span>\n<span class=\"token assign-left variable\">DOMAIN</span><span class=\"token operator\">=</span><span class=\"token string\">\"localhost\"</span>\n<span class=\"token assign-left variable\">SERVICE</span><span class=\"token operator\">=</span><span class=\"token string\">\"web-server\"</span>\n<span class=\"token assign-left variable\">BLUE_SERVICE</span><span class=\"token operator\">=</span><span class=\"token string\">\"web-server-blue\"</span>\n<span class=\"token assign-left variable\">GREEN_SERVICE</span><span class=\"token operator\">=</span><span class=\"token string\">\"web-server-green\"</span>\n<span class=\"token assign-left variable\">PORT</span><span class=\"token operator\">=</span><span class=\"token number\">3000</span>\n\n<span class=\"token comment\"># 1️⃣ 현재 실행 중인 서비스 확인</span>\n<span class=\"token assign-left variable\">BLUE_RUNNING</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">docker</span> <span class=\"token function\">ps</span> <span class=\"token parameter variable\">--filter</span> <span class=\"token string\">\"name=<span class=\"token variable\">$BLUE_SERVICE</span>\"</span> <span class=\"token parameter variable\">--format</span> <span class=\"token string\">\"{{.Names}}\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> <span class=\"token parameter variable\">-l</span><span class=\"token variable\">)</span></span>\n<span class=\"token assign-left variable\">GREEN_RUNNING</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">docker</span> <span class=\"token function\">ps</span> <span class=\"token parameter variable\">--filter</span> <span class=\"token string\">\"name=<span class=\"token variable\">$GREEN_SERVICE</span>\"</span> <span class=\"token parameter variable\">--format</span> <span class=\"token string\">\"{{.Names}}\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> <span class=\"token parameter variable\">-l</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token comment\"># 둘 다 실행 중이어야 라우팅 정책 변경 가능 (둘 중 하나라도 꺼져 있으면 종료)</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$BLUE_RUNNING</span>\"</span> <span class=\"token parameter variable\">-eq</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$GREEN_RUNNING</span>\"</span> <span class=\"token parameter variable\">-eq</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"❌ Blue와 Green 중 하나라도 실행되지 않으면 라우팅을 변경할 수 없습니다.\"</span>\n  <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token comment\"># 2️⃣ 현재 dynamic-config.yml에서 OLD_SERVICE 가져오기</span>\n<span class=\"token assign-left variable\">OLD_SERVICE</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">grep</span> <span class=\"token string\">\"service:\"</span> $DYNAMIC_CONFIG <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> -F<span class=\"token string\">'\"'</span> <span class=\"token string\">'{print $2}'</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token comment\"># OLD_SERVICE가 설정되지 않았다면 오류 처리</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-z</span> <span class=\"token string\">\"<span class=\"token variable\">$OLD_SERVICE</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"❌ 현재 라우팅된 서비스 정보를 가져오지 못했습니다. 라우팅 변경을 중단합니다.\"</span>\n  <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token comment\"># 3️⃣ OLD_SERVICE가 Blue인지 Green인지 확인하고 반대 서비스로 전환</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$OLD_SERVICE</span>\"</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"<span class=\"token variable\">$BLUE_SERVICE</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n  <span class=\"token assign-left variable\">TARGET_SERVICE</span><span class=\"token operator\">=</span><span class=\"token variable\">$GREEN_SERVICE</span>\n<span class=\"token keyword\">else</span>\n  <span class=\"token assign-left variable\">TARGET_SERVICE</span><span class=\"token operator\">=</span><span class=\"token variable\">$BLUE_SERVICE</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"🔄 현재 운영 중인 서비스: <span class=\"token variable\">$OLD_SERVICE</span>\"</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"🚀 새로운 라우팅 대상 서비스: <span class=\"token variable\">$TARGET_SERVICE</span>\"</span>\n\n<span class=\"token comment\"># 4️⃣ `dynamic-config.yml` 업데이트 (새로운 서비스로 라우팅 변경)</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"🔄 Updating dynamic-config.yml to roll back to <span class=\"token variable\">$TARGET_SERVICE</span>...\"</span>\n<span class=\"token function\">cat</span> <span class=\"token operator\">></span> <span class=\"token variable\">$DYNAMIC_CONFIG</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOL\nhttp:\n  routers:\n    <span class=\"token variable\">$SERVICE</span>:\n      entryPoints:\n        - \"web\"\n      rule: \"Host(\\<span class=\"token variable\"><span class=\"token variable\">`</span>$DOMAIN<span class=\"token punctuation\">\\</span><span class=\"token variable\">`</span></span>)\"\n      service: \"<span class=\"token variable\">$TARGET_SERVICE</span>\"\n\n  services:\n    <span class=\"token variable\">$BLUE_SERVICE</span>:\n      loadBalancer:\n        servers:\n          - url: \"http://<span class=\"token variable\">$BLUE_SERVICE</span>:<span class=\"token variable\">$PORT</span>\"\n\n    <span class=\"token variable\">$GREEN_SERVICE</span>:\n      loadBalancer:\n        servers:\n          - url: \"http://<span class=\"token variable\">$GREEN_SERVICE</span>:<span class=\"token variable\">$PORT</span>\"\nEOL</span>\n\n<span class=\"token comment\"># 5️⃣ Traefik이 설정을 자동 감지하도록 트리거</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"♻️ Triggering Traefik reload...\"</span>\n<span class=\"token function\">touch</span> <span class=\"token variable\">$DYNAMIC_CONFIG</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"🎉 Rollback complete! Traffic is now routed to <span class=\"token variable\">$TARGET_SERVICE</span>.\"</span></code></pre></div>\n<p>이 또한 배포 스크립트와 마찬가지의 방법으로 구현하였다.</p>\n<br>\n<br>\n<h2 id=\"-understanding\" style=\"position:relative;\"><a href=\"#-understanding\" aria-label=\" understanding permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🤔 Understanding</h2>\n<p>무중단 배포 레퍼런스를 온프레미스 환경에서 Docker Compose 환경으로 구성한 사례가 많지 않아 구현하는데 여러 시행 착오를 많이 겪었었다.</p>\n<p>여러 트러블 슈팅을 겪으며 Blue/Green 전략대로 무중단 배포를 구현 자체는 성공(?)하였으나 파이프라인에 모두 담진 못하였다. (Github Action을 통해 배포 스크립트만 자동화가 구현되어 있다.)</p>\n<p>문제가 생기는 경우 인프라 구조를 잘 모르는 사람들 또한 미리 작성한 라우팅 정책 변경 스크립트를 통하여 배포를 롤백할 수 있도록 구현해볼 예정이다.</p>\n<br>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EF%B8%8F-today-i-learned\">✍️ <strong>T</strong>oday <strong>I</strong> <strong>L</strong>earned</a></p>\n<ul>\n<li>\n<p><a href=\"#1-bluegreen-%EB%B0%B0%ED%8F%AC%EB%9E%80\">1. Blue/Green 배포란?</a></p>\n</li>\n<li>\n<p><a href=\"#2-%EA%B5%AC%ED%98%84-%EA%B3%BC%EC%A0%95\">2. 구현 과정</a></p>\n<ul>\n<li><a href=\"#2-1-traefik\">2-1. traefik</a></li>\n<li><a href=\"#2-2-web-server\">2-2. web-server</a></li>\n<li><a href=\"#2-3-%EB%B0%B0%ED%8F%AC-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8\">2-3. 배포 스크립트</a></li>\n<li><a href=\"#2-4-%EB%9D%BC%EC%9A%B0%ED%8C%85-%EC%A0%95%EC%B1%85-%EB%B3%80%EA%B2%BD-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8\">2-4. 라우팅 정책 변경 스크립트</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-understanding\">🤔 Understanding</a></p>\n</li>\n</ul>\n</div>","excerpt":"✍️ Today I Learned 사내 인프라는 비교적 성능이 좋은 서버를 사용하고 있다. (수평적 확장이 힘들어서.. 🥲) 그렇기에 많은 유휴 리소스들을 바탕으로 사내 배포 전략은 Blue/Green 배포 전략을 사용 중이다. 온프레미스 환경에서 Docker Compose 환경으로 배포 전략을 구현한 과정을 간략히 포스팅으로 남기려한다. 1. Blue/Green 배포란? 간단히 소개하자면, 여러 무중단 배포 기법 중 하나이며 두 개의 독립적인 환경 (구버전) 환경과 (신버전) 환경을 가지고 진행되는 배포 전략이다. blue/green 구버전이 운영되는 동안 신버전의 인스턴스를 구성한 후 로드밸런서를 통해 신버전으로 모든 트래픽을 일시에 전환하는 배포 방식이다. 신버전에 문제가 생기는 경우 로드밸런서의 라우팅만 구버전으로 변경해주면 손 쉽게 롤백이 가능한 장점 또한 있지만 그 만큼 리소스를 많이 사용한다. (사용한 만큼 지불하는 서버리스 컴퓨팅 환경이라면 채택 못할거같다. 🥲) 2.…","frontmatter":{"date":"March 16, 2025","title":"Docker Compose와 Traefik을 활용한 Blue/Green 배포 전략","categories":"TIL","author":"JH8459","emoji":"📚"},"fields":{"slug":"/2025-03-16-TIL/"}},"next":{"id":"cd9e92d2-ed0b-58f5-a959-792d43e0be6c","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECA//EABUBAQEAAAAAAAAAAAAAAAAAAAAF/9oADAMBAAIQAxAAAAHSaSawD//EABYQAAMAAAAAAAAAAAAAAAAAAAABIP/aAAgBAQABBQIU/wD/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAAIDH/2gAIAQEABj8CIv8A/8QAGBAAAgMAAAAAAAAAAAAAAAAAAAERIDH/2gAIAQEAAT8hGb2Ff//aAAwDAQACAAMAAAAQHD//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAZEAACAwEAAAAAAAAAAAAAAAABEQAgQVH/2gAIAQEAAT8QjVhju1//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"github-blog.png\"\n        title=\"github-blog.png\"\n        src=\"/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/80e3c/TIL.jpg\"\n        srcset=\"/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/4ec73/TIL.jpg 180w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/158ba/TIL.jpg 360w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/80e3c/TIL.jpg 720w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/47311/TIL.jpg 1080w,\n/static/7c4bbfe7d1a9d6bc02891c94bfe039dc/ac614/TIL.jpg 1272w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<h2 id=\"️-today-i-learned\" style=\"position:relative;\"><a href=\"#%EF%B8%8F-today-i-learned\" aria-label=\"️ today i learned permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✍️ <strong>T</strong>oday <strong>I</strong> <strong>L</strong>earned</h2>\n<p>프로그래머스 <a href=\"https://school.programmers.co.kr/learn/courses/30/lessons/42860\" target=\"_blank\">조이스틱</a> 알고리즘 문제 풀이 과정 중 그리디 알고리즘을 풀이하며 느낀점을 간단히 포스팅으로 남기려한다.</p>\n<br>\n<br>\n<h3 id=\"1-문제\" style=\"position:relative;\"><a href=\"#1-%EB%AC%B8%EC%A0%9C\" aria-label=\"1 문제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 문제</h3>\n<hr>\n<p>문제 설명</p>\n<ul>\n<li>\n<p>조이스틱으로 알파벳 이름을 완성하세요. 맨 처음엔 A로만 이루어져 있습니다. ex) 완성해야 하는 이름이 세 글자면 AAA, 네 글자면 AAAA</p>\n<p>조이스틱을 각 방향으로 움직이면 아래와 같습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">▲ - 다음 알파벳\n▼ - 이전 알파벳 (A에서 아래쪽으로 이동하면 Z로)\n◀ - 커서를 왼쪽으로 이동 (첫 번째 위치에서 왼쪽으로 이동하면 마지막 문자에 커서)\n▶ - 커서를 오른쪽으로 이동 (마지막 위치에서 오른쪽으로 이동하면 첫 번째 문자에 커서)</code></pre></div>\n<p>예를 들어 아래의 방법으로 “JAZ”를 만들 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- 첫 번째 위치에서 조이스틱을 위로 9번 조작하여 J를 완성합니다.\n- 조이스틱을 왼쪽으로 1번 조작하여 커서를 마지막 문자 위치로 이동시킵니다.\n- 마지막 위치에서 조이스틱을 아래로 1번 조작하여 Z를 완성합니다. 따라서 11번 이동시켜 \"JAZ\"를 만들 수 있고, 이때가 최소 이동입니다.</code></pre></div>\n<p>만들고자 하는 이름 name이 매개변수로 주어질 때, 이름에 대해 조이스틱 조작 횟수의 최솟값을 return 하도록 solution 함수를 만드세요.</p>\n</li>\n</ul>\n<p>제한사항</p>\n<ul>\n<li>name은 알파벳 대문자로만 이루어져 있습니다.</li>\n<li>name의 길이는 1 이상 20 이하입니다.</li>\n</ul>\n<p>입출력 예</p>\n<ul>\n<li>\n<table>\n<thead>\n<tr>\n<th>name</th>\n<th>return</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>“JEROEN”</td>\n<td>56</td>\n</tr>\n<tr>\n<td>“JAN”</td>\n<td>23</td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n<br>\n<br>\n<h3 id=\"2-풀이\" style=\"position:relative;\"><a href=\"#2-%ED%92%80%EC%9D%B4\" aria-label=\"2 풀이 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 풀이</h3>\n<hr>\n<p>위아래(▲, ▼)로 조이스틱을 조작하는 경우와 좌우(◀, ▶)로 조작하는 경우를 각각 계산해서 합산하는 방식으로 구현하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">solution</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> answer <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> length <span class=\"token operator\">=</span> name<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 알파벳 변경 횟수 계산 함수</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getUpDownCnt</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">char</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> upCnt <span class=\"token operator\">=</span> char<span class=\"token punctuation\">.</span><span class=\"token function\">charCodeAt</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token string\">'A'</span><span class=\"token punctuation\">.</span><span class=\"token function\">charCodeAt</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> downCnt <span class=\"token operator\">=</span> <span class=\"token string\">'Z'</span><span class=\"token punctuation\">.</span><span class=\"token function\">charCodeAt</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> char<span class=\"token punctuation\">.</span><span class=\"token function\">charCodeAt</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>upCnt<span class=\"token punctuation\">,</span> downCnt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ▲, ▼ 알파벳 변경 횟수 계산</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        answer <span class=\"token operator\">+=</span> <span class=\"token function\">getUpDownCnt</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// 이름에 'A'가 없는 경우 우측(▶)으로만 이동하는 기본 이동 횟수</span>\n    <span class=\"token keyword\">let</span> minMove <span class=\"token operator\">=</span> length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token comment\">// ◀, ▶ 커서 이동 최소 거리 계산</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> next <span class=\"token operator\">=</span> i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>next <span class=\"token operator\">&lt;</span> length <span class=\"token operator\">&amp;&amp;</span> name<span class=\"token punctuation\">[</span>next<span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string\">'A'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            next<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        \n        <span class=\"token comment\">// 좌, 우 어느쪽이 최소값 이동인지 판단</span>\n        <span class=\"token keyword\">const</span> move <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">*</span> <span class=\"token number\">2</span> <span class=\"token operator\">+</span> length <span class=\"token operator\">-</span> next<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>length <span class=\"token operator\">-</span> next<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">2</span> <span class=\"token operator\">+</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        minMove <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>minMove<span class=\"token punctuation\">,</span> move<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> answer <span class=\"token operator\">+</span> minMove<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위아래로 조작하는 경우는 간단히 구현하였으나 최소 커서 이동횟수를 구하는데 시간이 오래걸렸다.</p>\n<ol>\n<li>현재 위치 <code class=\"language-text\">i</code> 이후에서 ‘A’가 아닌 첫번째 문자의 인덱스를 찾기 위한 변수 <code class=\"language-text\">next</code> 선언.</li>\n<li><code class=\"language-text\">next</code>는 ‘A’를 건너 뛰며 ‘A’가 아닌 문자가 나올 때까지 증가한다.</li>\n<li>마지막으로 두가지 이동 방식을 비교해야한다. (오른쪽 후 왼쪽, 왼쪽 후 오른쪽)</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">name <span class=\"token operator\">=</span> <span class=\"token string\">\"JAZAAAZ\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<p>위 경우엔 처음 커서 위치에서 우로 2번 (▶, ▶) 이후 좌로 3번 (◀, ◀, ◀) 움직여서 마지막 Z로 도착하는 경우의 수가 가장 빠르다. (이 반례가 있다는걸 생각을 못했다.)</p>\n<br>\n<br>\n<h2 id=\"-understanding\" style=\"position:relative;\"><a href=\"#-understanding\" aria-label=\" understanding permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🤔 Understanding</h2>\n<p>단순해보였는데 꽤나 애를 먹었다. (기본 테스트 케이스는 반례를 고려하지 않아도 모두 통과했기 때문에..🥲)</p>\n<p>반례를 찾은 뒤에야 풀이가 가능했다.</p>\n<br>\n<br>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EF%B8%8F-today-i-learned\">✍️ <strong>T</strong>oday <strong>I</strong> <strong>L</strong>earned</a></p>\n<ul>\n<li><a href=\"#1-%EB%AC%B8%EC%A0%9C\">1. 문제</a></li>\n<li><a href=\"#2-%ED%92%80%EC%9D%B4\">2. 풀이</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-understanding\">🤔 Understanding</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"March 13, 2025","title":"프로그래머스 - 조이스틱 (JS)","categories":"TIL","author":"JH8459","emoji":"📚"},"fields":{"slug":"/2025-03-13-TIL/"}},"prev":null,"site":{"siteMetadata":{"siteUrl":"https://blog.jh8459.com","comments":{"utterances":{"repo":"JH8459/JH8459.github.io"}}}}},"pageContext":{"slug":"/2025-03-16-TIL/","nextSlug":"/2025-03-13-TIL/","prevSlug":""}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}